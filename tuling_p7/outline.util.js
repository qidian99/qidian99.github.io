var Util={};$(function(){$.showTip=function(content,delay,position){var domTop="50%";if(position=="top"){domTop="80px"}var mask=$("#body-mask"),cssZindex="";if(mask.length>0){var zIndex=$("#body-mask").css("zIndex")-0+1;cssZindex="z-index: "+zIndex+";"}var html='<div class="global-tip" style="border-radius:3px;padding:10px;font-size:14px;position:fixed;top:'+domTop+";left:50%;letter-spacing: 0.5px;transform:translate(-50%, -50%);background:#333;opacity:.6;color:#fff;"+cssZindex+'">'+content+"</div>";$(".global-tip").fadeOut();$(html).appendTo("body");if(typeof showTiping!="undefined"){window.clearTimeout(showTiping)}showTiping=setTimeout(function(){$(".global-tip").remove()},delay||2000)};$.fn.submitForm=function(opt){var defaultOpt={json:true};var options=$.extend(defaultOpt,opt);var form=$(this);if(options.onSubmit){if(options.onSubmit.call(form)==false){return}}if(options.url){form.attr("action",options.url)}var frameId="submit_frame_"+(new Date().getTime());var frame=$("<iframe id="+frameId+" name="+frameId+"></iframe>").attr("src",window.ActiveXObject?"javascript:false":"about:blank").css({position:"absolute",top:-1000,left:-1000});form.attr("target",frameId);frame.appendTo("body");frame.bind("load",submitCallback);form.append("<input type='hidden' name='submitFormByHiddenFrame' id='submitFormByHiddenFrameParam' value='hiddenFrame'/>");form[0].submit();$("#submitFormByHiddenFrameParam").remove();var checkCount=10;function submitCallback(){frame.unbind();var body=$("#"+frameId).contents().find("body");var data=body.html();if(data==""){if(--checkCount){setTimeout(submitCallback,200);return}return}var ta=body.find(">textarea");if(ta.length){data=ta.val()}else{var pre=body.find(">pre");if(pre.length){data=pre.html()}}try{eval("data="+data);if(data.error=="error"){alert("error")}else{if(options.success){options.success(data)}}}catch(e){if(options.json){if(options.error){options.error(data)}}else{if(options.success){options.success(data)}}}setTimeout(function(){frame.unbind();frame.remove()},100)}};$.mask=function(opts){if(opts!=null&&opts=="close"){$("#body-mask").remove();return}var mask=$("#body-mask");if(mask.length){return}mask=$("<div id='body-mask'></div>").appendTo("body");mask.on("mousedown",function(e){e.stopPropagation()})};$.fn.dialog=function(options){var dialogWin=$(this);if(typeof options=="string"){if(options=="close"){if($("#body-mask")!=null){$("#body-mask").remove()}dialogWin.hide()}}else{var defaults={fixed:true,closable:true,mask:true};if(!options){options={};options.width=dialogWin.outerWidth();options.height=dialogWin.outerHeight()}options=$.extend(defaults,options);if(options.closable){var closeBtn=dialogWin.find(".dialog-close");if(closeBtn.length==0){closeBtn=$("<span class='dialog-close icons'>&#xe622;</span>");closeBtn.appendTo(dialogWin)}closeBtn.off("click").on("click",function(){if(options.onClose!=null){options.onClose()}dialogWin.dialog("close")})}if(options.mask){$.mask()}dialogWin.show()}return dialogWin};$.fn.animateDlg=function(options){var dialogWin=$(this);if(typeof options=="string"){if(options=="close"){dialogWin.removeClass("mindflow-show").removeClass("mindflow-hide").addClass("mindflow-hide");dialogWin.css({width:"10px",height:"10px",left:"-4000px",top:"-4000px"})}}else{var defaults={fixed:true,closable:true,mask:true};if(!options){options={}}if(options.width){options.width="100%"}if(!options.height){options.height="100%"}options=$.extend(defaults,options);if(options.closable){var closeBtn=dialogWin.find(".dialog-close");if(closeBtn.length==0){closeBtn=$("<span class='dialog-close icons'>&#xe622;</span>");closeBtn.appendTo(dialogWin)}closeBtn.off("click").on("click",function(){if(options.onClose!=null){options.onClose()}dialogWin.animateDlg("close")})}dialogWin.removeClass("mindflow-show").removeClass("mindflow-hide").addClass("mindflow-show");dialogWin.css({width:options.width,height:options.height,left:"50%",top:"50%"})}return dialogWin};$.confirm=function(options){var optDefault={content:"",title:"温馨提示",okbtn:"确定",cancelbtn:"取消",datalink:"",onConfirm:function(){},onCancel:function(){},mask:true};$.extend(optDefault,options);var confirmWin=$(".confirm-con");if(confirmWin.length){confirmWin.remove()}var confirmWinTxt='<div class="confirm-con">';if(options.title){confirmWinTxt+='<div class="confirm-hd">'+options.title+"</div>"}confirmWinTxt+='<div class="confirm-bd">'+optDefault.content+"</div>";if(options.datalink){confirmWinTxt+='<div class="confirm-desc-link">'+optDefault.datalink+"</div>"}if(optDefault.centerbtn){confirmWinTxt+='<div class="confirm-btn-group"><div class="btn-center">'+optDefault.centerbtn+"</div></div></div>"}else{confirmWinTxt+='<div class="confirm-btn-group"><div class="btn-cancel">'+optDefault.cancelbtn+'</div><div class="btn-ok">'+optDefault.okbtn+"</div></div></div>"}confirmWin=$(confirmWinTxt).appendTo("body");if(optDefault.mask){$.mask()}confirmWin.find(".btn-ok").off("mousedown.btnok").on("mousedown.btnok",function(e){e.stopPropagation();if(options.onConfirm){options.onConfirm()}$.mask("close");confirmWin.remove()});confirmWin.find(".btn-cancel").off("mousedown.btncancel").on("mousedown.btncancel",function(e){e.stopPropagation();if(options.onCancel){options.onCancel()}$.mask("close");confirmWin.remove()});confirmWin.find(".btn-center").off().on("click",function(){if(options.onCancel){options.onCancel()}else{if(options.onConfirm){options.onConfirm()}}$.mask("close");confirmWin.remove()});if(options.datalinkcallback){confirmWin.find(".confirm-desc-link").off("click").on("click",function(e){e.stopPropagation();options.datalinkcallback()})}confirmWin.on("mousedown.confirm",function(e){e.stopPropagation()})};$.fn.confirm=function(options){var obj=$(this);var confirmWin=$("#mind-confirm-con");if(!confirmWin.length){confirmWin=$("<div id='mind-confirm-con'><div class='msg'></div><div class='buttons'><a class='okbtn'>确认</a>&nbsp;&nbsp;<a class='cancelbtn'>取消</a></div></div>").appendTo("body")}confirmWin.find(".msg").html(options.content);if(options.width){confirmWin.css("width",options.width)}if(options.height){confirmWin.css("height",options.height)}confirmWin.removeClass();var marginLeft=-options.width/2;if(options.position){confirmWin.addClass(options.position)}if(options.position=="left"){marginLeft=10-options.width}confirmWin.css({left:obj.offset().left-obj.width()/2,top:obj.offset().top+obj.height()+10,marginLeft:marginLeft}).show();confirmWin.find(".okbtn").off().on("click",function(){if(options.onConfirm){options.onConfirm()}confirmWin.remove()});confirmWin.find(".cancelbtn").off().on("click",function(){if(options.onCancel){options.onCancel()}confirmWin.remove()});confirmWin.on("mousedown.confirm",function(e){e.stopPropagation()});$(document).on("mousedown.confirm",function(){if(options.onCancel){options.onCancel()}confirmWin.remove();$(document).off("mousedown.confirm")})};$.mask=function(opts){if(opts!=null&&opts=="close"){$("#body-mask").remove();return}var mask=$("#body-mask");if(mask.length){return}mask=$("<div id='body-mask'></div>").appendTo("body")};$.loadingball=function(params){if(params.close){$(".ball-spinner").hide();return}var $Dom=params.con;if(!$Dom){$Dom=$("body")}var ballSpinner=$Dom.children(".ball-spinner");if(ballSpinner.length>0){ballSpinner.show()}else{$('<div class="ball-spinner center-middle"><div class="ball1"></div><div class="ball2"></div><div class="ball3"></div>').appendTo($Dom)}if(params.css&&typeof(params.css)=="object"){$(".ball-spinner>div").css(params.css)}};$.fn.showCorner=function(opts){var con=$(this);if(typeof opts=="string"){if(opts=="close"){con.removeClass("active")}return}var tp=opts.type,pos=opts.pos;var targetCon=con.children("[tit="+tp+"]");targetCon.show().siblings("div").hide();con.addClass("active");if(opts.onShow){opts.onShow()}con.children(".mind-icons").on("click",function(e){$(".mind-corner."+pos).removeClass("active");if(opts.onClose){opts.onClose()}})};$("[title],[original-title]").live("mouseenter",function(){if($(this).attr("disableTitle")){return false}if($("#hover_tip").length>0){return}var target=$(this);if(target.attr("title")){target.attr("original-title",target.attr("title"));target.removeAttr("title")}if(!target.attr("original-title")){return}var title=target.attr("original-title");var tip=$("#mind_hover_tip");if(tip.length==0){tip=$("<div id='mind_hover_tip'><div class='tip_arrow'></div><div class='tip_content'></div></div>").appendTo("body")}tip.find(".tip_content").html(title);$("#mind_hover_tip").show();tip.find(".tip_arrow").removeClass("tip_right").removeClass("tip_top").css("top","");if(target.attr("title_pos")=="right"){tip.css({left:target.offset().left+target.outerWidth()+14,top:target.offset().top+target.outerHeight()/2-tip.outerHeight()/2});tip.find(".tip_arrow").attr("class","tip_arrow tip_right").css("top",tip.outerHeight()/2-7)}else{if(target.attr("title_pos")=="top"){tip.css({left:target.offset().left+target.outerWidth()/2-tip.outerWidth()/2,top:target.offset().top-tip.outerHeight()-14});tip.find(".tip_arrow").attr("class","tip_arrow tip_top")}else{if(target.attr("title_pos")=="left"){tip.css({left:target.offset().left-tip.outerWidth()-14,top:target.offset().top+target.outerHeight()/2-tip.outerHeight()/2});tip.find(".tip_arrow").attr("class","tip_arrow tip_left")}else{tip.css({left:target.offset().left+target.outerWidth()/2-tip.outerWidth()/2,top:target.offset().top+target.outerHeight()+14});tip.find(".tip_arrow").attr("class","tip_arrow")}}}}).live("mouseleave",function(){$("#mind_hover_tip").hide()});$.toast=function(opts){$(".toast-con").remove();if(typeof $toastTimer!="undefined"){clearTimeout($toastTimer)}if(typeof opts=="string"&&opts=="close"){return}opts=$.extend({content:"",delay:3000},opts);var dom=$('<div class="toast-con global"><span class="content">'+opts.content+"</span></div>").appendTo("body");dom.show();$toastTimer=setTimeout(function(){dom.fadeOut().remove()},opts.delay)};$.fn.dropdown=function(options){var menu=$(this);if(typeof options=="string"){if(options=="close"){menu.hide();$(document).off("mousedown.mind-dropdown")}return}var tar=options.target;var offset=tar.offset();tar.addClass("selected");if(options.fade){menu.fadeIn("normal")}else{menu.show()}var left;if(options.position=="center"){left=offset.left+tar.outerWidth()/2-menu.outerWidth()/2}else{if(options.position=="right"){left=offset.left+tar.outerWidth()-menu.outerWidth()}else{left=offset.left}}var top=offset.top+tar.outerHeight();if(top+menu.outerHeight()>$(window).height()){top=$(window).height()-menu.outerHeight()}if(left+menu.outerWidth()>$(window).width()){left=$(window).width()-menu.outerWidth()}menu.css({top:top,left:left,minWidth:options.width?options.width:tar.outerWidth()-2});if(typeof options.bind=="undefined"||options.bind==true){menu.find("li:not(.devider)").off().on("click",function(){var item=$(this);if(options.onSelect){options.onSelect(item)}menu.dropdown("close")})}menu.off("mousedown").on("mousedown",function(e){e.stopPropagation()});$(document).off("mousedown.mind-dropdown").on("mousedown.mind-dropdown",function(){menu.dropdown("close")});$(document).off("mouseup.mind-dropdown").on("mouseup.mind-dropdown",function(){menu.dropdown("close");if(options.onClose){options.onClose()}})};$.colorpicker=function(options){var picker=$("#mind-color-picker");picker.find(".selected").removeClass("selected");picker.dropdown(options);var input=picker.find("input[tit=hex]");picker.find("div[co]").off("mousedown").on("mousedown",function(){if(options.onSelect){var color=$(this).css("background-color");color=color.replace(/\s/g,"");var hexColor=$.getHexColor(color);if(hexColor==null){options.onSelect(null)}else{options.onSelect(hexColor.hex)}}picker.dropdown("close")});if(options.setColor!=null){var color=options.setColor;input.val(color.hex)}else{input.val("")}picker.find("div[co]").off("mouseenter").on("mouseenter",function(e){var color=$(this).css("background-color");color=color.replace(/\s/g,"");var hexColor=$.getHexColor(color);if(hexColor!=null){input.val(hexColor.hex)}else{input.val("")}});input.off("blur").on("blur",function(e){var val=$.trim($(this).val());if(val==""){return}if(!$.isHexColor(val)){$(this).val("").focus();return}if(options.onSelect){var color=val.replace(/\s/g,"");options.onSelect(color)}picker.dropdown("close");e.stopPropagation()});input.off("click").on("click",function(e){e.stopPropagation()});input.off("mouseup").on("mouseup",function(e){e.stopPropagation()});input.off("mousedown").on("mousedown",function(e){e.stopPropagation()});picker.on("mouseup",function(e){e.stopPropagation()});picker.on("mousedown",function(e){})};$.getHexColor=function(rgb){var result={};if(rgb.indexOf("rgba(0")<0){var newrgb=rgb.substring(4,rgb.length-1);result.rgb=newrgb;rgb=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function hex(x){return("0"+parseInt(x).toString(16)).slice(-2)}rgb=hex(rgb[1])+hex(rgb[2])+hex(rgb[3]);result.hex=rgb;return result}else{return null}};$.isHexColor=function(hex){return/(^[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(hex)};$.fn.editor=function(options){var target=this.selector,menuDom=$(".pop-editor"),mouseDown=false;var editorObj={creatMenu:function(){if(menuDom.length===0){var fonts="<div class='pop-editor-items' data-key='f'><div>微软雅黑</div><div>宋体</div><div>黑体</div><div>楷体</div><div>宋体</div><div>Arial</div><div>Verdana</div><div>Georgia</div><div>Courier New</div><div>Impact</div><div>Tahoma</div><div>Lucida Console</div><div>Comic Sans MS</div><div>Times New Roman</div></div>";var h="<div class='pop-editor-items' data-key='h'><div>H1</div><div>H2</div><div>H3</div><div>H4</div><div>H5</div><div>H6</div><div>P</div></div>";var editorHtml="<div class='pop-editor'><div data-key='bold'><span class='icons icon-bold'></span></div><div data-key='italic'><span class='icons icon-italic'></span></div><div data-key='underline'><span class='icons icon-underline'></span></div><div data-key='strikeThrough'><span class='icons icon-zitizhonghuaxian'></span></div><div data-key='color'><span class='icons'><svg class='icon icon-color' aria-hidden='true'><use xlink:href='#icon-guangbiaobianjiqi_zitiyanse'></use></svg></span></div><div data-key='equation'><span class='icons icon-equation'></span><span class='eq-tip'>方程式VIP限免</span></div>";menuDom=$(editorHtml).appendTo("body")}},initEvent:function(){var that=this;$(document).off("mousedown.editor",target).on("mousedown.editor",target,function(){mouseDown=true;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()}).off("mouseup.editor").on("mouseup.editor",function(e){if(mouseDown){editorObj.editorShow();var obj=$(e.target).parents(".node-title");var eqText=$(e.target).parents(".equation-text");if(eqText.length>0){outlineObj.oplugins.equation.equationInit(obj,eqText)}}mouseDown=false}).off("keydown.editor",target).on("keydown.editor",target,function(e){if(!$(".eq-editor").is(":visible")){editorObj.editorShow()}var code=e.keyCode,ctrl=e.ctrlKey||e.metaKey,editorDisplay=menuDom.is(":visible");if(ctrl&&editorDisplay){if(code==66){that.setStyle("bold");e.stopPropagation();e.preventDefault()}else{if(code==73){that.setStyle("italic");e.stopPropagation();e.preventDefault()}}}}).off("keyup.editor",target).on("keyup.editor",target,function(){editorObj.editorShow()}).off("focus.editor",target).on("focus.editor",target,function(){editorObj.editorShow()}).off("blur.editor",target).on("blur.editor",target,function(){menuDom.hide();window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()}).off("dragstart.editor",target).on("dragstart.editor",target,function(){return false});menuDom.children("div").off("mousedown").on("mousedown",function(e){var div=$(this),key=div.data("key");var obj=$(window.getSelection().getRangeAt(0).startContainer).parents(".node-title");obj.find(".equation-text").removeAttr("contenteditable");if(key=="down"){menuDom.find(".pop-editor-items").hide();div.find(".pop-editor-items").show()}else{if(key=="color"){e.stopPropagation();e.preventDefault();$.colorpicker({target:div,setColor:"red",onSelect:function(color){if(color==null){color="transparent"}else{color="#"+color}that.setStyle("ForeColor",color);obj.find(".equation-text").attr("contenteditable",false)}});return}else{if(key=="equation"){poCollect("点击-光标编辑器-LaTeX方程式",{"来源":"思维笔记","用户属性":outlineUI.member?"会员用户":"普通用户"});obj.find(".equation-text").attr("contenteditable",false);outlineObj.oplugins.equation.equationInit(obj)}else{that.setStyle(key);obj.find(".equation-text").attr("contenteditable",false)}}}e.preventDefault();e.stopPropagation()});menuDom.children("div").off("mouseup").on("mouseup",function(e){e.stopPropagation();e.preventDefault()});menuDom.find(".pop-editor-items > div").off("mousedown").on("mousedown",function(e){var item=$(this),key=item.parent().data("key"),value=item.text();var result=that.setStyle(key,value);e.stopPropagation();return false})},setStyle:function(key,value){var result="",value=value||null;switch(key){case"h":document.execCommand("formatBlock",false,"<"+value+">");break;case"f":document.execCommand("FontName",false,value);break;default:document.execCommand(key,false,value);break}return result},editorShow:function(){var text="";if(window.getSelection){var selectionObj=window.getSelection();text=selectionObj.toString()}else{if(document.selection){var selectionObj=document.selection;var rangeObj=selectionObj.createRange();text=rangeObj.text}}if($.trim(text)!=""){var positionObj=selectionObj.getRangeAt(0).getBoundingClientRect();menuDom.css({left:positionObj.left+positionObj.width/2-menuDom.outerWidth()/2,top:positionObj.top-40}).show()}else{menuDom.hide()}}};editorObj.creatMenu();editorObj.initEvent()};Util.globalTopTip=function(content,type,delay,dom,noarrow){if(typeof content=="undefined"){return}if(typeof content=="string"&&content=="close"){$("#global_top_dialog").remove();return}if(delay==null){delay=5000}if(type==null){type="top_success"}var globalTopTipBox=$("#global_top_dialog");if(globalTopTipBox.length>0){globalTopTipBox.remove()}globalTopTipBox=$('<div id="global_top_dialog" class="global_top_dialog"><div class="left_arrow"></div>'+content+'<div class="right_arrow"></div></div>').appendTo("body");globalTopTipBox.addClass(type);if(noarrow){globalTopTipBox.find(".left_arrow").remove();globalTopTipBox.find(".right_arrow").remove();globalTopTipBox.addClass("noarrow")}var outerW=globalTopTipBox.outerWidth();if(dom){globalTopTipBox.css("top",$(dom).offset().top+"px")}else{if($("#header").length==0){globalTopTipBox.css("top","0px")}}globalTopTipBox.css({"margin-left":-(outerW*0.5)+"px"}).show();setTimeout(function(){globalTopTipBox.addClass("show");setTimeout(function(){globalTopTipBox.removeClass("show");setTimeout(function(){globalTopTipBox.fadeOut("slow").remove()},250)},delay)},50)}});