var Outline=function(c,e,k){var f={listType:"dot",indent:"default",target:"outline-con",container:"outline",line:{show:false},readOnly:false,config:{theme:"light",page:"A4",completeDisplay:true,remarkMultLine:false,deaultFont:""}};if(typeof outlineConfig=="object"){f.config=$.extend(f.config,outlineConfig)}opts=$.extend(f,c);var m=this,j=m.util,o=document,n=0,a=o.getElementById(opts.container),p=o.getElementById(opts.target),l=window;var i={node:{title:"Outline",children:[],leftChildren:[],id:"root",structure:"mind_right",theme:"theme3"},setData:function(q){if(!q.leftChildren){q.leftChildren=[]}this.data=q},page:"homePage",nodeList:{},data:null,searchDataList:[],pid:"root",clipboard:{},focusInfo:{state:false,focusDataList:{}},getPid:function(r){var q=this.getNodeById(r);return q.parent},getOpconfig:function(){return opts.config},addNodes:function(q,x,w){var w=w||{};for(var t=0;t<q.length;t++){var v=q[t];if(v.summary){i.summary.addSummary([v]);continue}var s=x[v.id]||0,r=w[v.id]||"right",u=this.getNodeById(v.parent);if(v.parent=="root"&&r=="left"){u.leftChildren.splice(s,0,v)}else{u.children.splice(s,0,v)}}this.resetNodeList()},update:function(){this.resetNodeList()},removeByIds:function(q){if(q.length==0){return}var A=this;for(var y=0;y<q.length;y++){var r=q[y];var v=A.getNodeById(r);if(v==null||v.parent==null){return}var E=A.getNodeById(v.parent);var u=E.children,B=u.length,z=-1;for(var w=0;w<B;w++){var t=u[w];if(t.id==r){z=w;break}}if(z>-1){u.splice(z,1)}if(v.parent=="root"){var x=E.leftChildren,s=x.length,D=-1;for(var C=0;C<s;C++){var t=x[C];if(t.id==r){D=C;break}}if(D>-1){x.splice(D,1)}}if(v.parent=="root"&&$(".outline-left").css("opacity")==="1"){h.catalog.updateCatalog("delete",[r])}}this.resetNodeList()},removeNodeFromList:function(q){delete i.nodeList[q]},getRootSubPart:function(u){var q="right",s=this.data,r=s.children||[],t=s.leftChildren||[];t.forEach(function(w,v){if(u==w.id){q="left";return false}});return q},moveNode:function(w,y,r,s,A){var x=this;if(!w||w.length<1||!y){return}var z=[],C={},D={},v=[],q={},u={};w.forEach(function(O,J){var H=i.getNodeById(O);var S=j.copy(H);var R=H.parent;var P=i.getNodeById(R),N=P.children;if(R=="root"&&x.getRootSubPart(O)=="left"){N=P.leftChildren;D[O]="left"}if(!s){if(S.free){delete S.free;delete S.pos}}var M=-1;for(var J=0;J<N.length;J++){var G=N[J];if(G.id==O){M=J;break}}if(M>=0){z.push(j.copy(S));C[O]=M;N.splice(M,1)}if(!y[O]&&!y.id){return true}var F=y[O]||y;var L=i.getNodeById(F.id);var K,I;if(F.pos=="in"){S.parent=L.id;K=L;I=K.children;if(L.id=="root"||F.part=="left"){I=K.leftChildren;u[S]="left"}}else{S.parent=L.parent;K=i.getNodeById(L.parent);I=K.children;if(L.parent=="root"&&x.getRootSubPart(F.id)=="left"){I=K.leftChildren;u[S]="left"}}var Q=-1;for(var J=0;J<I.length;J++){var G=I[J];if(G.id==F.id){Q=J;break}}var E=0;if(F.pos=="down"){I.splice(Q+1,0,S);x.updateNodeListForOne(S,P,K);E=Q+1}else{if(F.pos=="in"){I.splice(0,0,S);x.updateNodeListForOne(S,P,L);E=0}else{I.splice((Q-1)<0?0:Q,0,S);x.updateNodeListForOne(S,P,K);E=Q-1}}if(E<0){E=0}v.push(S);q[O]=E});this.resetNodeList();if(!s){var t=i.summary.getUpdatedSummaries(z,C,D,"delete");var B=i.summary.getUpdatedSummaries(v,q,u);d.save({action:"moveNode",content:{sourceId:w,target:y,source:r,oldSums:t,newSums:B}})}if(A=="setsums"){i.indentNodeInfoBeforeSet();h.indentNodeInfo.removeNodes.concat(z);$.extend(h.indentNodeInfo.removeIndexs,C);$.extend(h.indentNodeInfo.removeParts,D);h.indentNodeInfo.newNodes.concat(v);$.extend(h.indentNodeInfo.newNodesIndexs,q);$.extend(h.indentNodeInfo.newNodesParts,u)}},indent:function(q,w){w=this.getNodeById(w.id);if(w==null||w.collapsed){return}var t=this.getNodeById(q),z=j.copy(t);var u=this.getNodeById(t.parent),r=u.children,s=null;if(t.parent=="root"&&i.getRootSubPart(q)=="left"){r=u.leftChildren;s="left"}var v=this.getNodeIndex(q,t.parent);i.indentNodeInfoBeforeSet();indentNodeInfo=h.indentNodeInfo;indentNodeInfo.removeNodes.push(j.copy(z));indentNodeInfo.removeIndexs[q]=v;if(s){indentNodeInfo.removeParts[q]=s}r.splice(v,1);z.parent=w.id;w.children.push(z);indentNodeInfo.newNodes.push(j.copy(z));var y=w.children.length-2;if(y<0){y=0}indentNodeInfo.newNodesIndexs[q]=y;var x=j.copy(z);delete x.children},indentNodeInfoBeforeSet:function(){var q=h.indentNodeInfo;if(!q.removeNodes){q.removeNodes=[]}if(!q.removeIndexs){q.removeIndexs={}}if(!q.removeParts){q.removeParts={}}if(!q.newNodes){q.newNodes=[]}if(!q.newNodesIndexs){q.newNodesIndexs={}}if(!q.newNodesParts){q.newNodesParts={}}},unIndent:function(x){var u=this.getNodeById(x),r=j.copy(u);var t=this.getNodeIndex(u.id,u.parent);var q=this.getNodeById(u.parent);i.indentNodeInfoBeforeSet();indentNodeInfo=h.indentNodeInfo;indentNodeInfo.removeNodes.push(j.copy(r));indentNodeInfo.removeIndexs[x]=t;q.children.splice(t,1);var w=this.getNodeIndex(q.id,q.parent);var v=this.getNodeById(q.parent);r.parent=v.id;var s=v.children;if(v.id=="root"&&this.getRootSubPart(q.id)=="left"){s=v.leftChildren}s.splice((w+1),0,r);indentNodeInfo.newNodes.push(j.copy(r));indentNodeInfo.newNodesIndexs[x]=w+1},focusNodeList:function(r){if(r!=null){function q(x){i.focusInfo.focusDataList[x.id]=x;var u=x.children||[],y=x.leftChildren||[],s=u.length,v=y.length;if(s>0){for(var t=0;t<s;t++){var w=u[t];q(w)}}if(v>0){for(var t=0;t<v;t++){var w=y[t];q(w)}}}q(r)}},updateNodeListForOne:function(t,r,u){var s=this,q=s.nodeList;if(!t){return}q[t.id]=t;q[r.id]=r;q[u.id]=u},resetNodeListForOne:function(s){var r=this;if(s!=null){function q(z){r.nodeList[z.id]=z;var v=z.children||[],A=z.leftChildren||[],t=v.length,x=A.length;if(t>0){for(var u=0;u<t;u++){var y=v[u];q(y)}}if(x>0){for(var u=0;u<x;u++){var y=A[u];q(y)}}var w=z.summaries;if(w!=null&&w.length>0){for(var u=0,t=w.length;u<t;u++){var y=w[u];q(y)}}}q(s)}},resetNodeList:function(){var u=this;u.nodeList={};var v=u.data;if(v!=null){function t(D){u.nodeList[D.id]=D;var z=D.children||[],E=D.leftChildren||[],x=z.length,B=E.length;if(x>0){for(var y=0;y<x;y++){var C=z[y];t(C)}}if(B>0){for(var y=0;y<B;y++){var C=E[y];t(C)}}var A=D.summaries;if(A!=null&&A.length>0){for(var y=0,x=A.length;y<x;y++){var C=A[y];t(C)}}}t(v)}var q=i.focusInfo.state;if(q){if(q.id){var s=u.nodeList[q.id].children.length;if(s==0){b.emptyCreatNode(function(y){if(y){var x=i.getNodeById(y);q.children.push(x)}})}}return}var r=u.nodeList.root.leftChildren.length,s=u.nodeList.root.children.length;if(r==0&&s==0){b.emptyCreatNode()}else{var w=$("#outline-empty-box");if(w.length>0){w.remove()}}},getNodeById:function(q){return this.nodeList[q]},getSubNodeById:function(r){var q=this.getParentNodeById(r);if(q.id=="root"){return this.getNodeById(r)}if(q.parent=="root"){return q}else{return this.getSubNodeById(q.parent)}},getParentNodeById:function(r){var q=this.getNodeById(r);if(r=="root"){return q}return this.getNodeById(q.parent)},getParentNodes:function(r){var q=[];s(r);function s(v){var u=i.getNodeById(v);if(u==null){return}var t=j.copy(u);delete t.children;if(v=="root"){delete t.leftChildren}q.push(t);if(u.parent!=null){s(u.parent)}}return q},getNodeIndex:function(x,r){var v=this.getNodeById(r),s=0;var u=v.children;if(r=="root"&&this.getRootSubPart(x)=="left"){u=v.leftChildren}var q=u.length;for(var t=0;t<q;t++){var w=u[t];if(w.id==x){s=t;break}}return s},getPreNode:function(x){var w=this.getParentNodeById(x),u=w.children,s=0,r=null;if(w.id=="root"){r=this.getRootSubPart(x);if(r=="left"){u=w.leftChildren}}for(var t=0,q=u.length;t<q;t++){var v=u[t];if(v.id==x){s=t-1;break}}if(s<0){if(w.id=="root"&&r=="left"&&w.children&&w.children.length>0){return w.children[w.children.length-1]}return w}else{return u[s]}},getNextNode:function(x){var w=this.getParentNodeById(x),u=w.children,s=0,r=null;if(w.id=="root"){r=this.getRootSubPart(x);if(r=="left"){u=w.leftChildren}}for(var t=0,q=u.length;t<q;t++){var v=u[t];if(v.id==x){s=t+1;break}}if(s>=q){if(w.id=="root"&&r!="left"&&w.leftChildren&&w.leftChildren.length>0){return w.leftChildren[0]}return null}else{return u[s]}},getPrevOnly:function(w){var u=i.getParentNodeById(w);var t=u.children,r=null,q=null;if(u.id=="root"){q=this.getRootSubPart(w);if(q=="left"){t=u.leftChildren}}for(var s=0;s<t.length;s++){var v=t[s];if(v.id==w){if(s==0){r=0}else{r=s-1}break}}if(r<0||r==null||r==0){if(u.id=="root"&&q=="left"){if(u.children&&u.children.length>0){return u.children[u.children.length-1]}}return null}return t[r]},getNextOnly:function(w){var u=i.getParentNodeById(w);var t=u.children,r=null,q=null;if(u.id=="root"){q=this.getRootSubPart(w);if(q=="left"){t=u.leftChildren}}for(var s=0;s<t.length;s++){var v=t[s];if(v.id==w){r=s+1;break}}if(r>(t.length-1)||r==null){if(u.id=="root"&&q!="left"){if(u.leftChildren&&u.leftChildren.length>0){return u.leftChildren[0]}}return null}return t[r]},getPrevByDom:function(u){var t=$("#"+u);var s=t.prev(".node-element");if(s.length==0){var r=t.parent().parent(".node-element");if(r.length>0){s=r}else{s=null}}else{q(s)}return s;function q(x){var v=x.children(".node-children");if(v.length>0){var w=v.children(".node-element");var z=w.length;if(z>0){var y=s=w.eq(z-1);q(y)}}}},getNextByDom:function(v){var t=$("#"+v),q=null;var r=t.children(".node-children");if(r.length>0&&r.children(".node-element").length>0){q=r.children(".node-element").eq(0)}else{var s=t.next(".node-element");if(s.length>0){q=s}else{u(t)}}return q;function u(w){var x=w.parent().parent(".node-element");if(x.length>0){nextTemp2=x.next(".node-element");if(nextTemp2.length>0){q=nextTemp2}else{u(x)}}}},addConnectionMulti:function(s){var r=i.data,q=r.lines;for(var u=0;u<s.length;u++){var t=s[u]||{};if(q==null){q={}}if(!t.from||!i.nodeList[t.from]){return}if(!t.to||!i.nodeList[t.to]){return}q[t.id]=t}},deleteConnectionMulti:function(t,w){if(t.length==0){return}var s=i.data,r=s.lines;for(var v=0,q=t.length;v<q;v++){var u=t[v];delete r[u.id]}if($.isEmptyObject(r)){delete s.lines}if(w==null){setTimeout(function(){d.isUndo=true;d.save({action:"deleteConnection",content:{content:t}});d.isUndo=false},300)}},deleteConnectionByNodeIds:function(q,r){var x=this,z=i.data,A=z.lines;if(q.length>0&&A!=null){var w=[];for(var v=0,y=q.length;v<y;v++){var u=i.getNodeById(q[v]);if(!u){continue}var t=i.getChildrenIds(u);var s=t.join(",");$.each(A,function(C,B){if(s.indexOf(B.from)>=0||s.indexOf(B.to)>=0){w.push(B)}})}this.deleteConnectionMulti(w,r)}},getChildrenIds:function(q){var s=[];function r(y){var x=y.children;s.push(y.id);if(x){var u=x.length;for(var w=0;w<u;w++){var v=x[w];r(v)}}if(y.summaries!=null&&y.summaries.length>0){for(var w=0;w<y.summaries.length;w++){var v=y.summaries[w];r(v)}}}r(q);return s},summary:{addSummary:function(w){var v=this;if(!w||w.length<1){return}var q=w.length;for(var u=0;u<q;u++){var s=j.copy(w[u]);var r=s.part;var x=i.getNodeById(s.parent);if(x.id==root.id){s.pos={}}var t=x.summaries;if(t==null){x.summaries=[]}x.summaries.push(s)}i.resetNodeList()},deleteSummary:function(x){var u=this;if(!x||x.length<1){return}var v=x.length;for(var t=0;t<v;t++){var w=j.copy(x[t]);var y=i.getNodeById(w.parent);var q=y.summaries;if(!q||q.length==0){continue}for(var s=q.length,r=s-1;r>=0;r--){if(q[r].id==w.id){q.splice(r,1);break}}}i.resetNodeList()},updateSummary:function(u,r){if(!u||$.isEmptyObject(u)){return}var t=i.getNodeById(u.parent);var v=t.summaries;if(!v||v.length==0){return}for(var q=v.length,s=q-1;s>=0;s--){if(v[s].id==u.id){v[s]=u;break}}},getUpdatedSummaries:function(P,U,G,t){var A={},K={},F={};var w=this,I=i.data;var u=[];for(var O=0,Q=P.length;O<Q;O++){var J=P[O];if(J.summary){u.push(J.id)}}for(var O=0,Q=P.length;O<Q;O++){var J=P[O],v=U[J.id],H=G[J.id]||"right",E=i.getNodeById(J.parent);if(J.summary){continue}if(E!=null&&E.summaries&&E.summaries.length>0){var B=E.summaries;for(var M=0,D=B.length;M<D;M++){var q=B[M];if(u.indexOf(q.id)>=0){continue}if(q.part!=null&&q.part!=H){continue}var z=W(q,v,t);if(z!=null){if(F[q.id]==null){F[q.id]=z}else{var N=F[q.id]["r1"];var L=F[q.id]["r2"];F[q.id]["r1"]=N+z.r1;F[q.id]["r2"]=L+z.r2}}}}}if(!$.isEmptyObject(F)){var H="right";for(var X in F){var z=F[X];var q=i.getNodeById(X);if(q==null){continue}var y=i.getNodeById(q.parent);var S=j.copy(q);if(t=="delete"){var C=q.range+"";var r=s(C);var N=Number(r.r1)+z.r1;var L=Number(r.r2)+z.r2;if(N>L){S.removed=true;var B=y.summaries,x=B.length;for(var O=0;O<x;O++){var R=B[O];if(R.id==q.id){y.summaries.splice(O,1);T(S,S,y.id);break}}i.removeNodeFromList(S.id)}else{V(q,z);T(q,S,y.id)}}else{V(q,z);T(q,S,y.id)}}}return{updates:A,original:K};function T(Z,aa,Y){if(A[Y]==null){A[Y]=[]}A[Y].push(j.copy(Z));if(K[Y]==null){K[Y]=[]}K[Y].push(j.copy(aa))}function W(ab,ac,ad){var aa=ab.range+"";var Y=s(aa);var ae=Y.r1,Z=Y.r2;var ag=0,af=0;if(ad=="delete"){if(ac<ae){ag=-1;af=-1}else{if(ac>=ae&&ac<=Z){af=-1}else{return null}}}else{if(ac<=ae){ag=1;af=1}else{if(ac>ae&&ac<=Z){af=1}else{return null}}}return{r1:ag,r2:af}}function V(ab,Y){var aa=ab.range+"";if(aa.indexOf(",")<0){ab.range=parseInt(aa)+Y.r1}else{var Z=s(aa);ab.range=(parseInt(Z.r1)+Y.r1)+","+(parseInt(Z.r2)+Y.r2)}i.resetNodeListForOne(ab)}function s(Y){var Z=0,aa=0;if(Y.indexOf(",")<0){Z=aa=Y}else{Z=Y.split(",")[0];aa=Y.split(",")[1]}return{r1:Z,r2:aa}}},}};var h={renderAll:function(){var t=i.data,q=t.children||[],u=t.leftChildren||[];var s=this;function r(z,w){if(z.length==0){return}for(var y=0,v=z.length;y<v;y++){var A=z[y];s.addNodeDom(A,y,w);if(A.collapsed){continue}if(A.children.length>0){var x=A.children;r(x)}}}b.renderTitle(t);r(q);r(u,"left");if(q.length==0&&u.length==0){b.emptyCreatNode()}},renderChildren:function(t){var q=t.children;var s=this;function r(y,v){if(y.length==0){return}for(var x=0,u=y.length;x<u;x++){var z=y[x];s.addNodeDom(z,x,v);if(z.collapsed){continue}if(z.children.length>0){var w=z.children;r(w)}}}r(q);if(t.id=="root"&&t.leftChildren&&t.leftChildren.length>0){r(t.leftChildren,"left")}},refreshNode:function(t){var u=this;if(!t||t.id=="root"){return}var y=$("#"+t.id);if(y.length>0){y.remove()}var q=i.getNodeById(t.parent),x=q.children,s="right",v=null;if(t.parent=="root"&&i.getRootSubPart(t.id)=="left"){s="left";x=q.leftChildren}if(x.length==0){return}x.forEach(function(A,z){if(A.id==t.id){v=z;return false}});if(!v){return}u.addNodeDom(t,v,s);if(t.collapsed){return}var r=t.children;if(r.length>0){w(r)}function w(C){for(var B=0,z=C.length;B<z;B++){var D=C[B];u.addNodeDom(D,B);if(D.collapsed){continue}if(D.children.length>0){var A=D.children;w(A)}}}},config:{set:function(s,t){if(!s){return}var r=opts.config;switch(s){case"page":if(t){r.page=t}if(t=="A4"){$("body").attr("page","a4")}if(t=="auto"){$("body").attr("page","auto")}break;case"completeDisplay":if(!t||(t!="checked"&&t!==true)){$("body").addClass("completeDisneyNone")}else{$("body").removeClass("completeDisneyNone")}break;case"themeMode":if(!t||(t!="dark")){r.themeMode="light";$("body").removeClass("dark-mode");var q=document.querySelector("#css_base");q.setAttribute("href","/themes/default/mind/outline.css")}else{r.themeMode="dark";$("body").removeClass("dark-mode").addClass("dark-mode");var q=document.querySelector("#css_base");q.setAttribute("href","/themes/default/mind/outline_dark.css")}$(p).html("");h.renderAll();break}d.setConfig()},init:function(){var q=opts.config;if(q.theme&&q.theme=="dark"){$("body").attr("theme","dark")}else{$("body").attr("theme","light")}if(q.page&&q.page=="auto"){$("body").attr("page","auto")}else{$("body").attr("page","a4")}}},testTopicCount:function(){var r=this,q=Object.keys(outlineObj.model.nodeList).length;if(q<150){return""}if(q<301){j.testVipState(function(){if(wpsVipInfo.indexOf(20)<0&&wpsVipInfo.indexOf(40)<0){if(!j.wpsLimitFree){r.events.trigger("vip-limit","node_vip");return}if(j.wpsLimitFree&&!j.wpsLimitFreePopCount){r.events.trigger("vip-limit","node_vip_limit_free");return}}});if(wpsVipInfo.indexOf(20)<0&&wpsVipInfo.indexOf(40)<0&&!j.wpsLimitFree){return"over"}if(wpsVipInfo.indexOf(20)<0&&wpsVipInfo.indexOf(40)<0&&j.wpsLimitFree&&!j.wpsLimitFreePopCount){return"over"}return""}if(q>300){j.testVipState(function(){if(wpsVipInfo.indexOf(20)<0&&wpsVipInfo.indexOf(40)<0){if(!j.wpsLimitFree){r.events.trigger("vip-limit","node_vip");return}if(j.wpsLimitFree&&!j.wpsLimitFreePopCount){r.events.trigger("vip-limit","node_vip_limit_free");return}}if(wpsVipInfo.indexOf(40)<0){if(!j.wpsLimitFree){r.events.trigger("vip-limit","node_svip");return}if(j.wpsLimitFree&&!j.wpsLimitFreePopCount){r.events.trigger("vip-limit","node_svip_limit_free");return}}});if(wpsVipInfo.indexOf(40)<0&&!j.wpsLimitFree){return"over"}if(wpsVipInfo.indexOf(40)<0&&j.wpsLimitFree&&!j.wpsLimitFreePopCount){return"over"}return""}},addMultNodes:function(q,w,t,v){if(q.length==0){return}if(v){i.addNodes(q,w,t)}var s=[];function r(z,x,y){Array.prototype.forEach.call(z,function(B,A){if(B.summary){return true}b.addNodeDom([B],x,y,v);if(B.parent=="root"){s.push(B.id)}if(B.children&&B.children.length>0){r(B.children,{},{})}})}r(q,w,t,v);if(v&&v!="noservesave"){var u=i.summary.getUpdatedSummaries(q,w,t);d.save({action:"add",content:q,indexs:w,parts:t,updates:u.updates,original:u.original})}if(s.length>0){h.catalog.updateCatalog("add",s)}},addNodes:function(q,v,s,u){if(q.length==0){return}if(u){i.addNodes(q,v,s)}b.addNodeDom(q,v,s,u);if(u&&u!="noservesave"){var t=i.summary.getUpdatedSummaries(q,v,s);d.save({action:"add",content:q,indexs:v,parts:s,updates:t.updates,original:t.original})}if($(".outline-left").css("opacity")==="1"){var r=[];Array.prototype.forEach.call(q,function(x,w){if(x.parent=="root"){r.push(x.id)}});if(r.length>0){h.catalog.updateCatalog("add",r)}}},addNodeDom:function(s,r,q){var q=q||"right";var u={},t={};u[s.id]=r;if(s.parent=="root"){t[s.id]=q}this.addNodes([s],u,t,false)},add:function(y,v,r,w,u){var q=j.newId(),y=y==null?-1:y;var s={id:q,title:"",children:[]};if(!v){v="root"}s.parent=v;if(w){s.type=w;s[w]=u[w];if(u.image){s.image=u.image}}var x={},t={};x[s.id]=y+1;if(v=="root"&&r=="left"){t[s.id]="left"}this.addNodes([s],x,t,true);return q},removeNodes:function(B,I,w){var v=this,E=[];var r=i.getPrevByDom(B[0].id),t=null;if(r&&r.length>0){t=r.attr("id")}var A={};for(var F=0;F<B.length;F++){var D=B[F],y=D.parent;var z=D.id;if(z=="root"){continue}if(D.summary){i.summary.deleteSummary([D]);continue}var H=o.getElementById(z);$(H).remove();E.push(z);var G=$("#"+y),x=G.children(".node-children").find(".node-self");if(x.length==0){G.children(".node-self").find(".node-state").remove()}if(y=="root"){var q=i.getNodeById(y);if(q.summaries&&q.summaries.length>0){var u=i.getSubNodeById(z);var C=i.getRootSubPart(u.id);A[z]=C}}}i.deleteConnectionByNodeIds(E);i.removeByIds(E);var s=i.summary.getUpdatedSummaries(B,I,A,"delete");h.deleteNodeStatus=false;if(!w){d.save({action:"delete",content:B,indexs:I,updates:s.updates,original:s.original});if(t){j.setCursorPosition(t)}}},removeByIds:function(q,v){var A=this,r=[],B={};for(var y=0;y<q.length;y++){var s=q[y];var w=i.getNodeById(s),D=0;var C=i.getParentNodeById(s);var u=C.children;for(var x=0,z=u.length;x<z;x++){var t=u[x];if(t.id==s){D=x;break}}r.push(w);B[s]=D}this.removeNodes(r,B,v)},update:function(R,C,y,v){if(C.length==0){return}var P=[],D=[];for(var H=0;H<C.length;H++){var F=C[H],A=F.id,E=y[H];var N=o.getElementById(A);if(R=="title"||(R=="style"&&F.title!=E.title)){var S=F.title;if(S==E.title){continue}if(N&&N.querySelector(".node-title")!=null){N.querySelector(".node-title").innerHTML=S}if(F.parent=="root"){h.catalog.updateCatalog("updateTitle",[A])}}if(R=="style"){N.querySelector(".node-title").removeAttribute("style");var J=F.style;if(J!=null){var I="";for(var Q in J){var S=J[Q];if(Q=="background-color"||Q=="padding"||Q=="border"||Q=="border-width"||Q=="border-style"||Q=="box-shadow"){continue}if(S=="rgb(255, 255, 255)"){continue}I+=Q+": "+S+";"}N.querySelector(".node-title").style.cssText=I}}else{if(R=="note"){var r=F.note;if(r==null||r==""){var u=N.querySelector(".node-remark");$(u).remove()}else{var O=$(N).find(".node-remark");if(O.length==0){var G=b.renderRemarkDom(A);h.initNoteEvent(G);G.innerHTML=r;G.focus()}}}else{if(R=="image"){var z=F.image;if(z==null||z.url==null){var x=N.querySelector(".node-image");$(x).remove()}else{var x=$(N).children(".node-image");b.renderImg(F)}}else{if(R=="mode"){var w=F.mode;if(w){}}else{if(R=="task"){var L=F.task;N.classList.remove("complete");if(L&&L.completion==100){N.classList.add("complete")}}else{if(R=="icon"){h.setIcons.renderTopicIcons(F)}else{if(R=="collapsed"){var t=i.getNodeById(A),K=$(N),B=K.children(".node-self");if(!t.children||t.children.length==0){return}var M=B.find(".node-state").children(".ol-icons").eq(0),s=K.children(".node-children");s.html("");if(F.collapsed){M.removeClass("openIcon").addClass("closeIcon");$(".node-remark:focus").blur()}else{h.renderChildren(t);M.removeClass("closeIcon").addClass("openIcon");var S=$("#outline_search_input").val();if(S){h.searchNode.filtrateNodes(S)}}K.toggleClass("collapsed")}}}}}}}var q=j.copy(F);if(R!="task"){delete q.children;delete E.children}P.push(q);D.push(E)}if(P.length==0){return}g.equation.renderEquation(N);i.update();if(!v&&!opts.readOnly){d.save({action:"update",content:{key:R,nodes:P,oldNodes:D}})}},removeAndAdd:function(N,D,E,y,B){var v=this,H=i.data;var G={},Q=[],z="",F={};if(!N||N.length<1){return}for(var K=0,L=N.length;K<L;K++){var x=N[K],u=-1,P={};var A=i.getNodeById(x.parent);var q=A.children,I=y;if(A.id=="root"&&i.getRootSubPart(x.id)=="left"){q=A.leftChildren;I="left"}for(var J=0,w=q.length;J<w;J++){var t=q[J];if(t.id==x.id){P[x.id]=J;break}}v.removeNodes([x],P,B);var M=D[x.id];if(M.length>0){var C={},O={},r=P[x.id];for(var J=0;J<M.length;J++){var s=M[J];s.parent=A.id;C[s.id]=r+J;O[s.id]=I}h.addMultNodes(M,C,O,"noservesave")}}},addAndRemove:function(J,z,A,v,E,y){var t=this;var G=[],L=[],w="",B={};var r={};for(var M in z){var C=z[M],K={};for(var H=0,I=C.length;H<I;H++){var D=C[H];var x=i.getNodeById(D.parent);var q=x.children;if(x.id=="root"&&i.getRootSubPart(D.id)=="left"){q=x.leftChildren}for(var F=0,u=q.length;F<u;F++){var s=q[F];if(s.id==D.id){K[D.id]=F;break}}t.removeNodes([D],K,y)}}h.addMultNodes(J,E,v,"noservesave")},update_:function(u,s,x,q){var w=this;if(!u){return}for(var t=0;t<s.length;t++){var v=s[t],r=i.getNodeById(v.id);switch(u){case"title":r.title=v.title;break;case"collapsed":r.collapsed=v.collapsed||false;break;case"style":if(v.style==null){v.style={}}r.style=v.style;break;case"note":if(!v.note||v.note==""){delete r.note}else{r.note=v.note}break;case"image":r.image=v.image;if(!r.image){delete r.image}break;case"mode":break;case"task":if(!v.task||v.task==""||$.isEmptyObject(v.task)){if(r.task&&r.task.completion){delete r.task.completion}}else{r.task=$.extend(r.task||{},v.task)}break;case"icon":r.icons=v.icons;break}w.update(u,s,x,q)}},moveNode:function(v,w,t,s,r){if(opts.readOnly){return}if(!v&&v.length==0){return}var u=j.copyArray(v);if(w&&w.id){if(w.pos=="down"&&u.length>1){u.reverse();t.reverse=true}}else{if(w&&w.reverse){u.reverse()}}var q=false;u.forEach(function(I,B){var C=i.getParentNodeById(I);var F=i.getNodeById(I);var A=$("#"+I);if(!w[I]&&!w.id){return true}if(A.parent().attr("id")=="outline-con"){q=true}var x=w[I]||w,D=$("#"+x.id);if(x.pos=="up"){D.before(A)}else{if(x.pos=="in"){var z=D.children(".node-children");if(x.id=="root"){z=$(p)}if(z.length>0){if(x.id=="root"&&x.part=="left"){var H=i.getNodeById("root").leftChildren;if(H.length>0){leftChildrenFirst=$("#"+H[0].id);if(leftChildrenFirst.length>0){leftChildrenFirst.before(A)}}else{z.append(A)}}else{var G=z.children(".node-element ").eq(0);if(G.length>0){G.before(A)}else{z.append(A)}}}if(x.id=="root"){q=true}}else{D.after(A)}}if(D.parent().attr("id")=="outline-con"){q=true}var E=$("#"+C.id),y=E.children(".node-children").find(".node-self");if(y.length==0){E.children(".node-self").find(".node-state").remove()}if(u.length==1){$(A).children(".node-self").children(".node-title").focus()}});i.moveNode(u,w,t,s,r);if(q){h.catalog.render()}},getCurNodePosition:function(x){var v=null;var u=i.getParentNodeById(x),r=null;if(u.id=="root"){r=i.getRootSubPart(x)}var t=u.children,q=null;if(u.id=="root"&&r=="left"){t=u.leftChildren||[]}for(var s=0;s<t.length;s++){var w=t[s];if(w.id==x){q=s;break}}if(q==0||q==null){v={id:u.id,pos:"in"};if(u.id=="root"&&r=="left"){v.part="left"}}else{v={id:t[q-1].id,pos:"down"}}return v},focusNode:function(v,q){if(opts.readOnly){return}if(!v){return}if(document.activeElement){document.activeElement.blur()}if(j.getCollaCount()>1&&v!="root"){$.showTip("多人协作时，不能聚焦节点",2000,"top");return}var s=i.getNodeById(v);if(s.id=="root"&&s.children.length==0&&s.leftChildren.length==0){return}var t=$(".designer-outline-title").attr("id");var r=s.id;h.searchNode.clearSearch();this.clearNodes();$(".outline-title").html(s.title).attr("id",s.id);setTimeout(function(){h.renderChildren(s)});g.equation.renderEquation(s);b.showNav(s);h.initEvent();b.renderTitle(s);i.focusNodeList(s);i.focusInfo.state=v=="root"?false:s;if(s.id!="root"&&s.children.length==0){b.emptyCreatNode()}if($(".outline-left").css("opacity")==="1"){var u="";if(s.id=="root"){u=""}else{if(s.parent=="root"){u=s.id}else{u=i.getSubNodeById(s.id).id}}h.catalog.updateCatalogStatus(u)}if(!q){d.save({action:"focus",content:{oldId:t,newId:r}})}},clearNodes:function(){$(p).html("")},indentByIds:function(r,u){if(r.length==0){return}h.indentNodeInfoReset();var v=[];var A={},C={};for(var B=r.length,w=0;w<B;w++){var t=r[w],D=o.getElementById(t),z=j.getElementIndex(D);if(z<1){if(B==1&&!u){$.showTip("第一个子节点无法缩进",2000,"top")}break}var x=i.getPreNode(t);if(x.id=="root"){break}if((!x||x.collapsed||x.id=="root")&&!u){$.showTip("父节点折叠状态，不能缩进",2000,"top");break}v.push(t);A[t]={id:x.id,pos:"in"};var q=h.getCurNodePosition(t);C[t]=q;h.indent(t,x,u)}if(v.length==0){return}i.resetNodeList();if($(".outline-left").css("opacity")==="1"){h.catalog.updateCatalog("delete",v)}if(!u){if(v.length==1){this.focus(v[0])}else{j.unSelectAllNode();j.selectNodeByIds(v)}var y=null,s=null;if(h.indentNodeInfo.removeNodes&&h.indentNodeInfo.removeNodes.length>0){y=i.summary.getUpdatedSummaries(h.indentNodeInfo.removeNodes,h.indentNodeInfo.removeIndexs,h.indentNodeInfo.removeParts,"delete")}if(h.indentNodeInfo.newNodes&&h.indentNodeInfo.newNodes.length>0){s=i.summary.getUpdatedSummaries(h.indentNodeInfo.newNodes,h.indentNodeInfo.newNodesIndexs,h.indentNodeInfo.newNodesParts)}d.save({action:"indent",content:{ids:v,targets:A,origins:C,oldSums:y,newSums:s}})}this.addParentCloseIcon(v[0]);j.setCursorPosition(v[0])},indentByNodesPos:function(u,x,B,t,A){if(u.length==0){return}var C=0;var q=j.copyArray(u);h.indentNodeInfoReset();for(var y=q.length,v=0;v<y;v++){var s=q[v],z=x[s];if(z){C++;if(A=="undo"){h.moveNode([s],z,null,true,"setsums")}else{h.indent(s,x[s])}}}if(C<1){return}i.resetNodeList();if(!t){if(u.length==1){this.focus(u[0])}else{j.unSelectAllNode();j.selectNodeByIds(u)}var w=null,r=null;if(h.indentNodeInfo.removeNodes&&h.indentNodeInfo.removeNodes.length>0){w=i.summary.getUpdatedSummaries(h.indentNodeInfo.removeNodes,h.indentNodeInfo.removeIndexs,h.indentNodeInfo.removeParts,"delete")}if(h.indentNodeInfo.newNodes&&h.indentNodeInfo.newNodes.length>0){r=i.summary.getUpdatedSummaries(h.indentNodeInfo.newNodes,h.indentNodeInfo.newNodesIndexs,h.indentNodeInfo.newNodesParts)}d.save({action:"indent",content:{ids:q,targets:x,origins:B,type:A,oldSums:w,newSums:r}})}this.addParentCloseIcon(q[0]);j.setCursorPosition(q[0])},indent:function(u,t){if(!u){return}if(t.id=="root"){return}var s=o.getElementById(u),q=j.getElementIndex(s);if(q<1){return}if(!t||t.collapsed){return}var r=o.getElementById(t.id);r.querySelector(".node-children").appendChild(s);i.indent(u,t)},indentUpdateSums:function(){var q=i.summary.getUpdatedSummaries(removeNodes,removeIndexs,removeParts,"delete");var r=i.summary.getUpdatedSummaries(newNodes,newNodesIndexs,newNodesParts)},indentNodeInfoReset:function(){this.indentNodeInfo={removeNodes:[],removeIndexs:{},removeParts:{},newNodes:[],newNodesIndexs:{},newNodesParts:{}}},indentNodeInfo:{removeNodes:[],removeIndexs:{},removeParts:{},newNodes:[],newNodesIndexs:{},newNodesParts:{}},unIndentByIds:function(A,t){if(A&&A.length==0){return}ids=j.copyArray(A);var x={};if(ids.length>0){ids.reverse();x.reverse=true}h.indentNodeInfoReset();var u=j.copyArray(ids),z={};for(var v=0;v<ids.length;v++){var s=ids[v];var B=i.getNodeById(s);var C=o.getElementById(s);if($(C).parent().parent(".node-element").length==0){u=j.ArrayDeleteOne(u,s);continue}var y=x[s]=i.getNodeById(B.parent);var q=h.getCurNodePosition(s);z[s]=q;h.unIndent(s,y)}if(u.length==0){return}i.resetNodeList();if(u.length==1&&!t){this.focus(u[0])}if($(".outline-left").css("opacity")==="1"){h.catalog.updateCatalog("add",u)}if(!t){if(x.reverse){u.reverse()}if(u.length==1){this.focus(u[0])}else{j.unSelectAllNode();j.selectNodeByIds(u)}var w=null,r=null;if(h.indentNodeInfo.removeNodes&&h.indentNodeInfo.removeNodes.length>0){w=i.summary.getUpdatedSummaries(h.indentNodeInfo.removeNodes,h.indentNodeInfo.removeIndexs,h.indentNodeInfo.removeParts,"delete")}if(h.indentNodeInfo.newNodes&&h.indentNodeInfo.newNodes.length>0){r=i.summary.getUpdatedSummaries(h.indentNodeInfo.newNodes,h.indentNodeInfo.newNodesIndexs,h.indentNodeInfo.newNodesParts)}d.save({action:"unIndent",content:{ids:u,targets:x,origins:z,oldSums:w,newSums:r}})}},unIndent:function(u){if(!u){return}var q=i.getNodeById(u);var s=o.getElementById(u);if($(s).parent().parent(".node-element").length==0){return}if(q.parent=="root"){return}var t=$("#"+q.parent),r=t.children(".node-children").children(".node-element");if(r.length==1){t.children(".node-self").find(".node-state").remove()}t.after(s);i.unIndent(u)},setNote:function(u,t){if($.isEmptyObject(t)){return}var r=i.getNodeById(u),s=j.copy(r);if(r.note==t.note){return}for(var q in t){r[q]=t[q]}if(t.note==""){delete r.note}this.update("note",[r],[s])},setTasks:function(r,s){if(!r||r.length<1){return}var q=[],t=[];Array.prototype.forEach.call(r,function(w,u){var v=i.getNodeById(w);if(!v){return true}t.push(j.copy(v));if(s.task==""){if(v.task&&v.task.completion){delete v.task.completion}}else{v.task=$.extend(v.task||{},s.task)}q.push(v)});this.update("task",q,t)},setMode:function(r,t){if(!r||r.length<1||!t){return}var q=[],s=[];Array.prototype.forEach.call(r,function(w,u){var v=i.getNodeById(w);if(!v){return true}s.push(j.copy(v));v.mode=t;q.push(v)});this.update("mode",q,s)},isViewBoad:function(u){var q=false,r=false;if(!u){return false}var s=i.getNodeById(u);if(s.mode=="board"){r=true}if(s.parent=="root"){return r}if(s.parent&&s.parent!="root"){t(s.parent)}function t(v){var w=i.getNodeById(v);if(w.mode=="board"){q=false}else{if(w.parent=="root"){q=r}else{if(w.parent&&w.parent!="root"){t(w.parent)}}}}return q},imageUploadResponse:function(q){var r=j.currentId;if(q.result=="size_wrong"){$.showTip("图片大小不能超过3M",2500,"top");return}if(q.result=="type_wrong"){$.showTip("格式有误，只能上传图片",2500,"top");return}if(q.result=="error"){$.showTip("只能上传小于5M的图片",2500,"top");return}if(q.url!=null){q.url=q.url.replace("http://","https://");h.setImage(r,q.url)}j.blurAdjust();window.clearTimeout();setTimeout(function(){$(".global-tip").remove()},1500)},setImage:function(v,q){var s=i.getNodeById(v),u=j.copy(s),r=this;if(q!=null&&q!=""){var t=new Image();t.src=q;t.onload=function(){s.image={url:q,w:t.width/2,h:t.height/2};r.update("image",[s],[u])}}},getStyle:function(r){var s="";for(var q in r){if(q=="background-color"||q=="padding"||q=="border"||q=="border-width"||q=="border-style"||q=="box-shadow"){continue}if(r[q]=="rgb(255, 255, 255)"){continue}s+=q+":"+r[q]+";"}return s},setStyle:function(q,y,t){if(q.length==0){return}var r=[],w=[];for(var x=0;x<q.length;x++){var s=q[x];var u=i.getNodeById(s),v=j.copy(u);if(u.style==null){u.style={}}if(y!=null&&t!=null){u.style[y]=t}else{delete u.style[y]}u.title=h.getConvertTagRichText2.removeRichStyle(s,y,t);r.push(u);w.push(v)}this.update("style",r,w)},resetStyleMenuStatus:function(q){var r=$(".outline-style-menu")},addParentCloseIcon:function(w){var s=i.getParentNodeById(w);var v=o.getElementById(s.id);if(!s.id||s.id=="root"){return}var q=v.querySelector(".node-contr-action"),u=q.querySelector(".node-state");if(u==null){var r=o.createElement("div");r.setAttribute("class","node-state");var t=o.createElement("span");t.innerHTML="&#xe721;";t.setAttribute("class","openIcon ol-icons");r.appendChild(t);q.appendChild(r)}},toggleChilren:function(t,q){if(!t){return}var r=i.getNodeById(t),s=j.copy(r);r.collapsed=!r.collapsed;h.update("collapsed",[r],[s],q)},resetSubNumbers:function(){$(p).children(".node-element").each(function(r,s){var q=$(s).children(".node-self");q.children(".node-type").find("span:first").text(r+1+".")})},resetSubChildrenNumbers:function(q){$("#"+q).find(".node-children").each(function(r,s){$(s).children(".node-element").each(function(u,v){var t=$(v).children(".node-self");t.children(".node-type").find("span:first").text(u+1+".")})})},hideTopics:function(q,t,x){var s="",u={},y=[];if(q.length>0){if(t){for(var v=0;v<q.length;v++){var r=q[v];var w=i.getNodeById(r);if(w.collapsed||w.children.length==0){continue}y.push(r);h.toggleChilren(r,true)}}else{for(var v=0;v<q.length;v++){var r=q[v];var w=i.getNodeById(r);if(w.collapsed||w.children.length==0){continue}y.push(r);h.toggleChilren(r,true)}}if(x==null){d.save("hideTopics",{ids:y,parts:u,withChildren:t})}}},showTopics:function(q,v,A){var B=this,z=B.util,y=B.model,F=B.line,D=B.currentRoot||y.topic;var t="",r=[],u={},E=[],C=[];if(q.length>0){if(v){for(var w=0;w<q.length;w++){var s=q[w];var x=y.getNodeById(s);if(!x.collapsed){continue}E.push(s);h.toggleChilren(s,true)}}else{for(var w=0;w<q.length;w++){var s=q[w];var x=y.getNodeById(s);if(!x.collapsed){continue}E.push(s);h.toggleChilren(s,true)}}if(A==null){d.save("showTopics",{ids:E,parts:u,withChildren:v})}}},setMindMargin:function(t,r,q){var s=i.data;if(t){s.margin=t}i.resetNodeList()},focus:function(r){var q=o.getElementById(r);$(q).find("div[contenteditable]:first").focus()},changeTitle:function(s){h.saveTitle(s);var q=i.getNodeById("root");if(!q){return}if(q.title=="未命名文件"){var r=j.copy(q);q.title=s;$("[id=root]").children().html(s);setTimeout(function(){h.update("title",[q],[r])},800)}},saveTitle:function(q,t){var s=this,r=j.restoreXss(q);if(t=="from_root"){if(r!=""&&r!=null&&chartTitle=="未命名文件"){$(".outline-title.node-title").text(r);setTimeout(function(){s.saveTitleDrect(r)},800)}return}s.saveTitleDrect(r)},saveTitleDrect:function(s){if(s.length>30){s=s.substring(0,30)}if(s==chartTitle){return}if(!s){$(".outline-title.node-title").text(chartTitle);return}var r=chartTitle;chartTitle=s;var q={action:"changeTitle",title:s,oldTitle:r};d.save(q);$(".outline-title.node-title").text(s);document.title=s},getNodeDomById:function(r){var q=o.getElementById(r);return q},copyToClipBoard:function(r){var q="";if(!r||r.length<0){return}Array.prototype.forEach.call(r,function(u,t){q+=u.title});var s=document.createElement("input");s.setAttribute("value","__outline__"+q);document.body.appendChild(s);s.select();document.execCommand("copy",false);document.body.removeChild(s)},doCopy:function(t){var v=this,w=i.clipboard;if(!t||t.length<0){return}var r=t.length;w.list=[];w.type="copy";for(var s=0;s<r;s++){var x=t[s];if(x=="root"){continue}var u=i.getNodeById(x);var q=$.extend(true,{},u);w.list.push(q)}if(w.list.length>0){this.copyToClipBoard(w.list);window.localStorage.setItem("clipboard_outline",JSON.stringify(w))}i.copying=false},doCut:function(t){var v=this,w=i.clipboard;if(!t||t.length<0){return}var r=t.length;w.list=[];w.type="cut";for(var s=0;s<r;s++){var x=t[s];if(x=="root"){continue}var u=i.getNodeById(x);var q=$.extend(true,{},u);w.list.push(q)}if(w.list.length>0){this.copyToClipBoard(w.list);window.localStorage.setItem("clipboard_outline",JSON.stringify(w))}if(w.list.length>0){h.removeByIds(t)}},execPaste:function(u,x){var t=this;if(!x){return}var w=u.clipboardData||window.clipboardData;if(w){var v=$(w.getData("text/html"))[1];s(w)}function s(E){if(j.isIE()){var z=E.getData("text");if(z!=null&&z!=""){r(z)}return false}var D=E.items,C=E.types||[],y;for(var B=0;B<C.length;B++){if(C[B]==="Files"){y=D[B];break}}if(y&&y.kind==="file"&&y.type.match(/^image\//i)&&D.length!=4){var A=y.getAsFile();d.uploadImageJsBlob(A);u.stopPropagation();u.preventDefault();return false}else{for(var B=0;B<C.length;B++){if(C[B]=="text/plain"){y=D[B];break}}u.preventDefault();if(j.isChrome()||j.isFirefox()){y.getAsString(function(F){if(F.indexOf("__outline__")!=-1){if(x=="stringPaste"){F=F.replace("__outline__","");q(F);return}h.doPaste(x);return}F=F.replace("__outline__","");q(F)})}else{if(j.isSafari()||j.isIE()){var z=E.getData("text/plain");if(z!=null&&z!=""){r(z);return false}}}return false}}function r(y){if(y.indexOf("__outline__")!=-1){if(x=="stringPaste"){y=y.replace("__outline__","");q(y);return}h.doPaste(x);return}y=y.replace("__outline__","");q(y)}function q(A){if(v&&v.className=="mind-clipboard"){A=v.innerHTML}else{A=A.replace(/</g,"&lt;");A=A.replace(/>/g,"&gt;");A=A.replace(/\n/g,"<br>");A=A.replace(/\u2029/g,"<br>").replace(/\u2028/g,"<br>");A=A.replace(/\x0a/g,"<br>").replace(/\x0d/g,"<br>")}var z=window.getSelection();var y=z.getRangeAt(0);if(document.queryCommandSupported("insertHTML")){document.execCommand("insertHTML",false,A)}else{if(y.pasteHTML){y.pasteHTML(A)}}if($(v).find(".equation-text").length>0){setTimeout(function(){$("#"+x).find(".equation-text").each(function(B,C){$(C).attr("data-index",B).attr("contenteditable",false)})},10)}}},doPaste:function(A){if(!A){return}var E=i.getNodeById(A),F=null;var x=this,K=i.clipboard,s=K.type,L=K.list;if(E.collapsed){$.showTip("目标节点处于折叠状态，不能使用粘贴操作",2000,"top");return}if(h.copying){return}if(A=="root"){return}h.copying=true;var J=window.localStorage.getItem("clipboard_outline");if(J!=null){var w=JSON.parse(J).list;if(w.length>0){L=w}}var r=A,M=true;var v={},C=[],B={},t=null;if(!E.title&&(!E.children||E.children.length==0)){var D=j.copy(E),G=L[0];E.title=L[0].title;h.update("title",[E],[D]);var z=G.children;if(z&&z.length>0){z.forEach(function(P,N){var Q=P;var O=$.extend(true,{},Q);j.resetNodeId(O,P.id);if(Q.summary){delete O.summary;delete O.range;delete O.part}else{if(O.free){delete O.free;delete O.pos;O.parent=A}}C.push(O);v[O.id]=N})}r=E.parent;L.shift();M=false;var y=i.getNodeIndex(A,E.parent)-0+1;if(r=="root"){t=i.getRootSubPart(A)}}for(var H=0,I=L.length;H<I;H++){var q=L[H];var u=$.extend(true,{},q);j.resetNodeId(u,r);if(q.summary){delete u.summary;delete u.range;delete u.part}else{if(u.free){delete u.free;delete u.pos;u.parent=A}}C.push(u);if(M){v[u.id]=E.children.length+H}else{v[u.id]=y+H;if(r=="root"){B[u.id]=t}}}h.addMultNodes(j.copyArray(C),v,B,true);if(h.copyingTimer){clearTimeout(h.copyingTimer)}h.copyingTimer=setTimeout(function(){h.copying=false},300)},setNodeDomDisabled:function(q){if(!q){return}Array.prototype.forEach.call(q,function(t,s){var r=$("#"+t);r.addClass("disable")})},setNodeDomEnabled:function(){$(".node-element.disable").removeClass("disable")},modeBoard:{},setting:{init:function(){},pop:function(){var r=$("#outline-setting-dlg");if(r.length==0){var q="";r=$(q).appendTo()}r.dialog();this.popInit()},popInit:function(){var s=opts.config;var r=$(".setting-list");var q=r.find(".list-cell[setting=theme-mode]");q.find(".img-cell[tp="+s.themeMode+"]").addClass("active").siblings(".img-cell").removeClass("active");var t=r.find(".list-cell[setting=page-size]");t.find(".radio-cell[tp="+s.page+"]").addClass("active").siblings(".radio-cell").removeClass("active");var u=r.find(".list-cell[setting=complete-display]");u.find("input[type=checkbox]").prop("checked",s.completeDisplay)}},catalog:{init:function(s){var q=$(".outline-left"),r="左侧悬浮工具栏按钮";if(s=="corner-right-top"){r="左侧导航面板右上角按钮"}if(q.css("opacity")==="1"){q.removeClass("active");poCollect("功能触发",{"功能名称":"折叠左侧导航","触发位置":r,"当前页面":"outline-editor"})}else{q.removeClass("active").addClass("active");h.catalog.render();poCollect("功能触发",{"功能名称":"展开左侧导航","触发位置":r,"当前页面":"outline-editor"})}},render:function(){var s=i.data,q=s.children||[],t=s.leftChildren||[];var r=this;$("#outline-catalog").empty();this.randerDom(q);this.randerDom(t);this.initEvent()},randerDom:function(q){var w=$("#outline-catalog");var s="";for(var r=0;r<q.length;r++){var t=q[r],v=t.id;if($("#catalog-"+v).length>0){continue}if(t.type=="image"||t.type=="flow"||t.type=="mind"){continue}var u=j.delHtmlTag(t.title)||"空节点";s+='<div id="catalog-'+v+'" class="catalog-node-element"><div class="catalog-node-self"><div  spellcheck="false" autocapitalize="false" class="catalog-node-title">'+u+"</div></div></div>"}w.append(s)},initEvent:function(){$("#outline-catalog").off("mousedown.fix").on("mousedown.fix",".catalog-node-self",function(r){r.stopPropagation();r.preventDefault();var q=$(this).parents(".catalog-node-element"),s=q.attr("id").replace("catalog-","");$(".catalog-node-element.active").removeClass("active");q.addClass("active");h.focusNode(s)})},updateCatalog:function(r,q){if($(".outline-left").css("opacity")==="0"){return}if(r=="updateAll"){this.render()}if(r=="delete"){this.deleteCatalog(q);return}if(r=="updateTitle"){this.updateTitle(q);return}if(r=="add"){this.addCatalog(q)}},deleteCatalog:function(q){if(!q||q.length<1){return}q.forEach(function(t,r){var s=i.getNodeById(t);if(s.parent=="root"){return true}$("#catalog-"+t).remove()})},addCatalog:function(q){if(!q||q.length<1){return}q.forEach(function(x,r){if($("#catalog-"+x).length>0){return true}var u=i.getNodeById(x);if(u.parent!="root"){return true}if(u.type=="image"||u.type=="flow"||u.type=="mind"){return true}var v=$("#"+x),s=$("#outline-catalog"),w=v.next(".node-element");var t='<div id="catalog-'+x+'" class="catalog-node-element"><div class="catalog-node-self"><div  spellcheck="false" autocapitalize="false" class="catalog-node-title">'+(v.children(".node-self").children(".node-title").text()||"空节点")+"</div></div></div>";if(w.length==0){s.append(t)}else{nextCatalogDom=$("#catalog-"+w.attr("id"));if(nextCatalogDom.length>0){nextCatalogDom.before(t)}}})},updateTitle:function(q){if(!q||q.length<1){return}q.forEach(function(u,r){var t=$("#"+u);if(t.length==0){return}var s=t.children(".node-self").children(".node-title");if(t.hasClass("designer-outline-title")){s=t.children(".node-title")}$("#catalog-"+u).children(".catalog-node-self").children(".catalog-node-title").text(s.text()||"空节点")})},updateCatalogStatus:function(q){$(".catalog-node-element.active").removeClass("active");if(!q){return}$("#catalog-"+q).addClass("active")}},menuClick:{setStyle:function(u,t,w){if(!u||u.length==0){return}var r=0;for(var s=0,q=u.length;s<q;s++){var x=u[s],v=i.getNodeById(x);if(v.style&&v.style[t]==w){r++}}if(r==u.length){h.setStyle(u,t)}else{h.setStyle(u,t,w)}},indent:function(){var r=j.currentId;if(r!=""){h.indentByIds([r])}var q={event:"button_click",attributes:{button_name:"outlinenext"}};m.events.trigger("dataCollect",q)},unIndent:function(){var r=j.currentId;if(r!=""){h.unIndentByIds([r])}var q={event:"button_click",attributes:{button_name:"outlineupper"}};m.events.trigger("dataCollect",q)},complete:function(){var s=j.selectIds();if(s.length){var q=h.getCompleteStatus(s);var r=$(".op-context-menu");if(q=="complete"){h.setTasks(s,{task:""});r.find("li[op=complete] label").text("完成")}else{h.setTasks(s,{task:{completion:100}});r.find("li[op=complete] label").text("取消完成")}}if(s.length==1){b.hideMenu()}},format:function(){},b:function(){var q=j.selectIds();this.setStyle(q,"font-weight",700)},i:function(){var q=j.selectIds();this.setStyle(q,"font-style","italic")},u:function(){var q=j.selectIds();this.setStyle(q,"text-decoration","underline")},s:function(){var q=j.selectIds();this.setStyle(q,"text-decoration","line-through")},color:function(r){var q=j.selectIds();this.setStyle(q,"color",r)},size:function(r){var q=j.selectIds();this.setStyle(q,"font-size",r)},icons:function(){},remark:function(){var s=j.currentId;if(s!=""){var r=b.renderRemarkDom(s);h.initNoteEvent(r);r.focus()}var q={event:"button_click",attributes:{button_name:"remark"}};m.events.trigger("dataCollect",q);b.hideMenu();poCollect("功能触发",{"功能名称":"添加备注","触发位置":"菜单-备注","当前页面":"outline-editor"})},del:function(){var q=j.selectIds("nochild");if(q.length){h.removeByIds(q)}var r={event:"button_click",attributes:{button_name:"deletenode"}};m.events.trigger("dataCollect",r);b.hideMenu();poCollect("功能触发",{"功能名称":"删除节点","触发位置":"菜单-删除","当前页面":"outline-editor"})},image:function(){var r=j.currentId;if(r==""){return}$("#"+r).find("div[contenteditable=true]").trigger("blur");d.uploadImageRequest();var q={event:"button_click",attributes:{button_name:"image"}};m.events.trigger("dataCollect",q);b.hideMenu();poCollect("功能触发",{"功能名称":"插入图片","触发位置":"菜单-插入图片","当前页面":"outline-editor"})},mode:function(r){var q=j.selectIds("nochild");if(q.length){h.setMode(q,r)}b.hideMenu()},equation:function(){var t=j.currentId;if(t==""){return}var s=$("#"+t).children(".node-self").find(".node-title");if(o.body.createTextRange){var q=document.body.createTextRange();q.moveToElementText(s.get(0));q.select()}else{if(window.getSelection){var r=window.getSelection();var q=document.createRange();q.selectNodeContents(s.get(0));r.removeAllRanges();r.addRange(q)}}q.collapse(true);r.removeAllRanges();r.addRange(q);g.equation.equationInit(s);b.hideMenu()},insert:function(q){if(q=="image"){this.image()}if(q=="flow"||q=="mind"){g.mindflow.popInsert(q)}}},isUndo:false,initMenuEvent:function(){var q=this;var r=$(".op-context-menu");r.find("[op]:not([op=icons])").off("mousedown").on("mousedown",function(u){var t=$(u.target);var s=t.attr("op");if(s!=null&&t.hasClass("disabled")){return}if(s!=null&&(s=="color"||s=="size")){var v=$(t).attr("val");q.menuClick[s](v);h.resetStyleMenuStatus()}else{if(s=="image"||s=="mind"||s=="flow"){q.menuClick.insert(s)}else{if(s=="equation"){q.menuClick.equation()}else{q.menuClick[s]()}}}u.stopPropagation();u.preventDefault()});r.find(".mode-menu").off("mousedown").on("mousedown","li[tp]",function(t){t.stopPropagation();var s=$(t.target);var u=s.attr("tp");if(!u){return}q.menuClick.mode(u)});r.find("[op]").off("mouseover").on("mouseover",function(v){var u=$(v.target);var s=u.attr("op");if(s!=null&&u.hasClass("disabled")){return}var t=null;if(!s){return}switch(s){case"icons":t=$("#mind-dock-right-icons");break;case"mode":t=$(".mode-menu");break;case"insert":t=$(".insert-op-menu");break}j.hideSubsidiary(null,0);if(!t||t.length==0){return}j.showSubsidiary(u,t,function(){if(typeof clearSubsidiary!="undefined"){clearTimeout(clearSubsidiary)}if(s=="icons"){h.setIcons.init()}u.off("mouseout").on("mouseout",function(w){j.hideSubsidiary(t,500)})},500);v.stopPropagation();v.preventDefault()})},initMenuBtnStatus:function(D,J){var K=$(".op-context-menu");K.find("li").removeClass("disable");if(!D){K.find("li").addClass("disable");return}var z=0,r=0,C=$(".node-element.selected"),q=$(".op-context-menu");if(D.length==1&&J){var B=D[0];var u=K.outerHeight(),v=$(o).outerHeight(),x=$(J),I=x.outerHeight(),A=x.offset().top,w=x.offset().left;r=w-20<0?0:w-20;z=A+I+10;if(u+z>v){z=A-u-10}$("#"+B).removeClass("node-optioning").addClass("node-optioning")}else{if(D.length>1){K.find("li").map(function(){var y=$(this),L=y.attr("op");if(L=="mode"||L=="remark"||L=="expand"||L=="collapsed"||L=="insert"||L=="icons"||L=="image"||L=="mind"||L=="flow"){y.addClass("disable")}else{y.removeClass("disable")}});var u=K.outerHeight(),v=$(o).outerHeight();for(var E=0;E<C.length;E++){var F=$(C[E]),t=F.offset().top;if(!z||t<z){z=t;if(z<50){z=50}if(u+t>v){z-=(u+t+50-v)}r=F.offset().left+F.width()-q.outerWidth()}}}}var H={};var s=K.find(".outline-style-menu");$.each(D,function(y,M){var L=i.getNodeById(M);s.find(".active").removeClass("active")});if(D.length==1){}K.css({top:z,left:r}).show();var G=h.getCompleteStatus(D);if(G=="complete"){K.find("li[op=complete] label").text("取消完成")}else{K.find("li[op=complete] label").text("完成")}h.initMenuEvent(K)},getCompleteStatus:function(t){var q=false;if(!t){return q}var s=t.length,r=0;t.forEach(function(w,u){var v=$("#"+w);if(v.hasClass("complete")){if(s==1){q="complete";return false}r+=1}});if(r==s){q="complete"}return q},nodeOperationBtn:function(r){var q=$(".bullet-border")},previewImg:{init:function(q){var s=q.attr("src");if(!s||typeof s!="string"){return}var r=$("#view_img_box");if(r.length>0){r.remove()}r=$("<div id='view_img_box' class='view_img_box'><div class='view_box_close'><i class='ol-icons'>&#xe622;</i></div><div class='view-con'><div class='view-image'><img class='imageZoom' src='"+s+"'/></div></div></div>").appendTo($("body"));$(".view-image img").on("load",function(){$(this).css("width","100%");r.css({transform:"scale(1)",webkitTransform:"scale(1)",opacity:1})});this.initPreviewImgEvent()},initPreviewImgEvent:function(){var v=this;var s=$(".view-image"),M=s.outerWidth(),t=s.outerHeight();var L,r,A=0,x=0,C=1,q=0,u,y={x:M*0.5,y:t*0.5};var I=C;var J=0,K=0;var G=0,E,z,w;$("#view_img_box").off("touchstart").on("touchstart",function(N){N.stopPropagation()});$("#view_img_box").off("touchmove").on("touchmove",function(N){N.stopPropagation();N.preventDefault()});var D=0,B=0;if(typeof viewImageListenerStart!="undefined"){s[0].removeEventListener("touchstart",viewImageListenerStart)}if(typeof viewImageListenerMove!="undefined"){s[0].removeEventListener("touchmove",viewImageListenerMove)}if(typeof viewImageListenerEnd!="undefined"){s[0].removeEventListener("touchend",viewImageListenerEnd)}viewImageListenerStart=function(X){var N=X.touches;if(N.length<2){var Q=N[0];E=new Date().valueOf();u=0;L=Q.pageX;r=H(Q.pageY);var Q=N[0];var U=s.offset();D=U.left;B=H(U.top)-41;var P=(L.toFixed(2)-U.left)/I,O=(r.toFixed(2)-H(U.top))/I;y=$.extend(true,y,{x:P,y:O})}if(N.length==2){u=1;var T=N[0],R=N[1],W=T.pageX.toFixed(2)-0,S=H(T.pageY).toFixed(2)-0,Z=R.pageX.toFixed(2)-0,Y=H(R.pageY).toFixed(2)-0;q=Math.sqrt(Math.pow(Z-W,2)+Math.pow(Y-S,2)).toFixed(2);var U=s.offset();var P=((Z+W)/2-U.left)/I,O=((Y+S)/2-H(U.top))/I,V={x:P,y:O};y=$.extend(true,y,V)}s[0].addEventListener("touchmove",viewImageListenerMove,false)};viewImageListenerMove=function(am){var an=am.touches;if(u==0){var Y=an[0];A=Y.pageX-L;x=H(Y.pageY)-r;var aa=41,T=$("#view_img_box").outerWidth(),ab=$("#view_img_box").outerHeight(),ac=s.outerHeight()*I,U=s.outerWidth()*I,R=T-U;moveTop=ab-aa-ac;if(A>0&&A+D>=0){A-=(A+D)}if(A<0&&A+D<R){A+=R-(A+D)}if(I==1){A=0}var ae=x+B;if(x>0&&ae>0){x=I==1?0:x-ae;K=I==1?0:K;s.css({left:J+A,top:K+x});G=0;return}if(x<0){if(moveTop>0){x=0}else{poBtm=ab-aa-(ac+B+x);if(poBtm>0){x+=poBtm;s.css({left:J+A,top:K+x});G=0;return}}}if(Math.abs(A)>5||Math.abs(x)>5){s.css({left:J+A,top:K+x});G=0}if(Math.abs(A)>1||Math.abs(x)>1){G=0}}else{if(u==1){var X=an[0],W=an[1],Q=X.pageX.toFixed(2),O=X.pageY.toFixed(2),ai=W.pageX.toFixed(2),ag=W.pageY.toFixed(2);var ah=Math.sqrt(Math.pow(ai-Q,2)+Math.pow(ag-O,2)).toFixed(2);var af=(ah-q)/100;var N=af>0?"add":"sub";if(Math.abs(af)>0.002){if(I==2&&C+af>I){return}I=C+af;if(I>=2){I=2}if(I<=1){I=1}var aj=$(".view-image"),ak=$("#view_img_box").outerWidth(),P=s.outerWidth()*I,Z=s.outerHeight()*I,ab=$("#view_img_box").outerHeight();if(Z<ab-41){y.y=0}var al="scale("+I+")";s.css({webkitTransform:al,transform:al,transformOrigin:y.x+"px "+y.y+"px",webkitTransformOrigin:y.x+"px "+y.y+"px"});var ad=aj.offset(),V=ad.left,S=H(ad.top);if(V>0&&I<2){J-=V}else{if(P+V<ak&&I<2){J+=(ak-(P+V))}}if(S>41){K-=(S-41)}else{if(Z+S<ab&&Z>ab+41){K+=(ab-(Z+S))}}aj.css({left:J,top:K})}G=0}}};viewImageListenerEnd=function(){z=new Date().valueOf();J+=A;K+=x;A=0;x=0;if(u==0){if(z-E<400){F()}}else{if(u==1){q=0;C=I}}u=0;s[0].removeEventListener("touchmove",viewImageListenerMove,false)},s[0].addEventListener("touchstart",viewImageListenerStart,false);s[0].addEventListener("touchmove",viewImageListenerMove,false);s[0].addEventListener("touchend",viewImageListenerEnd,false);function F(){if(typeof w!="undefined"){window.clearTimeout(w)}G++;if(G>1){$(".view-image").addClass("dbclick");if(I==2){I=1;var N="scale("+I+")";$(".view-image").css({webkitTransform:N,transform:N,top:0,left:0});J=0;K=0}else{I=2;var N="scale("+I+")",P=s.outerHeight()*I,O=$("#view_img_box").outerHeight();if(P<O-41){y.y=0}else{if(P-y.y+41<O){y.y-=O-(P-y.y+41)}}s.css({webkitTransform:N,transform:N,transformOrigin:y.x+"px "+y.y+"px",webkitTransformOrigin:y.x+"px "+y.y+"px"})}G=0;C=I}w=setTimeout(function(){G=0;$(".view-image").removeClass("dbclick")},400)}function H(P){if(typeof P=="string"||typeof P=="number"){var O=$(document).scrollTop()||0;if(O>0){var N=P-O;return N}else{return P}}}$(".view_box_close").off("mousedown.close").on("mousedown.close",function(N){N.stopPropagation();v.closePreviewImg()})},closePreviewImg:function(){var q=$("#view_img_box");q.css({transform:"scale(.2)",webkitTransform:"scale(.2)",opacity:0});setTimeout(function(){q.remove()},500)}},previewImage:{data:{imgUrl:"",imgW:0,imgH:0,scale:100,scaleMin:10,scaleMax:500,scaleInt:15,translateX:0,translateY:0,clientWidth:0,clientHeight:0,zoomNoticeTimeIdx:0,imageShow:false},init:function(s){if(!s){$.showTip("图片打开失败",2500);return}var v=this,t=this.data,u=$("#img-preview");if(u.length==0){var q='<div id="img-preview"><div class="image-container"><img class="current-image" src="" alt=""></div><div class="zoom-ratio-notice">100%</div><div class="bottom-tool"><div class="tool-item zoom-in" title="放大" title_pos="top"><span class="ol-icons">&#xe69d;</span></div><div class="tool-item zoom-out" title="缩小" title_pos="top"><span class="ol-icons">&#xe6a5;</span></div><div class="tool-item zoom-size-adapt" title="实际大小" title_pos="top"><span class="ol-icons">&#xe698;</span></div></div><div class="close-btn" title="关闭"><span class="ol-icons">&#xe622;</span></div></div>';u=$(q).appendTo($("body"))}var r=u.find(".current-image")[0];t.imageShow=true;t.scale=100;t.translateX=0;t.translateY=0;t.imgUrl=s;r.src=s;r.onload=function(){if(t.imageShow){t.imgW=r.width;t.imgH=r.height;v.imgInit();u.show()}};r.onerror=function(){if(t.imageShow){$.showTip("图片打开失败",2500)}};u.off("mousedown").on("mousedown",function(w){w.stopPropagation()});$("#img-preview .current-image").off("mousedown").on("mousedown",function(B){B.stopPropagation();var z=v.data,C=z.translateX,A=z.translateY,w=B.pageX,D=B.pageY;$(document).off("mousemove.imgPreview").on("mousemove.imgPreview",function(E){E.stopPropagation();var x=E.pageX,y=E.pageY;z.translateX=Math.round(C+(x-w));z.translateY=Math.round(A+(y-D));v.setChange()});$(document).off("mouseup.imgPreview").on("mouseup.imgPreview",function(x){$(document).off("mousemove.imgPreview");$(document).off("mouseup.imgPreview")})});u.off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(x){var w=x.originalEvent.wheelDelta||-x.originalEvent.detail;var y=Math.max(-1,Math.min(1,w));x.preventDefault();if(y<0){v.zoomFn(-1)}else{v.zoomFn(1)}return false});$("#img-preview .bottom-tool").off("click").on("click",".tool-item",function(){if($(this).hasClass("zoom-in")){v.zoomFn(1);return}if($(this).hasClass("zoom-out")){v.zoomFn(-1);return}if($(this).hasClass("zoom-size-adapt")){v.zoomFn(0)}});$("#img-preview .close-btn").off("click").on("click",function(){t.imageShow=false;u.hide();r.src=""})},zoomFn:function(t){var u=this.data,w=u.scale,v=Math.floor((u.scale-100)/u.scaleInt)+t,r=u.scaleInt*v+100;if(t===0){u.scale=100;u.translateX=0;u.translateY=0}else{u.scale=r<u.scaleMin?u.scaleMin:r>u.scaleMax?u.scaleMax:r;var q=Math.round(u.imgW*u.scale/100),s=Math.round(u.imgH*u.scale/100);u.clientWidth=$(document).width();u.clientHeight=$(document).height();if(q>u.clientWidth){u.translateX=u.translateX-Math.round(u.imgW*(u.scale-w)/200)}if(s>u.clientHeight){u.translateY=u.translateY-Math.round(u.imgH*(u.scale-w)/200)}}this.zoomNotice();this.setChange()},setChange:function(){var u=this.data,q=Math.round(u.imgW*u.scale/100),s=Math.round(u.imgH*u.scale/100);u.clientWidth=$(document).width();u.clientHeight=$(document).height();var t=q>u.clientWidth?(q-u.clientWidth):0,r=s>u.clientHeight?(s-u.clientHeight):0;if(t||r){$("#img-preview .current-image").addClass("move")}else{$("#img-preview .current-image").removeClass("move")}u.translateX=u.translateX>0?0:u.translateX<-t?-t:u.translateX;u.translateY=u.translateY>0?0:u.translateY<-r?-r:u.translateY;$("#img-preview .current-image").css({width:q,height:s,});$("#img-preview .image-container").css({width:q,height:s,left:u.translateX,top:u.translateY})},imgInit:function(){var q=this.data;q.clientWidth=$(document).width();q.clientHeight=$(document).height();if(q.imgW>q.clientWidth||q.imgH>q.clientHeight){q.scale=Math.round(100*Math.min(q.clientWidth/q.imgW,q.clientHeight/q.imgH))}this.setChange()},zoomNotice:function(){var r=$("#img-preview .zoom-ratio-notice"),q=this.data.scale+"%";if(r.is(":visible")){clearTimeout(this.data.zoomNoticeTimeIdx)}r.html(q).show();this.data.zoomNoticeTimeIdx=setTimeout(function(){r.hide()},1000)}},initEvent:function(){var s=this;var q=j.isSafari();document.oncontextmenu=function(v){$(document).off("mouseup.select");$(document).off("mousemove.select")};$("#outline").off("scroll.global").on("scroll.global",function(w){var v=$(this).scrollTop();n=v;b.hideMenu();$("#mind-icons-box").remove();w.stopPropagation();w.preventDefault()});$(o).off("click.fold").on("click.fold",".node-icons span[ico]",function(z){z.stopPropagation();z.preventDefault();var y=$(this),C=(y.attr("n")==null)?"":y.attr("n"),B=y.parents(".node-self").parent().attr("id"),v=y.attr("ico"),A=y.text(),w=y.attr("iconimg");var x={name:C,index:v,text:A};if(w){x.url=w}if(B){j.currentId=B}h.setIcons.currentIcon=x;h.showIconsMenu(x,y)});$(o).off("mousedown.global").on("mousedown.global",function(y){var x=$(y.target);if(!x.hasClass("mask")){b.removeImgOpt()}if(opts.readOnly){y.stopPropagation();if(!x.hasClass("node-state")){return}}$(".node-element").removeClass("selected");j.selectedIds=[];if(x.hasClass("outline-title")){x.off("blur").on("blur",function(C){var B=x.text();B=B.replace(/\n/g,"<br>").replace(/\&lt;br\&gt;/g,"<br>");h.changeTitle(B)});x.off("focus").on("focus",function(B){b.hideMenu()});x.off("keydown").on("keydown",function(B){B.stopPropagation();if(B.keyCode==13){B.preventDefault();x.trigger("blur")}})}else{if(x.parents(".designer-outline-title").length){x.off("blur").on("blur",function(H){var B=x.parents(".designer-outline-title");var E=B.find(".equation-text");if(E.length>0){var G=x.html();G=g.equation.equationHtml(E,G)}else{var G=x.text();G=j.filterXss(G)}G=G.replace(/\n/g,"<br>").replace(/\&lt;br\&gt;/g,"<br>");var I=B.attr("id");var C=i.getNodeById(I);if(C.title==G||C==null){return}var D=j.copy(C);C.title=G;if(I=="root"){$("#"+I).children().text(G);h.saveTitle(G,"from_root")}else{var F=$(".outline-nav").find("[nodeid="+I+"]");F.html(G)}h.update("title",[C],[D])});x.off("focus").on("focus",function(B){b.hideMenu()});x.off("keydown").on("keydown",function(B){B.stopPropagation();if(B.keyCode==13){B.preventDefault();x.trigger("blur")}})}else{if(x.hasClass("node-nav-title")){var A=x.attr("nodeId");if(!x.hasClass("select")){h.focusNode(A)}$(".outline-nav-m2").hide()}else{if(x[0].tagName.toLowerCase()=="img"&&!x.hasClass("copyimg")){if(!x.parent().hasClass("node-image")){return}if(x.hasClass("imageZoom")){}else{b.renderImgOpt(x.parent())}}else{if(x.hasClass("img-btn,del")){}else{if(x.hasClass("mask")||x.hasClass("copyimg")){}else{if(x.hasClass("node-title")){}else{if(x.hasClass("opmenu-open-icon")){y.stopPropagation();var A=x.parents(".node-self").parent().attr("id");j.currentId=A;if($(".op-context-menu").css("display")=="none"){h.initMenuBtnStatus([A],x);poCollect("弹窗展示",{"弹窗名称":"节点编辑下拉菜单","触发位置":"","当前页面":"outline-editor"});return}}else{if(x.hasClass("tag")){var v=x.clone();v.find("span.equation-text").remove();var z=v.html();$("#outline_search_input").focus().val(z);$("#outline_search_input").next(".del-icon").show();h.searchNode.filtrateNodes(z)}else{if(x.hasClass("node-state")){y.stopPropagation();y.preventDefault();var w=x.parents(".node-self").parent(),A=w.attr("id");h.toggleChilren(A)}}}}}}}}}}if($(".op-context-menu").css("display")=="block"){b.hideMenu()}});g.eventInit();$(o).off("mouseover.img").on("mouseover.img",".node-image",function(v){b.renderImgOpt($(this),"hover")});$(o).off("mouseout.img").on("mouseout.img",".node-image",function(v){v.stopPropagation();b.removeImgOpt($(this),"hover")});$(o).off("mousedown.imgdel").on("mousedown.imgdel",".img-op-del",function(x){x.stopPropagation();var y=$(this).parents(".node-element").attr("id"),v=i.getNodeById(y),w=j.copy(v);if((v.type&&(v.type=="flow"||v.type=="mind"))||!v.title){h.removeByIds([y]);return}delete (v.image);s.update("image",[v],[w]);$("#mind_hover_tip").hide()});$(o).off("mousedown.imgedit").on("mousedown.imgedit",".img-op-edit",function(A){A.stopPropagation();var z=$(this).parents(".node-element"),B=z.attr("id"),x=i.getNodeById(B),y=j.copy(x);if((x.type&&(x.type=="flow"||x.type=="mind"))){var v=z.data("chartid"),w=z.attr("type");g.mindflow.popEditor(v,w,B);poCollect("功能触发",{"功能名称":"编辑流程图、脑图","触发位置":"图片右侧编辑按钮","类型":w,"当前页面":"outline-editor"});return}$("#mind_hover_tip").hide()});$(o).off("mousedown.imgfresh").on("mousedown.imgfresh",".img-op-fresh",function(A){A.stopPropagation();var z=$(this).parents(".node-element"),B=z.attr("id"),x=i.getNodeById(B),y=j.copy(x);if((x.type&&(x.type=="flow"||x.type=="mind"))){if($(".node-image.loading").length>0){$.showTip("正在更新图片……",2000,"top");return}var v=z.data("chartid"),w=z.attr("type");g.mindflow.showUpdateSVGLoading(v,B);g.mindflow.updateFileImage(v,w,B,"fresh");poCollect("功能触发",{"功能名称":"刷新流程图、脑图图片","触发位置":"图片右侧刷新按钮","类型":w,"当前页面":"outline-editor"});return}$("#mind_hover_tip").hide()});j.dblclick(".node-image>img","preview",function(w){var v=$(w.target);if(v.hasClass("imageZoom")){}else{h.previewImage.init(v.attr("src"))}});l.onbeforeunload=function(v){d.doSend()};var r=$("body");r.off("mousedown.dot",".node-type.dot").on("mousedown.dot",".node-type.dot",function(G){G.stopPropagation();var E=B();var v=null;var I=G.pageX,F=G.pageY;var H=null;var w=null;var D=j.selectIds();if(!D||D.length<2){var K=$(this).parent().parent();var J=K.attr("id"),C=false;$("#"+J).find("div[contenteditable=true]").trigger("blur");var z=D=[J]}else{var z=j.selectIds("nochild")}b.hideMenu();h.setNodeDomDisabled(z);r.on("mousemove.dot",function(N){if(opts.readOnly){return}var y=N.pageX,L=N.pageY;if(Math.abs(y-I)>3||Math.abs(L-F)>3){if(H==null){$(".util-container").append("<div class='moving-line'></div><div class='moving-dot'></div>");H=$(".util-container").children(".moving-line");w=$(".util-container").children(".moving-dot")}C=true;w.css({left:y+40,top:L});$("[contenteditable=true]").addClass("not-user-select");$.each(E,function(O,P){if(L>P.y&&L<P.y+P.h){if(L<=P.y+P.h/2){v={id:P.id,pos:"up"}}else{v={id:P.id,pos:"down"}}return false}});if(!v){return}var M=$("#"+v.id),x=M.children(".node-self");if(M.hasClass("disable")||M.parents(".node-element").hasClass("disable")){$(".util-container").children(".moving-line").hide();v="self";return}$(".util-container").children(".moving-line").show();if(v!=null&&v.pos=="up"){H.css({top:x.offset().top,width:x.width()-26,left:x.offset().left+13})}else{if(v!=null&&v.pos=="down"){H.css({top:x.offset().top+x.height(),width:x.width()-26,left:x.offset().left+13})}}}});$(o).on("mouseup.dot",function(x){x.stopPropagation();$(o).off("mouseup.dot");r.off("mousemove.dot");$(".util-container").children(".moving-line").remove();$(".util-container").children(".moving-dot").remove();H=null;w=null;$(".not-user-select").removeClass("not-user-select");E=[];if(C&&v){if(v!="self"){var y=$("#"+v.id);if(y.hasClass("disable")){h.setNodeDomEnabled(z);return}A(v);poCollect("功能触发",{"功能名称":"移动节点","触发位置":"节点前原点拖动","当前页面":"outline-editor"})}}else{h.focusNode(z[0]);poCollect("功能触发",{"功能名称":"聚焦节点","触发位置":"节点前原点","当前页面":"outline-editor"})}h.setNodeDomEnabled(z)});function A(y){if(y==null||z==null||z.length==0){return}var x={};z.forEach(function(M,L){var N=h.getCurNodePosition(M);x[M]={id:N.id,pos:N.pos}});h.moveNode(z,y,x)}function B(){var Q=[];var M=$(p).find(".node-self:visible");for(var L=0,x=M.length;L<x;L++){var O=$(M[L]),N=O.parent(),P=N.attr("id");Q.push({id:P,y:O.offset().top,h:O.height()})}return Q}});$(document).off("mousedown.select").on("mousedown.select",function(x){var D=$(x.target);if(!D.attr("contenteditable")&&!D.hasClass("node-remark")){$(document).off("mouseup.select");$(document).off("mousemove.select");return}var B=x.pageY+n,z=D.offset(),w=D.outerHeight(),A=z.top+n,E=false,v=false,C=w+A;$(document).off("mousemove.select").on("mousemove.select",function(F){var y=F.pageY+n;v=y>C?true:false;E=y<A?true:false;if(E||v){j.selectElementsByRange(B,y,E,v,n);j.unSelectText()}else{$(".node-element").removeClass("selected")}});$(document).off("mouseup.select").on("mouseup.select",function(F){var y=j.selectIds();if(y&&y.length>1){h.initMenuBtnStatus(y);document.activeElement.blur()}$(document).off("mouseup.select");$(document).off("mousemove.select")})});$(o).off("keydown.global").on("keydown.global",function(E){var w=E.keyCode;$(".not-user-select").removeClass("not-user-select");if((E.ctrlKey||E.metaKey)&&w==90){E.preventDefault();d.undo()}else{if((E.ctrlKey||E.metaKey)&&w==89){E.preventDefault();d.redo();s.isUndo=true}else{if((E.ctrlKey||E.metaKey)&&E.shiftKey&&w==8){var v=j.selectIds("nochild");if(v&&v.length>0){h.removeByIds(v);b.hideMenu()}poCollect("功能触发",{"功能名称":"删除节点","触发位置":"快捷键Ctrl+Shift+BackSpace","当前页面":"outline-editor"});E.preventDefault()}else{if((E.ctrlKey||E.metaKey)&&w==67){var B=j.selectIds("withoutFocus_nochild");h.doCopy(B)}else{if((E.ctrlKey||E.metaKey)&&w==88){var B=j.selectIds("withoutFocus_nochild");h.doCut(B);b.hideMenu()}else{if(w==221&&(E.ctrlKey||E.metaKey)){E.preventDefault();var v=j.selectIds("nochild");if(v&&v.length>0){h.indentByIds(v)}}else{if(w==219&&(E.ctrlKey||E.metaKey)){E.preventDefault();var v=j.selectIds("nochild");if(v&&v.length>0){h.unIndentByIds(v)}}else{if((w==188||w==190)&&(E.ctrlKey||E.metaKey)){E.preventDefault();var G=null;var v=j.selectIds("nochild");if(!v||v.length<1){var z=$(document.activeElement);if(z.hasClass("node-title")){var y=z.parent().parent(".node-element");if(y&&y.length>0){v.push(y.attr("id"))}}}if(v.length<0){return}if(v.length>1){$.showTip("选中多个节点不能进入聚焦",2000,"top");return}G=v[0];h.focusNode(G)}else{if(w==9){E.preventDefault();var v=j.selectIds("nochild");if(!v||v.length<1){return}if(E.shiftKey){h.unIndentByIds(v)}else{h.indentByIds(v)}}else{if((E.ctrlKey||E.metaKey)&&w==83){E.preventDefault()}else{if((E.ctrlKey||E.metaKey)&&w==191&&!E.shiftKey){var v=j.selectIds("nochild");if(v&&v.length==1){h.toggleChilren(v[0])}E.preventDefault()}else{if(w==46){if($(".node-element.selected").length<1){return}var v=j.selectIds("nochild");if(v&&v.length>0){h.removeByIds(v);b.hideMenu()}poCollect("功能触发",{"功能名称":"删除节点","触发位置":"快捷键delete","当前页面":"outline-editor"});E.preventDefault()}else{if((E.ctrlKey||E.metaKey)&&E.shiftKey&&w==191){E.stopPropagation();E.preventDefault();h.catalog.init()}else{if(!(E.ctrlKey||E.metaKey||E.shiftKey)&&w==13){var F=$(".node-image.active");if(F.length>0){E.preventDefault();var J=F.parent(".node-element");if(J.length>0){b.removeImgOpt();var I=J.attr("id"),A=i.getPid(I),C=i.getNodeIndex(I,A),x=null;if(A=="root"){x=i.getRootSubPart(I)}var H=h.add(C,A,x);h.searchNode.includeByMark(H);$("#"+H).find(".node-title:first").focus();$("#outline").scrollTop(n+35);b.showMenu(H)}}}else{if((E.ctrlKey||E.metaKey)&&E.shiftKey&&w==77){E.stopPropagation();E.preventDefault();var v=j.selectIds("nochild");if(!v||v.length<1){var z=$(document.activeElement);if(z.hasClass("node-title")){var y=z.parent().parent(".node-element");if(y&&y.length>0){v.push(y.attr("id"))}}}if(v.length<0){return}if($(".op-context-menu").css("display")=="none"){var D=$("#"+v[0]).children(".node-self").find(".opmenu-open-icon");h.initMenuBtnStatus(v,D)}else{b.hideMenu()}}else{if((E.ctrlKey||E.metaKey)&&w==66){var v=j.selectIds();h.menuClick.setStyle(v,"font-weight",700)}else{if((E.ctrlKey||E.metaKey)&&w==73){var v=j.selectIds();h.menuClick.setStyle(v,"font-style","italic")}}}}}}}}}}}}}}}}}});var t=p.querySelector(".designer-outline-title");if(t){contenteditable=t.querySelector("[contenteditable=true]");if(contenteditable){contenteditable.addEventListener("paste",function(v){h.execPaste(v,"stringPaste");v.stopPropagation()})}}var u=document.querySelector(".outline-title");if(u){document.querySelector(".outline-title").addEventListener("paste",function(v){h.execPaste(v,"stringPaste");v.stopPropagation()})}$("[btn-click]").off("click").on("click",function(){var v=$(this).attr("btn-click");switch(v){case"undo":d.undo();break;case"redo":d.redo();break}})},initNoteEvent:function(q){$(q).off("blur").on("blur",function(s){var r=$(this);if(r.length==0){return}var u=r.parents(".node-element").eq(0).attr("id");var t=r.html();if(t==""||t=="<br>"){r.remove();h.setNote(u,{note:""});return}h.setNote(u,{note:t});q.classList.remove("active");r.css({height:17});j.removeTempDom();r.scrollTop(0);var r={event:"func_result",attributes:{result_name:"remarkssuccess"}};m.events.trigger("dataCollect",r)});$(q).off("keydown").on("keydown",function(s){var r=$(this),u=r.parents(".node-element").eq(0).attr("id");var t=r.html();if(s.keyCode==8||s.keyCode==46){var r=$(this),u=r.parent().attr("id");var t=r.text();if(t==""){r.remove();h.setNote(u,{note:""});return}}else{if(s.keyCode==13&&s.shiftKey){r.trigger("blur");h.focus(u);s.preventDefault();return}else{if(s.keyCode==13&&!s.shiftKey&&!s.ctrlKey){if(t.substring(t.length-4,t.length)!="<br>"){r.append("<br>")}j.setBrNode(r[0]);s.preventDefault()}}}});$(q).off("focus").on("focus",function(s){q.classList.add("active");var r=$(this);var t=r.html();t=t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br>").replace(/\&lt;br\&gt;/g,"<br>");r.css({height:"auto"})})},inputTimer:null,initNodeEvent:function(t){if(opts.readOnly){return}var r=t.querySelector("[contenteditable]");r.addEventListener("focus",function(w){var x=t.getAttribute("id");j.currentId=x;j.cursorToEnd(r)});r.addEventListener("keydown",function(aa){var x=aa.keyCode;var O=t.getAttribute("id");if(O==undefined){return}if(!(aa.ctrlKey||aa.metaKey||aa.shiftKey)&&x==13){var N=i.getPid(O);var E=i.getNodeIndex(O,N),U=null;if(N=="root"){U=i.getRootSubPart(O)}if(h.nodeEditing){aa.preventDefault();if(typeof newNodeTimer!="undefined"&&newNodeTimer){clearTimeout(newNodeTimer)}newNodeTimer=setTimeout(function(){h.nodeEditing=false},300);return}var Y=$("#"+O);if(Y.outerWidth()<60){$.showTip("剩余宽度不足无法新建节点",3000,"top");return}var G=u(r)[0];if(G==0){var z=h.add(E-1,N,U)}else{var z=h.add(E,N,U)}h.searchNode.includeByMark(z);$("#"+z).find(".node-title:first").focus();$("#outline").scrollTop(n+35);b.showMenu(z);aa.preventDefault()}else{if(x==13&&aa.shiftKey){var J=b.renderRemarkDom(O);h.initNoteEvent(J);h.searchNode.includeByMark(O);J.focus();aa.preventDefault()}else{if(x==13&&(aa.ctrlKey||aa.metaKey)){if(O!=""){var C=i.getNodeById(O),Z=C.task;if(Z&&Z.completion==100){h.setTasks([O],{task:""})}else{h.setTasks([O],{task:{completion:100}})}}}else{if(x==38&&((aa.ctrlKey||aa.metaKey)&&aa.shiftKey)){if(!O){return}var X=i.getNodeById(O);var w=i.getPreNode(O),P=i.getPrevOnly(O),D="down";if(P==null||P.id==O){P=i.getNextOnly(O),D="up"}if(P==null){P=i.getNodeById(X.parent);D="in"}if(w.id=="root"){return}var ad={id:w.id,pos:"up"};var R={};R[O]={id:P.id,pos:D};h.moveNode([O],ad,R)}else{if(x==40&&((aa.ctrlKey||aa.metaKey)&&aa.shiftKey)){if(!O){return}var X=i.getNodeById(O);var B=i.getNextNode(O);if(!B){if(X.parent=="root"){$.showTip("当前位置无法下移",2500,"top");return}B=i.getNodeById(X.parent)}var P=i.getPrevOnly(O),D="down";if(P==null){P=i.getNextOnly(O);D="up"}if(P==null){P=i.getNodeById(X.parent);D="in"}var ad={id:B.id,pos:"down"};var R={};R[O]={id:P.id,pos:D};h.moveNode([O],ad,R)}else{if((aa.keyCode==67||aa.keyCode==88)&&(aa.ctrlKey||aa.metaKey)){var L=window.getSelection().getRangeAt(0),Q=L.cloneContents().childNodes;if(Q.length>1||(Q.length==1&&Q[0].nodeType==1)){if(aa.keyCode==88){document.addEventListener("cut",y,true)}else{document.addEventListener("copy",y,true)}}function y(ah){var af=document.createElement("div");af.innerHTML='<div class="mind-clipboard"></div>';af.querySelector(".mind-clipboard").appendChild(L.cloneContents());var aj=af.innerHTML;var ai=af.cloneNode(true);var ag=$(ai).find(".equation-text");if(ag.length>0){ag.html(ag.data("equation"))}ah.clipboardData.setData("Text",$(ai).text());ah.clipboardData.setData("text/html",aj);if(aa.keyCode==88){window.getSelection().deleteFromDocument();document.removeEventListener("cut",y,true);if($(aj).find(".equation-text").length>0){$(r).find(".equation-text").each(function(ak,al){$(al).attr("data-index",ak)})}h.updateTitleOnInput(O,r.innerHTML,r)}else{document.removeEventListener("copy",y,true)}ah.preventDefault()}}else{if(x==37||x==39){var K=$(r);if(K.find(".equation-text").length>0){var V=window.getSelection();var L=V.getRangeAt(0);var I=document.createElement("span");I.className="equation-temp";L.insertNode(I);L.collapse(false);var ac=L.startContainer;var ab=ac.nodeType==1?ac:ac.parentNode;A(ab)}function A(ah){var ag=ah.childNodes;for(var af=0;af<ag.length;af++){if(ag[af].nodeType==3&&ag[af].nodeValue==""){ah.removeChild(ag[af])}}for(var af=0;af<ag.length;af++){if(ag[af].className=="equation-temp"){if(aa.keyCode==39){if(af==ag.length-1){F(ah)}else{if(ag[af+1].className=="equation-text"){g.equation.equationInit(K,$(ag[af+1]))}else{if(ag[af+1].nodeType==1){W(ag[af+1])}}}}else{if(af==0){F(ah)}else{if(ag[af-1].className=="equation-text"){g.equation.equationInit(K,$(ag[af-1]))}else{if(ag[af-1].nodeType==1){W(ag[af-1])}}}}K.find(".equation-temp").remove();break}}}function F(ag){var af=ag.parentNode;if(af.childNodes.length==1){F(af)}else{if(af.className!="node-self"){if(aa.keyCode==39){ag.after(I)}else{ag.before(I)}A(af)}}}function W(af){if(af.childNodes.length==1&&af.childNodes[0].className!="equation-text"){W(af.childNodes[0])}else{if(af.nodeType==1){if(aa.keyCode==39){af.insertBefore(I,af.childNodes[0])}else{af.appendChild(I)}A(af)}}}}else{if(x==8){var ae=r.innerHTML;if(i.page=="searchPage"){return}if(ae==""||ae=="<br>"){aa.preventDefault();aa.stopPropagation();var ab=o.getElementById(O);var T=[O];h.deleteNodeStatus=true;h.deleteNodeTimer&&clearTimeout(h.deleteNodeTimer);h.deleteNodeTimer=setTimeout(function(){h.deleteNodeStatus=false},500);h.removeByIds(T)}}else{if(x==38&&aa.shiftKey&&(!aa.ctrlKey||!aa.metaKey)){var H=i.getPrevByDom(O);if(H==null||H.length==0){return}var S=$(H).attr("id");if(!S){return}var T=j.selectedIds;if(T.indexOf(O)<0){T.push(O)}if(T.indexOf(S)<0){T.push(S)}j.unSelectAllNode();j.selectNodeByIds(T);h.initMenuBtnStatus(T);j.setCursorPosition(S);aa.preventDefault()}else{if(x==38&&(!aa.ctrlKey&&!aa.metaKey&&!aa.shiftKey)){var H=i.getPrevByDom(O);if(H==null||H.length==0){return}var S=$(H).attr("id");if(!S){return}j.setCursorPosition(S);aa.preventDefault()}else{if(x==39){}else{if(x==40&&aa.shiftKey&&(!aa.ctrlKey||!aa.metaKey)){var H=i.getNextByDom(O);if(H==null||H.length==0){return}var M=$(H).attr("id");if(!M){return}var T=j.selectedIds;if(T.indexOf(O)<0){T.push(O)}if(T.indexOf(M)<0){T.push(M)}j.unSelectAllNode();j.selectNodeByIds(T);h.initMenuBtnStatus(T);j.setCursorPosition(M)}else{if(x==40&&(!aa.ctrlKey&&!aa.metaKey&&!aa.shiftKey)){var H=i.getNextByDom(O);if(H==null||H.length==0){return}var M=$(H).attr("id");if(!M){return}j.setCursorPosition(M)}else{if((aa.ctrlKey||aa.metaKey)&&x==86){}else{if((aa.ctrlKey||aa.metaKey)&&aa.shiftKey&&x==8){aa.preventDefault}}}}}}}}}}}}}}}});r.addEventListener("paste",function(w){var x=t.getAttribute("id");h.execPaste(w,x);w.stopPropagation()});var s=0;$(r).on("compositionstart",function(){compositionstart_support=1;s="start"});$(r).on("compositionend",function(){if(s=="start"){s="end";q(r,t)}s=0});if(j.isIE()){r.addEventListener("onpropertychange",function(){for(var w=0;w<arguments.length;w++){console.log(arguments[w])}})}else{r.addEventListener("input",function(x){var w=/[a-zA-Z]/g;if(x.inputType=="insertCompositionText"&&x.data&&w.test(x.data)){return false}if(s=="start"||s=="end"){return}s="input";q(r,t,true)})}function q(w,y,B){if(h.inputTimer){clearTimeout(h.inputTimer)}var x=u(w);var z=w.textContent;z=z.replace(/</g,"&lt;");var A=h.getConvertTagRichText2.init(w.innerHTML);h.nodeEditing=true;if(B){setTimeout(function(){w.innerHTML=null;w.innerHTML=A;v(w,x);h.nodeEditing=false})}else{w.innerHTML=null;w.innerHTML=A;v(w,x);h.nodeEditing=false}h.inputTimer=setTimeout(function(){var C=y.getAttribute("id");$(w).find(".equation-text").attr("contenteditable",false);h.updateTitleOnInput(C,w.innerHTML,w)},1000);if(B){}}function u(y){var B=0;var x=0;var A=window,C=document,w;if(typeof A.getSelection!="undefined"){w=A.getSelection();if(w.rangeCount>0){var z=w.getRangeAt(0);var D=z.cloneRange();D.selectNodeContents(y);D.setEnd(z.endContainer,z.endOffset);x=D.toString().length;D.setEnd(z.startContainer,z.startOffset);B=D.toString().length}}else{if((w=C.selection)&&w.type!="Control"){var F=w.createRange();var E=C.body.createTextRange();E.moveToElementText(y);E.setEndPoint("EndToEnd",F);x=E.text.length;B=x-F.text.length}}return[B,x]}function v(B,C){var x=C[0];var D=C[1];!function(G){if(h.isSafari()||(F=navigator.platform||"",/(iPhone|iPod|iPad)/i.exec(F))){var E=window.getSelection(),H=document.createRange();if(E){return H.setStart(G,0),E.removeAllRanges(),E.addRange(H),void G.focus({preventScroll:!0})}}var F;G.focus({preventScroll:!0})}(B);var A=(B.textContent||"").length;if(!(0===A||D<0||D>A)){var y=function(H,L){var G={startNode:null,endNode:null,startOffset:0,endOffset:0};if(!H.textContent){return G}for(var E=0,F=h.inputTrace.getChildNodeList(H),J=F.length,I=0;I<J;I++){var M=F[I],K=M.textContent?M.textContent.length:0;if(x>=E&&x<=E+K){G.startNode=M;G.startOffset=x-E}if(L>=E&&L<=E+K){G.endNode=M,G.endOffset=L-E;break}E+=K}return G}(B,D);if(y.startNode&&y.endNode){var z=window.getSelection();if(z){var w=document.createRange();if(y.startOffset==y.endOffset&&y.startNode.parentNode&&y.startNode.parentNode.parentNode&&y.startNode.parentNode.parentNode.className=="equation-text"){w.setStartAfter(y.startNode.parentNode.parentNode)}else{w.setStart(y.startNode,y.startOffset);w.setEnd(y.endNode,y.endOffset)}z.removeAllRanges();z.addRange(w)}}}}r.addEventListener("blur",function(z){if($(".eq-editor").is(":visible")){return}if(h.isUndo){return}j.blurAdjust(r);$(document).off("scroll");if(b.iosAppHSupport){setTimeout(function(){if(b.appKeyBoardHeight+n!=parseInt($(".outline-m1").css("bottom"))){}else{if(b.appKeyBoardHeight==0){}}},100)}else{}if(h.deleteNodeStatus){return}var y=this,A=y.innerHTML,C=t.getAttribute("id");var B=$(y).find(".equation-text");if(B.length>0){A=g.equation.equationHtml(B,A)}A=A.replace(/\n/g,"<br>").replace(/\&lt;br\&gt;/g,"<br>");var w=i.getNodeById(C);if(w.title==A||w==null){return}var x=j.copy(w);w.title=A;h.update("title",[w],[x])})},nodeInputEventInit:function(q){var r=j.isChrome()},updateTitleOnInput:function(v,t,q){var u=$(q).find(".equation-text");if(u.length>0){t=g.equation.equationHtml(u,t)}t=t.replace(/\n/g,"<br>").replace(/\&lt;br\&gt;/g,"<br>");var r=i.getNodeById(v);if(!r||r.title==t){return}var s=j.copy(r);r.title=t;if(r.parent=="root"){h.catalog.updateCatalog("updateTitle",[v])}i.update();d.save({action:"update",content:{key:"title",nodes:[r],oldNodes:[s]}})},getConvertTagText:function(w){var s=w.split("");var v=[],u=[];for(var t=0,q=s.length;t<q;t++){var r=encodeURI(s[t]);if(((t>0&&(r=="%C2%A0"||r=="%20"))||t==q-1)&&v.length>0){if(t==q-1&&r!="%C2%A0"){v.push(s[t])}v.unshift('<span class="tag">');v.push("</span>");u.push(v.join(""));v=[];if(t!=q-1||r=="%C2%A0"){u.push(s[t])}continue}if(t>0&&(s[t]=="@"||s[t]=="#")&&s[t-1]==" "){v.push(s[t]);if(t==q-1){u.push(v.join(""));v=[]}continue}if(v.length==0){u.push(s[t])}else{v.push(s[t])}}var x=u.join("");u=[];return x||""},getConvertTagText2:function(s){var r=/ [@#]\S{1,}\s{1}/g;var q=/ [@#]\S{1,}/g;s=s.replace(r,function(t){if(t.length<3){return t}return t=' <span class="tag">'+t.substring(1,t.length-1)+"</span>&nbsp;"});s=s.replace(q,function(t){return t=' <span class="tag">'+t.substring(1)+"</span>"});return s||""},getConvertTagRichText2:{init:function(w){var r=/<span class="tag">\S+?<\/span>/g;var t=/(^|&nbsp;|\s)[@#]\S+?($|&nbsp;|\s)/g;var v=[];var u=$('<div id="tagRichText">'+w+"</div>").appendTo("body");u.find("span.equation-text").each(function(){v.push($(this).prop("outerHTML"));$(this).replaceWith("^equation-text^")});w=u.html();u.remove();w=w.replace(r,function(z){return z.replace(/(<span class="tag">|<\/span>)/g,"")});var y=$("<span/>").html(w).text();if(t.test(y)){var s=this.tagIdx(y),x=this.textList(w);var q=this.joinHtml(s,x);v.map(function(z){q=q.replace("^equation-text^",z)});return q}else{v.map(function(z){w=w.replace("^equation-text^",z)});return w}},tagIdx:function(w){var s=w.length;var v=w.split(/(&nbsp;|\s)+/).filter(function(x){return/^[@#]\S+?/g.test(x)});var u=w;var t=0;var r=0;var q=[];v.map(function(A,x){var z=u.indexOf(A)+t;var y=z+A.length;u=u.replace(A,"");t+=A.length;if(r<z){q.push({type:"text",idx:[r,z]})}q.push({type:"tag",idx:[z,y]});r=y;if(x===v.length-1&&y<s){q.push({type:"text",idx:[y,s]})}});return q},textList:function(t){var v=$('<div id="tagRichText">'+t+"</div>").appendTo("body");var s=v[0].style;var u={anchor:s.textAlign=="center"?"middle":s.textAlign=="right"?"end":"start",family:s.fontFamily,size:s.fontSize,width:s.width,fill:s.color,style:s.fontStyle,variant:s.fontVariant,weight:s.fontWeight,lineHeight:s.lineHeight||"140%"};v.find("font").each(function(){$(this).css("fill",$(this).attr("color"))});v.find("strong").css("font-weight","bold");v.find("b").css("font-weight","bold");v.find("em").css("font-style","italic");v.find("i").css("font-style","italic");v.find("u").css("text-decoration","underline");v.find("strike").css("text-decoration","line-through");v.find("h1").css({"font-weight":"bold","font-size":parseInt(u.size)*2+"px"});v.find("h2").css({"font-weight":"bold","font-size":parseInt(u.size)*1.5+"px"});v.find("h3").css({"font-weight":"bold","font-size":parseInt(u.size)*1.17+"px"});v.find("h4").css({"font-weight":"bold","font-size":parseInt(u.size)*1+"px"});v.find("h5").css({"font-weight":"bold","font-size":parseInt(u.size)*0.83+"px"});v.find("h6").css({"font-weight":"bold","font-size":parseInt(u.size)*0.67+"px"});var r=[];function q(x){for(var z=0,w=x.length;z<w;z++){if(x[z].nodeName=="#text"){for(var y=0;y<x[z].data.length;y++){if(x[z].parentNode.nodeName=="DIV"){var A={text:x[z].data[y].replace(/ /g,"&nbsp;"),style:""}}else{var A={text:x[z].data[y].replace(/ /g,"&nbsp;"),style:x[z].parentNode.getAttribute("style")}}r.push(A)}}else{if(x[z].nodeName=="BR"){if(z>0&&x[z-1].nodeName=="DIV"){var A={text:"</br>",style:""};r.push(A)}var A={text:"</br>",style:""};r.push(A)}else{if(x[z].nodeName=="DIV"||x[z].nodeName=="LI"||x[z].nodeName.indexOf("H")>=0||x[z].nodeName=="P"){if(r.length>0&&r[r.length-1].text!="</br>"){var A={text:"</br>",style:""};r.push(A)}}else{if(x[z].parentNode.nodeName=="DIV"){if(typeof x[z].getAttribute=="function"){x[z].setAttribute("style",x[z].getAttribute("style"))}}else{if(x[z].parentNode.getAttribute("style")==null){x[z].setAttribute("style",x[z].getAttribute("style"))}else{x[z].setAttribute("style",x[z].parentNode.getAttribute("style")+x[z].getAttribute("style"))}}}}}q(x[z].childNodes)}}q(v[0].childNodes);v.remove();return r},joinHtml:function(q,t){var s=this;var r=q.map(function(u){if(u.type=="tag"){return s.joinTag(t.slice(u.idx[0],u.idx[1]))}else{return s.joinRich(t.slice(u.idx[0],u.idx[1]))}}).join("");return r},joinRich:function(q){var r=this;return q.map(function(v,t){var w=v.text,u=v.style;if(/(&nbsp;|\s)/.test(w)){return w}if(t<q.length-1){var s=q[t+1];if(u==s.style&&!/(&nbsp;|\s)/.test(s.text)){s.text=w+s.text;v.text="";return""}}u=r.styleObj(u);if(u["text-decoration-through"]){w="<strike>"+w+"</strike>"}if(u["text-decoration-under"]){w="<u>"+w+"</u>"}if(u["font-style"]=="italic"){w="<i>"+w+"</i>"}else{if(u["font-style"]=="normal"){w='<span style="font-style:normal;">'+w+"</span>"}}if(u.fill){w='<font color="'+r.colorRGBtoHex(u.fill)+'">'+w+"</font>"}if(u["font-weight"]=="bold"){w="<b>"+w+"</b>"}else{if(u["font-weight"]=="normal"){w='<span style="font-weight: normal;">'+w+"</span>"}}return w}).join("")},joinTag:function(q){var r=q.map(function(s){return s.text}).join("");return'<span class="tag">'+r+"</span>"},styleObj:function(r){var q={};if(r){r.split(";").map(function(t){t=t.replace(/\s/g,"");if(t){var s=t.split(":")[0];var u=t.split(":")[1];if(s=="text-decoration"&&u=="underline"){s+="-under"}else{if(s=="text-decoration"&&u=="line-through"){s+="-through"}}q[s]=u}})}return q},colorRGBtoHex:function(s){if(s&&/rgb/.test(s)){var t=s.split(",");var w=parseInt(t[0].split("(")[1]);var v=parseInt(t[1]);var q=parseInt(t[2].split(")")[0]);var u="#"+((1<<24)+(w<<16)+(v<<8)+q).toString(16).substring(1);return u}if(s&&/#/.test(s)){return s}return"#000000"},removeRichStyle:function(u,q,t){var s=$("#"+u).find(".node-title"),r=s.html();switch(q){case"font-weight":r=r.replace(/<\/?b.*?>/g,"");r=r.replace(/<span.*?font-weight.*?>.*?<\/span>/g,function(v){return v.replace(/(<\/?span.*?>)/g,"")});break;case"font-style":r=r.replace(/<\/?i.*?>/g,"");r=r.replace(/<span.*?font-style.*?>.*?<\/span>/g,function(v){return v.replace(/(<\/?span.*?>)/g,"")});break;case"text-decoration":if(t=="underline"){r=r.replace(/<\/?u.*?>/g,"")}else{if(t=="underline"){r=r.replace(/<\/?strike.*?>/g,"")}}break;case"color":r=r.replace(/<\/?font.*?>/g,"");break}return r},},getConvertTagRichText:function(w){var s=w.split("");var v=[],u=[];for(var t=0,q=s.length;t<q;t++){var r=encodeURI(s[t]);if(((t>0&&r=="%C2%A0")||t==q-1)&&v.length>0){if(t==q-1&&r!="%C2%A0"){v.push(s[t])}v.unshift('<span class="tag">');v.push("</span>");u.push(v.join(""));v=[];if(t!=q-1||r=="%C2%A0"){u.push(s[t])}continue}if(t>0&&(s[t]=="@"||s[t]=="#")&&s[t-1]==" "){v.push(s[t]);if(t==q-1){u.push(v.join(""));v=[]}continue}if(v.length==0){u.push(s[t])}else{v.push(s[t])}}var x=u.join("");u=[];return x||""},isSafari:function(){var q=navigator.userAgent||"";return !((navigator.userAgent||"").indexOf("Chrome/")>-1)&&q.indexOf("Safari/")>-1},inputTrace:{init:function(){},getChildNodeList:function(x){var w=this;for(var u=[],r=x.childNodes,q=r?r.length:0,s=0;s<q;s++){var v=r[s];v.nodeType===Node.TEXT_NODE?u.push(v):v.hasChildNodes()&&u.push.apply(u,w.getChildNodeList(v))}return u},getCursorPos:function(s){var r=0;var u=window,v=document,q;if(typeof u.getSelection!="undefined"){q=u.getSelection();if(q.rangeCount>0){var t=q.getRangeAt(0);var w=t.cloneRange();w.selectNodeContents(s);w.setEnd(t.endContainer,t.endOffset);r=w.toString().length}}else{if((q=v.selection)&&q.type!="Control"){var y=q.createRange();var x=v.body.createTextRange();x.moveToElementText(s);x.setEndPoint("EndToEnd",y);r=x.text.length}}return r}},setTopToolOnReadonly:function(){if(!opts.readOnly){return}$(".outline-head").hide();$("body").removeClass("readonly").addClass("readonly")},searchNode:{init:function(){if(opts.readOnly){return}var q=0,s=null;var r=this,u=$(".outline_search"),t=$("#outline_search_input");t.off("focus.header-search").on("focus.header-search",function(v){v.stopPropagation();u.addClass("focus")}).on("blur.header-search",function(v){if(t.val()==""){u.removeClass("focus")}});t.off("input").on("input",function(x){var w=$(this);s=null;var v=j.filterXss(w.val().trim());if(v!=""){w.next().show()}else{w.next().hide()}q=x.timeStamp;s=setTimeout(function(){if(q==x.timeStamp){r.filtrateNodes(v);if(!r.searchZhugeRecord){poCollect("功能触发",{"功能名称":"搜索节点","触发位置":"顶部-搜索框","当前页面":"outline-editor"});r.searchZhugeRecord=true}}},400)});t.next(".del-icon").off("mousedown.del").on("mousedown.del",function(){$(p).html("");i.page="homePage";if(e!=null){var v=i.focusInfo.state;if(v==false){h.renderAll()}else{var w=v.id||"root";h.focusNode(w)}u.removeClass("focus")}t.val("");$(this).hide()});if(typeof bigPipe!="undefined"&&bigPipe){bigPipe.render({js:["/assets/js/plugs/jquery.mark.min.js"]},function(){})}},searchZhugeRecord:false,clearSearch:function(){var q=$("#outline_search_input"),r=q.val();if(r.length>0){$(".outline_search.focus").removeClass("focus");q.val("").next(".del-icon").eq(0).hide()}},_searchNode:function(s,v){var u=this;$(p).children(".node-element.wider, p").remove();if(JSON.stringify(s)!="{}"){var q=[];var w=i.focusInfo.state.id||"root";i.page="searchPage";for(key in s){if(s[key]&&s[key].parent==w){q.push(s[key])}}function t(B){if(B.length==0){return}var A=0;for(var z=0,x=B.length;z<x;z++){var C=B[z],D=C.id;if(s[D]){h.addNodeDom(C,A);if((C.title&&C.title.indexOf(v)>-1)||(C.note&&C.note.indexOf(v)>-1)){u.includeByMark(D,v)}A++}if(C.collapsed){continue}if(C.children.length>0){var y=C.children;t(y);if(C.mode=="board"&&h.isViewBoad(C.id)){b.boardViewNewChildBtn(C)}}}}if(q.length>0){t(q)}}else{var r=o.createElement("p");r.innerHTML="暂无结果";r.style.color="#666666";r.style.paddingLeft="20px";p.appendChild(r)}},includeByMark:function(u,t){var s=j.getNodeDom(u);var q=t||$("#outline_search_input").val();if(!q){return}var r=s.find(".node-title, textarea");r.highlightTextarea({words:[q],color:"#F7DD5D"})},filtrateNodes:function(t){var y={};if(i.focusInfo.state==false){var v=i.nodeList}else{var v=i.focusInfo.focusDataList}var q=j.resetDataList(v);if(t&&t.length>0){var x=i.focusInfo.state.id||"root";for(var w=0;w<q.length;w++){if(A(q[w],t)&&q[w].id!=x){if(i.searchDataList.indexOf(q[w].id)==-1){i.searchDataList.push(q[w].id)}if(y[q[w].id]==null){y[q[w].id]=q[w]}if(q[w].parent!=x){function s(B){if(B.title.indexOf(t)==-1){if(!y[B.id]){y[B.id]=B}}if(B.parent==x){return}var C=i.getNodeById(B.parent);if(B.parent&&B.parent!=x&&C){s(C)}}var u=i.getNodeById(q[w].parent);if(u){s(u)}}}}this._searchNode(y,t);function A(C,E){var B=$("#search-temp");if(B.length<1){B=$("<div id='search-temp' style='position: absolute;display:none;'>"+C.title+"</div>").css("z-index","-1").appendTo("body")}else{B.html(C.title).find("span.equation-text").remove()}var D=B.text();if((D&&D.indexOf(E)>-1)||(C.note&&C.note.indexOf(E)>-1)){return true}return false}}else{$(p).html("");i.page="homePage";if(e!=null){var z=i.focusInfo.state;if(z==false){h.renderAll()}else{var r=z.id||"root";h.focusNode(r)}}}}},showIconsMenu:function(x,u){if(opts.readOnly){return}var s=this.setIcons;$("#mind-icons-box").remove();var q=$("<div id='mind-icons-box'></div>").appendTo("body");var r=s.icons;var y=r[x.name];var v=false;if(x.url){y=s.docerIcon}t(y,u);function z(A){$(document).off("mouseup.icons").on("mouseup.icons",function(B){$("#mind-icons-box").remove();A.removeClass("selected")});$(document).on("mouseup.icons","#mind-icons-box",function(B){B.stopPropagation()});$(document).on("mousedown.icons","#mind-icons-box",function(B){B.stopPropagation()});$(document).off("click.icons").on("click.icons","#mind-icons-box .mind-icons",function(D){var E=$(this);if(E.attr("remove")){s.removeIcon();q.remove()}else{s.setIcon.call(m,E,true)}var C=A.attr("ico");var B=q.find("[ico="+C+"]");if(B.length&&!B.hasClass("selected")){q.remove()}poCollect("功能触发",{"功能名称":"添加图标","触发位置":"菜单-图标","图标名称":"","图标ico":C,"当前页面":"outline-editor"});D.stopPropagation()});$(document).off("click.iconcolors").on("click.iconcolors",".mind-icons-color span",function(C){var D=$(this),B=D.css("background-color");s.setIconColor(B);C.stopPropagation()})}function t(H,C){var E=["<div>"];for(var D=0,F=H.length;D<F;D++){var G=H[D];if(x.url){E.push(G)}else{E.push("<span n='"+x.name+"' ico='"+G.index+"' class='mind-icons'>"+G.text+"</span>")}}E.push("<span remove='true' style='color:#ff0000;' class='mind-icons'>&#xe60c;</span><span style='clear:both;'></span></div>");j.showPanel({target:C,panel:q,show:true});if(x.url){var I="none";E.push("<div style='clear:both;min-height:1px;'></div><div id='docer-menu-upgrade-btn' style='display: "+I+"' class='mind-button docer-upgrade-btn'><span class='mind-icons'>&#xe690;</span> 升级稻壳会员</div>")}else{E.push("<div style='clear:both;min-height:1px;'></div><div class='mind-icons-color'>");var A=j.baseColor();for(var D=0,F=A.length;D<F;D++){var B=A[D];E.push("<span style='background:"+B+";'></span>")}E.push("</div>")}q.html(E.join(""));w(x,q,C);z(C)}function w(B,A,C){A.find("span").removeClass("selected");if(B.name==""||B.url){C.parent().find("span[n=''],span[iconimg]").each(function(){var D=$(this);A.find("span[ico="+D.attr("ico")+"]").addClass("selected")})}else{A.find("span[ico="+B.index+"]").addClass("selected")}}},setIcons:{init:function(){var w=this;var u=j.selectIds();if(u.length){$("#mind-dock-right-icons").find("[ico]").removeClass("selected");for(var t=0;t<u.length;t++){var v=i.getNodeById(u[t]),s=v&&v.icons;if(s&&s.length>0){for(var r=0;r<s.length;r++){var q=s[r].index;$("#mind-dock-right-icons").find("[ico="+q+"]").addClass("selected")}}}}$(document).off("mousedown.icons").on("mousedown.icons","#mind-dock-right-icons",function(y){y.stopPropagation();y.preventDefault();if(!$(y.target).hasClass("mind-icons")){return}var z=$(y.target);if(z.attr("remove")){w.removeIcon()}else{var A=z.attr("n");var x=null;if(z.css("color")!=null){x=z.css("color")}w.setIcon(z,null,x)}})},renderTopicIcons:function(r){if(r.icons){var E=r.icons,y=this,D=y.icons;var u=j.getNodeDom(r.id);var z=u.children(".node-self");var t=z.children(".node-icons");if(t.length){t.children().remove()}else{t=$("<span class='node-icons'></span>");z.find(".node-title").before(t)}var w="";for(var v=0,x=E.length;v<x;v++){var B=E[v];if(B==null){continue}if(!B.url){var q=D[B.name];if(q==null){continue}var A=y.getIcon(q,B.index);if(A==null){continue}var C=B.color||"";if(B.color=="rgb(43, 48, 51)"&&opts.config.themeMode=="dark"){C="rgba(255, 255, 255, 0.87)"}if(B.color=="rgba(255, 255, 255, 0.87)"&&opts.config.themeMode=="light"){C="rgb(43, 48, 51)"}var s=C?"style='color:"+C+"'":"";w+="<span n='"+B.name+"' ico='"+B.index+"' "+s+" class='mind-icons'>"+A.text+"</span>"}else{w+="<span n='"+B.name+"' ico='"+B.index+"' iconimg='"+B.url+"' class='mind-icon-url mind-icons'><img src='"+B.url+"' /></span>"}}t.html(w);if(w==""){t.remove()}t.width(x*25.1)}else{var u=j.getNodeDom(r.id);var z=u.children(".node-self");var t=z.children(".node-icons");if(t.length){t.remove()}}},currentIcon:{},setIcon:function(K,L,E,s){var t=this;var y=K.attr("ico"),x=K.text(),B=K.attr("n")==null?"":K.attr("n");var M={index:y,name:B};if(s){M.url=s}if(E!=null){M.color=E}else{if(t.currentIcon!=null&&t.currentIcon.color!=null&&t.currentIcon.name==M.name){M.color=t.currentIcon.color}}var C=j.selectIds();if(C.length==0||M.index==""||M.index==null){return}var H=[],z=[];for(var F=0,u=C.length;F<u;F++){var A=C[F];var D=i.getNodeById(A),r=j.copy(D);z.push(r);if(D.icons==null){D.icons=[]}var q=D.icons,y=-1,J=-1,w=false;for(var G=0,I=q.length;G<I;G++){var v=q[G];if(M.index==v.index){J=G;break}else{if(v.name==M.name&&M.name!=""){y=G;break}}}if(y>=0){D.icons.splice(y,1,M)}else{if(J>=0){D.icons.splice(J,1);w=true}else{D.icons.push(M)}}if(L!=null){D.task=$.extend(D.task,L)}if(w){K.removeClass("selected")}else{K.addClass("selected");if(M.name!=""){K.siblings().removeClass("selected")}}H.push(D)}h.update("icon",H,z)},getIcon:function(t,r){var u=null;if(!t){return}for(var s=0,q=t.length;s<q;s++){var v=t[s];if(r==v.index){u=v;break}}return u},removeIcon:function(w){var E=this.currentIcon;if(w==null&&(E==null||E.index==null)){return}var C=this,q=j.selectIds();if(q.length==0){return}var r=[],x=[];for(var y=0,z=q.length;y<z;y++){var s=q[y];var v=i.getNodeById(s),u=j.copy(v),D=v.icons;x.push(u);for(var A=0,B=D.length;A<B;A++){var t=D[A];if(w!=null&&t.name==w){D.splice(A,1);break}else{if(t.index==E.index){D.splice(A,1);break}else{if(w!=null){v.task[w]=null}}}}r.push(v)}h.update("icon",r,x)},setIconColor:function(u){var q=j.currentId;if(q==null||$.trim(q)==""){return}var y=this.currentIcon;if(y.index==null){return}var t=i.getNodeById(q),s=j.copy(t),x=t.icons;for(var v=0,w=x.length;v<w;v++){var r=x[v];if(r.index==y.index){r.color=u;break}}h.update("icon",[t],[s])},icons:{face:[{index:9,text:"&#xe6c8"},{index:11,text:"&#xe6ca"},{index:10,text:"&#xe6c6"}],priority:[{index:0,text:"&#xe67a"},{index:1,text:"&#xe625"},{index:2,text:"&#xe62a"},{index:3,text:"&#xe635"},{index:4,text:"&#xe626"},{index:5,text:"&#xe62b"},{index:6,text:"&#xe627"},{index:7,text:"&#xe628"},{index:8,text:"&#xe629"}],arrow:[{index:33,text:"&#xe68c"},{index:34,text:"&#xe68e"},{index:35,text:"&#xe68d"},{index:36,text:"&#xe68b"},{index:37,text:"&#xe6a0"}],flag:[{index:26,text:"&#xe67e"},{index:27,text:"&#xe67e"},{index:28,text:"&#xe67e"},{index:29,text:"&#xe67e"},{index:30,text:"&#xe67e"},{index:31,text:"&#xe67e"},{index:32,text:"&#xe67e"}],completion:[{index:17,text:"&#xe6d2"},{index:18,text:"&#xe6d3"},{index:19,text:"&#xe6d4"},{index:20,text:"&#xe6d5"},{index:21,text:"&#xe6d6"},{index:22,text:"&#xe6d7"},{index:23,text:"&#xe6d8"},{index:24,text:"&#xe697;"}],"":[{index:38,text:"&#xe6ab"},{index:39,text:"&#xe634"},{index:40,text:"&#xe640"},{index:41,text:"&#xe692"},{index:42,text:"&#xe6b8"},{index:43,text:"&#xe6bb"},{index:44,text:"&#xe6b9"},{index:45,text:"&#xe6bf"},{index:46,text:"&#xe663"},{index:47,text:"&#xe6bd"},{index:48,text:"&#xe621"},{index:49,text:"&#xe6bc"},{index:50,text:"&#xe6c1"},{index:51,text:"&#xe609"},{index:52,text:"&#xe688"},{index:53,text:"&#xe681"},{index:54,text:"&#xe639"},{index:55,text:"&#xe682"},{index:56,text:"&#xe67f"},{index:57,text:"&#xe695"},{index:58,text:"&#xe689"},{index:59,text:"&#xe6be"},{index:60,text:"&#xe683"},{index:61,text:"&#xe6c0"},{index:62,text:"&#xe6b6"},{index:63,text:"&#xe680"},{index:64,text:"&#xe693"}]},docerIcon:[]},insertParent:function(t,v,s,w){var y=i.getNodeById(t.parent),s=null;if(t.parent=="root"){s=i.getRootSubPart(t.id)}var r=y.children,x=0;if(y.id=="root"&&s=="left"){r=y.leftChildren}if(v==null){var z=i.getNodeById(t.id);var q=j.copy(z);t.id=i.newId();q.parent=t.id;t.children=[];t.children.push(q)}else{var z=i.getNodeById(v.id);var q=j.copy(z);z.id=t.id;z.title=t.title;q.parent=t.id;z.children=[];z.children.push(q);t=z}t.title="父主题";delete t.pos;delete t.free;delete t.summary;delete t.summaries;delete t.collapsed;delete t.image;delete t.icons;delete t.task;delete t.link;delete t.style;i.resetNodeList();var u=$("#"+v.id);u.attr("id",t.id);u.children(".node-self").children(".node-title").html(t.title);h.renderChildren(t)},unInsertParent:function(t,u,r,s){var x=this;var v=i.getNodeById(t.id);var y=j.copy(v);var w=i.getNodeById(y.parent);var z=j.copy(i.getNodeById(u.id));var q=z.children;v.id=z.id;v.children=[];v.children=q;if(z.icons){v.icons=z.icons}if(z.task){v.task=z.task}if(z.style){v.style=z.style}if(z.link){v.link=z.link}if(z.free){v.free=z.free}if(z.summary){v.summary=z.summary}if(z.summaries){v.summaries=z.summaries}if(z.pos){v.pos=z.pos}if(z.image){v.image=z.image}if(z.collapsed){v.collapsed=z.collapsed}v.title=z.title;i.resetNodeList();$("#"+y.id).remove();h.refreshNode(v)}};var b={renderTitle:function(s){var r=$(".outline-title");r.html(chartTitle);r.attr("id","filename_"+s.id);j.currentPid=s.id;var q="";if(!opts.readOnly){q='contenteditable="true"'}var u=$("#mind-core");if(u.length==0){u=$("<div id='"+s.id+"' class='designer-outline-title'></div>").prependTo($("#outline-con"))}var t="<div "+q+' spellcheck="false" autocapitalize="false" class="node-title" placeholder="未命名文件">'+s.title+"</div>";u.html(t);g.equation.renderEquation(u)},addNodeDom:function(F,P,E,Q){var E=E||{};for(var M=0;M<F.length;M++){var I=F[M],C=I.id,t=I.parent;var r=P[C]||0;var y=$("#"+C);var O=o.createElement("div");O.setAttribute("id",C);if(opts.indent=="wider"){O.setAttribute("class","node-element wider")}else{O.setAttribute("class","node-element")}if(I.type){O.setAttribute("type",I.type);if(I.type=="mind"||I.type=="flow"){O.setAttribute("data-chartid",I[I.type]["chartid"])}}if(I.collapsed){O.classList.add("collapsed")}else{O.classList.remove("collapsed")}var z=h.isViewBoad(C);if(z){O.classList.add("mode-board")}if(I.task&&I.task.completion=="100"){O.classList.add("complete")}else{O.classList.remove("complete")}var J="";if(!opts.readOnly){J='contenteditable="true"'}var B="node-children";if(opts.line.show){B+=" line"}if(opts.line.dashed){B+=" dashed"}var G="node-type",K="";if(opts.listType=="num"){G+=" num"}else{G+=" dot"}var u="",s="";if(I.children&&I.children.length>0&&!I.collapsed){K='<div class="node-state"><span class="openIcon ol-icons">&#xe721;</span></div>'}else{if(I.collapsed){K='<div class="node-state"><span class="closeIcon ol-icons">&#xe721;</span></div>';u=' class="active"'}}var x="";if(!I.title&&((I.type&&I.type!="normal")||(I.image!=null&&I.image.url!=""))){x="hide"}var v='<div class="node-self"><div class="node-contr-action"><div class="opmenu-open-icon"><span class="ol-icons">&#xe720;</span></div>'+K+'</div><span class="'+G+'"><span'+u+"></span></span><div "+J+' spellcheck="false" autocapitalize="false" class="node-title '+x+'">'+I.title+s+"</div></div>";if(I.image!=null&&I.image.url!=""){v+=b.renderImageHtml(I.image)}if(I.note!=null&&I.note!=""){v+=b.renderRemarkHtml(I.note)}v+='<div class="'+B+'"></div>';O.innerHTML=v;var L=h.getStyle(I.style);if(L!=null&&L!=""){O.querySelector(".node-title").style.cssText=L}var w=$("#"+t),D,H=E[C]||"right";if(t=="root"){childrenLen=i.getNodeById("root").children.length}if(t==j.currentPid){D=$(p);if(r>0){if(i.page=="searchPage"){var N=D.children(".node-element").eq(r-1);function A(R){if(R.length==0){r-=1;R=D.children().eq(r-1);if(r>=0){A(R)}}else{R.after(O)}}A(N)}else{if(t=="root"&&H=="left"){D.children(".node-element:not(.designer-outline-title)").eq(r+childrenLen-1).after(O)}else{D.children(".node-element:not(.designer-outline-title)").eq(r-1).after(O)}}}else{if(t=="root"&&H=="left"){if(childrenLen>0){D.children(".node-element:not(.designer-outline-title)").eq(childrenLen-1).after(O)}else{D.append(O)}}else{var q=D.children(".node-element").eq(0);if(q.length>0){q.before(O)}else{D.append(O)}}}}else{D=w.children(".node-children");if(D.length==0){D=$(p)}if(r>0){if(i.page=="searchPage"){var N=D.children(".node-element").eq(r-1);function A(R){if(R.length==0){r-=1;R=D.children().eq(r-1);if(r>=0){A(R)}}else{R.after(O)}}A(N)}else{D.children(".node-element:not(.designer-outline-title)").eq(r-1).after(O)}}else{var q=D.children(".node-element").eq(0);if(q.length>0){q.before(O)}else{D.append(O)}}}h.initNodeEvent(O);if(I.note!=null&&I.note!=""){h.initNoteEvent(O.querySelector(".node-remark"))}if(I.icons!=null){h.setIcons.renderTopicIcons(I)}g.equation.renderEquation(O)}},getChildrenDomTxt:function(){},boardViewNewChildBtn:function(s){var r=$("#"+s.id).children(".node-children"),q='<div class="node-element empty-board"><div class="bv-create-btn"><span class="ol-icons">&#xe696;</span>创建节点</div></div>'},addNodeDomModeBoard:function(q,s,r){},renderImg:function(t){var w=t.id,r=t.image.url.replace("http://","https://"),u=$("#"+w),q=u.children(".node-self");r=t.image.url.replace("https://","http://");var v=u.children(".node-image");if(u.children(".node-image").length==0){var v=o.createElement("div");v.setAttribute("class","node-image");v.style.cssText="width: "+t.image.w+"px";v.innerHTML='<img src="'+r+'"/>';$(q).after(v)}else{var s=v.children("img");if(s.attr("src")!=r.replace(/&amp;/,"&")){s.attr("src",r.replace(/&amp;/,"&"))}v.children("img").css({width:t.image.w+"px"})}},imageOpDomObj:{image:'<span class="img-op img-op-del"><i class="ol-icons">&#xe60f;</i></span>',flow:'<span class="img-op img-op-edit"><i class="ol-icons">&#xe7cf;</i></span><span class="img-op img-op-fresh"><i class="ol-icons">&#xe7ce;</i></span><span class="img-op img-op-del"><i class="ol-icons">&#xe60f;</i></span>',mind:'<span class="img-op img-op-edit"><i class="ol-icons">&#xe7cf;</i></span><span class="img-op img-op-fresh"><i class="ol-icons">&#xe7ce;</i></span><span class="img-op img-op-del"><i class="ol-icons">&#xe60f;</i></span>'},getImageOpDom:function(s){var r=s.parent(".node-element"),q=r.attr("type");if(!q){q="image"}return this.imageOpDomObj[q]},renderImgOpt:function(y,x){if(opts.readOnly){return}if(y.hasClass("active")){return}var v=y.find(".image-op-group-wrapper");if(v.length==0){var v=$('<div class="image-op-group-wrapper"><div class="image-op-group">'+this.getImageOpDom(y)+"</div></div>").appendTo(y)}if(x=="hover"){y.removeClass("hover").addClass("hover");return}y.removeClass("hover");y.removeClass("active").addClass("active");var t=y.children("img"),s=y.width(),C=y.height(),z,u;var B=y.parents(".node-element").eq(0),r=B.attr("id");$(p).find(".img-dot").remove();$(p).find(".img-btn.del").remove();var q=$("<span title='' class='img-dot'></span>");y.append(q);q.css({top:C-q.height()+4,left:s-q.width()}).show();var A=B.width()-parseInt(y.css("marginLeft"));$(".node-image .img-dot").off("mousedown").on("mousedown",function(E){E.stopPropagation();var w=E.pageX,G=E.pageY,D=t.width(),F=t.height();v.addClass("invisible");y.css({width:D,height:F});$(document).off("mousemove.img-dot").on("mousemove.img-dot",function(J){J.preventDefault();J.stopPropagation();var H=J.pageX,L=J.pageY,K=H-w,I=L-G;if(Math.abs(K)>5||Math.abs(I)>5){z=D+K;u=z*F/D;if(z>30&&z<A){t.width(z);t.height(u);q.css({left:z-q.width(),top:u-q.height()})}}});$(document).off("mouseup.img-dot").on("mouseup.img-dot",function(I){D=t.width();F=t.height();y.css({width:D,height:F});v.removeClass("invisible");var K=i.getNodeById(r),L=j.copy(K);K.image={w:D,h:F,url:L.image.url};var H=K.image.w,J=L.image.w;if(H!=J){h.update("image",[K],[L])}$(document).off("mouseup.img-dot");$(document).off("mousemove.img-dot")})})},removeImgOpt:function(r,q){$(".node-image.hover").removeClass("hover");if(!q){$(".node-image.active").removeClass("active")}},renderRemarkDom:function(u){var r=$("#"+u),s=r.children(".node-children");if(i.page=="searchPage"){var q=r.children(".highlightTextarea").children(".node-remark");if(q.length>0){q.focus();return q[0]}}else{if(r.children(".node-remark").length>0){r.children(".node-remark").focus();return r.children(".node-remark")[0]}}var t=o.createElement("div");t.setAttribute("contenteditable",true);t.setAttribute("class","node-remark");t.setAttribute("spellcheck","false");t.setAttribute("autocapitalize","off");s.before(t);return t},renderImageHtml:function(s){var q=s.w,r=s.h;if(!q){q="100%"}return'<div style="width:'+q+'px;" class="node-image"><img src="'+s.url+'"/></div>'},renderRemarkHtml:function(q){return'<div class="node-remark" contenteditable=true spellcheck="false" autocapitalize="false">'+q+"</div>"},deviceType:null,iosAppHSupport:false,showMenu:function(q){return;var t=$(".outline-m1");var u=j.isSafari();if(!b.deviceType){b.deviceType=j.deviceIdentify()}var r=b.deviceType;if(r.indexOf("iosapp")>-1&&typeof wps!="undefined"&&wps.addNotification){b.iosAppHSupport=true}if(t.length==0){var s="body";var x="";if(u&&!b.iosAppHSupport){x=" safari"}t=$('<div class="outline-menu outline-m1'+x+'"><i click-btn="unIndent" class="ol-icons">&#xe760;</i><i click-btn="indent" class="ol-icons">&#xe761;</i><span click-btn="complete" class="ol-icons">&#xe602;</span><span click-btn="format" class="ol-icons">&#xe762;</span><span click-btn="remark" class="ol-icons">&#xe604;</span><span click-btn="image" class="ol-icons" style="font-size:20px">&#xe601;</span><span click-btn="del" style="padding:0px;padding-left:7px;" class="ol-icons">&#xe60f;</span></div>');if(u&&!b.iosAppHSupport){s=$("#"+q).children(".node-children")}else{t.appendTo(s)}}h.initMenuBtnStatus(q);if(u&&!b.iosAppHSupport){var y=$("#"+q);var s=y.children(".node-children");if(y.children(".node-image").length>0){s=y.children(".node-image")}if(y.children(".outline-menu.safari").length==0){s.before(t);h.initMenuEvent()}else{s.before(t)}var z=$(window).width();var v=y.offset().left;$(".outline-menu.safari").css({marginLeft:-v,width:z,height:40}).show()}else{if(b.iosAppHSupport){b.iosAppShowMenu();h.initMenuEvent()}else{setTimeout(function(){$(".outline-menu").css({zIndex:3,opacity:1}).show()},200)}}},appKeyBoardHeight:0,iosAppShowMenu:function(){var r=this;var q=400;if(r.appKeyBoardHeight>0){q=100}setTimeout(function(){$(".outline-m1").css({position:"absolute",zIndex:3,opacity:1,bottom:r.appKeyBoardHeight-$(document).scrollTop()+"px"}).show(100);$(".outline-m2").css({position:"absolute",zIndex:3,opacity:1,bottom:b.appKeyBoardHeight-$(document).scrollTop()+44+"px"}).show(100)},q)},hideMenu:function(){var q=$(".op-context-menu");q.off("mousedown");$(".right-click").removeClass("right-click");if($(".op-context-menu").css("display")=="block"){$(".opmenu-open-icon").removeClass("active")}$(".node-optioning").removeClass("node-optioning");q.hide()},showNav:function(r){b.hideMenu();var w=r.parent;var y=i.getParentNodes(w);var x=$(".outline-title");if(y.length==0){x.show();$(".outline-nav").remove();return}x.hide();var q=$(".outline-nav");if(q.length==0){q=$('<div class="outline-nav"></div>');x.before(q)}y=y.reverse();var v="";var z=[];for(var t=0;t<y.length;t++){var u=y[t],x=u.title||"空节点";if(t==0){x="首页"}if(y.length>4&&t>1&&t<y.length-1){z.push(u);if(v.indexOf("node-nav-more")==-1){v+='<span class="node-nav-more ol-icons">&#xe6a1;</span><i class="ol-icons">&#xe747;</i>'}}else{v+='<span class="node-nav-title" nodeId="'+u.id+'">'+x+'</span><i class="ol-icons">&#xe747;</i>'}}v+='<span class="node-nav-title select" nodeId="'+r.id+'">'+(r.title||"空节点")+"</span>";q.html(v);this.navNodeShowTips(q.find(".node-nav-title"));if(z.length>0){b.subsidiary(z)}var s=$(q).find(".equation-text");s.html(s.data("equation"))},subsidiary:function(u){var v=$(".outline-nav-m2");if(v.length==0){v=$('<div class="outline-nav-m2"></div>').hide();$(".outline-nav").after(v)}var s="";var t='<i class="ol-icons">&#xe747;</i>';for(var r=0;r<u.length;r++){var q=u[r],w=q.title||"空节点";s+='<div title=""><span class="node-nav-title" nodeId="'+q.id+'">'+w+"</span>"+(r==u.length-1?"":t)+"</div>"}v.html(s);this.navNodeShowTips(v.find(".node-nav-title"));$(".node-nav-more, .outline-nav-m2").off("mouseover").on("mouseover",function(x){if(typeof navTimer!="undefined"){clearTimeout(navTimer)}$(".outline-nav-m2").show()});$(".node-nav-more, .outline-nav-m2").off("mouseout").on("mouseout",function(x){navTimer=setTimeout(function(){$(".outline-nav-m2").hide()},800)})},navNodeShowTips:function(q){q.off("mouseover.showtip").on("mouseover.showtip",function(u){var r=$(this);var s=r.width();var t=r[0].scrollWidth;var v=r.text();if(t>s){r.attr("title",v)}else{r.removeAttr("title")}})},handleChildTask:function(q){},emptyCreatNode:function(q){var r=$("#outline-empty-box");if(r.length>0){r.show()}else{r=$("<div id='outline-empty-box' class='outline-empty-box'><span class='ol-icons'>&#xe696;</span>新建子节点</div>").appendTo("#outline-con")}r.off("mousedown.creat").on("mousedown.creat",function(t){t.stopPropagation();t.preventDefault();var s="root";if(i.focusInfo.state){s=i.focusInfo.state.id}var u=h.add(null,s);r.remove();$("#outline-con .node-title").focus();if(q){q(u)}})}};var d={versionNow:0,version:0,saved:true,requests:[],isUndo:false,isRedo:false,historySaveTime:300000,historyVersion:0,save:function(r){var s=j.copy(r);if(!this.isUndo){this.undoList.data.push(s);if(!this.isRedo){this.redoList.data=[]}}this.send([s]);var q=this.undoList.data.length;m.events.trigger("undo",q,this.redoList.data.length)},init:function(){var q=this;window.onbeforeunload=function(r){if(PoNetwork.preStatus=="offline"){q.saveHistory();return"当前处于离线，退出前请联网保存"}};window.setInterval(function(){if(q.historyVersion!=q.versionNow){q.saveHistory()}},q.historySaveTime)},postData2Wps:function(q){},deleteRepeatCreate:function(s){var q=i.nodeList,r={};function t(u){Array.prototype.forEach.call(u,function(w,v){if(w.id in r){u.splice(v,1);return true}r[w.id]=w;if(w.children&&w.children.length>0){t(w.children)}})}if(s instanceof Array){Array.prototype.forEach.call(s,function(v,u){if(v.action&&v.action=="create"&&v.content&&v.content.length>0){t(v.content)}})}return s},isSending:false,mess:[],tempMess:[],sendQueueTimer:null,send:function(r){var t=this;this.version++;if(!r){r=[]}var v=j.copyArray(r);this.topTipDisplay("saving");if(this.isSending){this.tempMess=this.tempMess.concat(v);return false}this.mess=this.tempMess.concat(v);if(this.mess.length==0){return}this.isSending=true;this.tempMess=[];if(t.sendQueueTimer){clearTimeout(t.sendQueueTimer)}var q=JSON.stringify(this.mess);var s="/outline/msg";var u={msgStr:q,ignore:"msgStr",chartId:chartId,isFull:false};$.ajax({url:s,data:u,cache:false,type:"post",success:function(z){t.isSending=false;if(z.result=="success"){try{var w=j.copyArray(t.mess);t.mess=[];if(typeof OutlineWebsocketUtil!="undefined"&&OutlineWebsocketUtil){var y={type:"_s@deliver",content:{client:OutlineWebsocketUtil.clientId,source:"outline",msg:w}};OutlineWebsocketUtil.deliverMsg(y)}}catch(x){t.messs=[]}t.versionNow=t.version;t.topTipDisplay("success");if(t.tempMess&&t.tempMess.length>0){t.sendQueueTimer=setTimeout(function(){t.send()},2000)}return}t.topTipDisplay("error");t.showTip()},error:function(w){t.isSending=false;PoNetwork.test({onlineCallback:function(){t.topTipDisplay("error");t.showTip()}})}})},topTipDisplay:function(q){if(typeof closeSaveingTimer!="undefined"){clearTimeout(closeSaveingTimer)}if(q=="saving"){$("#save_tip").text("正在保存");return}if(q=="success"||q=="error"){closeSaveingTimer=setTimeout(function(){var r=(q=="success"?"已自动保存":"保存异常");$("#save_tip").text(r)},1000)}},showTip:function(){poCollect("操作结果",{"操作名称":"保存","结果":"失败","原因":""});m.events.trigger("show_tip","server_error_dlg")},doSend:function(){},configing:false,setConfig:function(){var q=this;if(this.configing){return}this.configing=true;$.ajax({url:" /outline/config",data:{outlineConfig:JSON.stringify(opts.config),ignore:"outlineConfig"},type:"post",success:function(r){q.configing=false},error:function(){q.configing=false}})},saveHistory:function(s){var q=this,u=userName;var r=JSON.stringify(i.data),t="自动存储";if(s!=null&&s!=""){t=s}$.ajax({url:"/diagraming/add_version",data:{chartId:chartId,userId:userId,fullName:u,def:r,remark:t,ignore:"def"},type:"post",success:function(v){q.historyVersion=q.versionNow}})},undo:function(){if(opts.readOnly){return}this.isUndo=true;var s=this.undoList.data.pop();if(s!=null){try{this.redoList.data.push(s);var B=s.action,A=s.content;switch(B){case"add":var D=s.indexs;h.removeNodes(A,D);break;case"update":var w=A.nodes,t=A.oldNodes,H=A.key;h.update_(H,t,w);break;case"moveNode":var r=A.sourceId,G=A.target,x=A.source;h.moveNode(r,x,G);break;case"delete":var D=s.indexs,v=s.parts||{};h.addMultNodes(A,D,v,true);break;case"open":break;case"close":break;case"indent":var y=A.ids,F=A.targets,q=A.origins;h.unIndentByIds(y);break;case"unIndent":var y=A.ids,F=A.targets,q=A.origins;h.indentByNodesPos(y,q,F,null,"undo");break;case"focus":var u=A.oldId;h.focusNode(u);break;case"image":var w=A.nodes,t=A.oldNodes;h.update_(H,t,w);break;case"changeTitle":var C=s.title,E=s.oldTitle;h.changeTitle(E);break}}catch(z){}}this.isUndo=false;m.events.trigger("undo",this.undoList.data.length,this.redoList.data.length)},redo:function(){if(opts.readOnly){return}this.isRedo=true;var s=this.redoList.data.pop();try{if(s!=null){var A=s.action;switch(A){case"add":var z=s.content,D=s.indexs,v=s.parts;h.addNodes(z,D,v,true);break;case"update":var z=s.content;var w=z.nodes,t=z.oldNodes,H=z.key;h.update_(H,w,t);break;case"moveNode":var z=s.content;var r=z.sourceId,G=z.target,x=z.source;h.moveNode(r,G,x);break;case"delete":var z=s.content,D=s.indexs;h.removeNodes(z,D);break;case"open":break;case"close":break;case"indent":var z=s.content;var y=z.ids,F=z.targets,q=z.origins;if(F.reverse){y.reverse()}h.indentByIds(y);break;case"unIndent":var z=s.content;var y=z.ids,F=z.targets,q=z.origins;h.unIndentByIds(y);break;case"focus":var z=s.content;var u=z.newId;h.focusNode(u);break;case"image":var w=z.nodes,t=z.oldNodes;h.update_("image",w,t);break;case"changeTitle":var B=s.title,E=s.oldTitle;h.changeTitle(B);break}}}catch(C){}this.isRedo=false;m.events.trigger("redo",this.undoList.data.length,this.redoList.data.length)},excuteMsgDirect:function(w,t){if(w.action!=null&&w.action=="forceRefresh"){return}var O=w.action;switch(O){case"add":var N=w.content,R=w.indexs,E=w.parts||{};h.addMultNodes(N,R,E,"noservesave");break;case"update":var N=w.content;var F=N.nodes,C=N.oldNodes,U=N.key;h.update_(U,F,C,true);break;case"moveNode":var N=w.content;var u=N.sourceId,T=N.target,G=N.source;h.moveNode(u,T,G,true);break;case"delete":var N=w.content,R=w.indexs;h.removeNodes(N,R,true);break;case"open":break;case"close":break;case"indent":var N=w.content;var K=N.ids,S=N.targets,q=N.origins,s=N.type;h.indentByNodesPos(K,S,q,true,s);break;case"unIndent":var N=w.content;var K=N.ids,S=N.targets,q=N.origins;h.unIndentByIds(K,true);break;case"focus":var N=w.content;var D=N.newId;h.focusNode(D,true);break;case"deleteConnection":var r=w.content;i.deleteConnectionMulti(r,true);break;case"addConnection":var r=w.content;i.addConnectionMulti(r);break;case"insertParent":var J=w.content,I=w.oldNode,H=w.part;h.insertParent(J,I,H);break;case"unInsertParent":var J=w.content,I=w.oldNode,H=w.part;h.unInsertParent(J,I,H);break;case"addSummary":var y=w.content;i.summary.addSummary(y);break;case"deleteSummary":var y=w.content;i.summary.deleteSummary(y);break;case"updateSummary":var y=w.content;i.summary.updateSummary(y);break;case"deleteSelf":var Q=w.content,B=w.add,A=w.addPart,v=w.removedPart;h.removeAndAdd(Q,B,A,v,true);break;case"deleteSelfRestore":var Q=w.content,B=w.add,A=w.addPart,v=w.removedPart,M=w.removedIndex;h.addAndRemove(Q,B,A,v,M,true);break;case"hideTopics":var x=w.content,E=w.parts,P=w.withChildren;h.hideTopics(x,P,true);break;case"showTopics":var x=w.content,E=w.parts,P=w.withChildren;h.showTopics(x,P,true);break;case"updatePage":var z=w.content,L=w.original;h.setMindMargin(z,L,true);break}},saveToLocal:function(){var q=JSON.stringify(i.data);window.localStorage.setItem("outline_data",q)},doSave:function(){var r=this.requests,q=r.length;if(q==0){return}},undoList:{data:[]},redoList:{data:[]},imageUploading:false,uploadImageRequest:function(){var s=this;var q=$("#img_upload");if(q.length==0){var r=[];r.push('<form action="/outline/upload" method="post" enctype ="multipart/form-data" style="display: none;">');r.push('<input id="img_upload" name="img" type="file"/>');r.push("</form>");$("body").append(r.join(""))}q=$("#img_upload"),filePt=q.parent();q.off("change").on("change",function(){$.showTip("图片上传中...",40000,"top");filePt.submitForm({success:function(t){h.imageUploadResponse(t);filePt.remove()},error:function(t){j.blurAdjust()}})});q.trigger("click")},uploadImageJsBlob:function(q){var r=new FormData();r.append("img",q);$.ajax({url:"/outline/upload",data:r,timeout:1000*60,type:"post",processData:false,contentType:false,success:function(s){h.imageUploadResponse(s)},error:function(){$.showTip("图片上传失败",2000,"top")},complete:function(t,s){if(s=="timeout"){$.showTip("图片上传超时，请重新尝试",2000,"top")}}})},exitFocusNode:function(){if(h&&i.focusInfo.state){h.focusNode("root");$.showTip("您的文件处于多人协作， 已退出聚焦模式",2000,"top")}}};var g={eventInit:function(){},mindflow:{targetId:null,insertType:"",view:"ico",pageType:"",insertTypeObj:{"":"mind","":"flow","":"image"},typeForChinese:{mind:"思维导图",flow:"流程图"},init:function(){var q=this;window.addEventListener("message",function(s){var r=JSON.parse(s.data);if(r.eventName=="returnSVG"){if(typeof getSVGTimer!="undefined"){clearTimeout(getSVGTimer)}q.hideUpdateSVGLoading(r.chartId);q.hideUpdateSVGLoading(q.popEditorChartId);q.updateImageToOutline(r.data);if(r.chartId==q.popEditorChartId){$("#app-mindflow").remove()}}},false)},popEditorChartId:"",popEditor:function(A,y,s,r){var w=this;if(!A){return}if($(".node-image.loading").length>0){$.showTip("正在更新编辑后的图片，请3s后在尝试",2000,"top");return}this.popEditorChartId=A;var v=$("#chartEditor"),x=$("#app-mindflow");if($("#app-mindflow").length==0){var u='<iframe id="app-mindflow" src="" name="app-mindflow" frameborder="0"></iframe>';x=$(u).appendTo(v)}this.targetId=j.currentId=s;var q="/mindmap/pop/"+A;if(y=="flow"){q="/diagraming/pop/"+A}var z=$("body").outerWidth();v.animateDlg({width:"100%",height:"100%",onClose:function(){var B="edit";if(r=="new"){B="new"}if(window.frames["app-mindflow"]){window.frames["app-mindflow"].postMessage(JSON.stringify({eventName:"getSVG",type:B,chartId:A}),"*");w.showUpdateSVGLoading(A);getSVGTimer=setTimeout(function(){w.hideUpdateSVGLoading(A)},6000)}}});this.showLoading(v);var t=new Date().getTime();x.attr("src",q+"?_="+t);x.on("load",function(B){w.hideLoading(v)})},showUpdateSVGLoading:function(t,s){if(s){var r=$("#"+s)}else{var r=$("[data-chartid="+t+"]")}if(r.length==0){return}var q=r.children(".node-image");this.showLoading(q)},hideUpdateSVGLoading:function(s){var r=$("[data-chartid="+s+"]");if(r.length==0){return}var q=r.children(".node-image");this.hideLoading(q)},showLoading:function(q){if(!q||q.length==0){return}q.removeClass("loading").addClass("loading")},hideLoading:function(q){if(!q){$(".loading").removeClass("loading");return}q.removeClass("loading")},updateImageToOutline:function(t){var s=this.targetId,q=i.getNodeById(s),r=j.copy(q);if(!t||t=="error"||t=="nochange"){return}if(q.image){if(q.image.url==t){return}q.image.url=t}h.update("image",[q],[r])},popInsert:function(r){this.targetId=j.currentId;this.myfiles.searchTitle="";if(!r){$.showTip("请选择插入类型",2000,"top");return}var s=this.insertType;this.insertType=r;var q=$("#mind-flow-dlg");if(s!=r){if(q.length>0){q.remove()}}var q=$("#mind-flow-dlg");if(q.length==0){q=this.renderDlg();this.initTabEvent();q.find(".nav-i").eq(0).trigger("mousedown")}else{$(".pop-nav .nav-i[type=myfile]").text("我的"+this.typeForChinese[r]);$("#myfile_search_input").attr("placeholder","搜索个人文件中的"+this.typeForChinese[r])}q.dialog();b.hideMenu()},templateConfig:{mind:[{id:"5f17e7597621315c2b23c637",title:"清新粉",definitionId:"definitionId",tags:["思维导图","通用模版","风格样式"],description:"思维导图模版",createTime:"2019-06-26 17:20:14",publishTime:"2020-02-17 17:41:32",owner:null,cloneCount:931,viewCount:8012,likeCount:12,publicClonePrice:5,category:"mind_free",thumbnail:"5f17e7597621315c2b23c635",thumbUrl:null,status:"public",lastModify:"2019-06-26 17:21:05",wpsUseCount:372558,wpsViewCount:1330778,wpsStatus:"visible",wpsStatusTime:"2020-02-17 17:41:40",wpsPrice:5,lastUseTime:"2020-11-23 11:09:04",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f17e7597621315c2b23c637",deleted:false},{id:"5b35f822e4b0fac03fcafde9",title:"缤纷",definitionId:"5b791804e4b099b1464ea1f2",tags:["思维导图","风格样式"],description:"思维导图系统模板-彩色线条",createTime:"2018-06-29 17:13:06",publishTime:"2018-06-29 17:18:22",owner:null,cloneCount:1577,viewCount:4019,likeCount:4,publicClonePrice:0,category:"mind_free",thumbnail:"5b791804e4b099b1464ea1f1",thumbUrl:null,status:"public",lastModify:"2018-06-29 17:30:01",wpsUseCount:197858,wpsViewCount:482795,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:11:00",wpsPrice:9.9,lastUseTime:"2020-11-23 11:12:05",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b35f822e4b0fac03fcafde9",deleted:false},{id:"5f17e5db7621315c2b23c5c4",title:"极简",definitionId:"5f17e5db7621315c2b23c5c1",tags:["思维导图","风格样式"],description:"思维导图模板",createTime:"2020-02-05 10:44:49",publishTime:"2020-02-17 17:41:58",owner:null,cloneCount:8,viewCount:72,likeCount:0,publicClonePrice:2.9,category:"mind_free",thumbnail:"5e4a5fe8e4b03813ad87af79",thumbUrl:null,status:"public",lastModify:"2020-02-05 10:45:23",wpsUseCount:105489,wpsViewCount:705035,wpsStatus:"visible",wpsStatusTime:"2020-02-17 17:42:00",wpsPrice:9.9,lastUseTime:"2020-11-23 11:13:45",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f17e5db7621315c2b23c5c4",deleted:false},{id:"5f3e467e7621316342b98990",title:"彩色",definitionId:"5f3e467e7621316342b9898d",tags:["思维导图","风格样式"],description:"思维导图系统模板-浅血牙",createTime:"2018-06-29 18:45:38",publishTime:"2018-06-29 18:59:08",owner:null,cloneCount:1328,viewCount:2947,likeCount:1,publicClonePrice:0,category:"mind_free",thumbnail:"5f3e467e7621316342b9898e",thumbUrl:null,status:"public",lastModify:"2018-06-29 18:45:44",wpsUseCount:101210,wpsViewCount:134144,wpsStatus:"visible",wpsStatusTime:"2019-04-15 14:12:28",wpsPrice:9.9,lastUseTime:"2020-11-23 11:10:47",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f3e467e7621316342b98990",deleted:false},{id:"595f5dd2e4b0c5e101f36bc5",title:"成长型公司组织结构",definitionId:"5b7917f9e4b099b1464ea0da",tags:["组织结构图","公司架构","组织结构"],description:"常见公司组织结构图，文字方向包括垂直与水平两个方向",createTime:"2017-07-07 18:09:22",publishTime:"2017-09-14 18:07:52",owner:null,cloneCount:1779,viewCount:33300,likeCount:87,publicClonePrice:2,category:"mind_org",thumbnail:"5c9cbba6e4b02f597218cd81",thumbUrl:null,status:"public",lastModify:"2017-07-07 18:10:19",wpsUseCount:223120,wpsViewCount:1366079,wpsStatus:"visible",wpsStatusTime:"2018-09-28 14:23:44",wpsPrice:7.9,lastUseTime:"2020-11-23 11:27:07",themeTags:["组织结构"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"595f5dd2e4b0c5e101f36bc5",deleted:false},{id:"5ae2dec5e4b0b66abc1ac620",title:"商品专业化管理",definitionId:"5b791804e4b099b1464ea21c",tags:["商品管理","组织结构图","商品管理思维导图","思维导图","运营","免费"],description:"一个关于商品管理的好看的组织结构图。",createTime:"2018-04-27 16:26:45",publishTime:"2018-04-27 16:30:22",owner:null,cloneCount:1952,viewCount:5445,likeCount:3,publicClonePrice:0,category:"mind_org",thumbnail:"5b791804e4b099b1464ea21b",thumbUrl:null,status:"public",lastModify:"2018-04-27 16:31:51",wpsUseCount:146559,wpsViewCount:114649,wpsStatus:"visible",wpsStatusTime:"2019-03-28 15:34:26",wpsPrice:0,lastUseTime:"2020-11-23 11:02:04",themeTags:["运营","免费"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5ae2dec5e4b0b66abc1ac620",deleted:false},{id:"5da08235e4b0c9f9da46ca59",title:"组织结构图",definitionId:"5da08235e4b0c9f9da46ca56",tags:["风格样式","组织结构"],description:"组织结构图",createTime:"2020-02-11 15:07:35",publishTime:"2020-02-17 10:22:08",owner:{userId:"5b5ae5d4e4b0edb750ee3926",userName:"5b5ae5d4e4b0edb750ee3925",fullName:"达达达1995"},cloneCount:0,viewCount:0,likeCount:0,publicClonePrice:0,category:"mind_free",thumbnail:"5e49f8d0e4b093fce2d4575f",thumbUrl:null,status:"public",lastModify:"2020-02-11 15:23:47",wpsUseCount:160851,wpsViewCount:1107579,wpsStatus:"visible",wpsStatusTime:"2020-02-17 10:35:34",wpsPrice:9.9,lastUseTime:"2020-11-23 11:13:34",themeTags:["组织结构"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5da08235e4b0c9f9da46ca59",deleted:false},{id:"5adf09c9e4b0b66abc1a9aa7",title:"树状图基础样式",definitionId:"5b791804e4b099b1464ea220",tags:["思维导图","树状图","组织结构图","树状结构图","风格样式","免费"],description:"直接一键套用，可用于多场景。",createTime:"2018-04-24 18:41:13",publishTime:"2018-04-24 18:44:56",owner:null,cloneCount:876,viewCount:2337,likeCount:0,publicClonePrice:0,category:"mind_tree",thumbnail:"5b791804e4b099b1464ea21f",thumbUrl:null,status:"public",lastModify:"2018-04-24 18:42:17",wpsUseCount:31484,wpsViewCount:23380,wpsStatus:"visible",wpsStatusTime:"2019-03-28 15:34:33",wpsPrice:0,lastUseTime:"2020-11-23 11:16:53",themeTags:["风格样式","免费"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5adf09c9e4b0b66abc1a9aa7",deleted:false},{id:"5b9622d9e4b08d5fb46dd1ca",title:"教学计划",definitionId:"5b9622d9e4b08d5fb46dd1c7",tags:null,description:"教学计划梳理，知识点罗列",createTime:"2020-03-23 16:02:49",publishTime:"2020-03-23 16:05:26",owner:null,cloneCount:0,viewCount:0,likeCount:0,publicClonePrice:9.9,category:"mind_free",thumbnail:"5e786d29e4b0b371a4d0e908",thumbUrl:null,status:"public",lastModify:"2020-03-23 16:05:26",wpsUseCount:111529,wpsViewCount:348917,wpsStatus:"visible",wpsStatusTime:"2020-03-23 16:02:49",wpsPrice:9.9,lastUseTime:"2020-11-23 11:21:29",themeTags:["学习笔记"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b9622d9e4b08d5fb46dd1ca",deleted:false},{id:"593a0c7ee4b036833a727cc9",title:"即时会议-短会",definitionId:"5b791804e4b099b1464ea1b2",tags:["思维导图","思维导图左右分布","会议纲要","会议记录","免费"],description:"用户短会议记录使用",createTime:"2017-06-09 10:48:30",publishTime:"2017-08-10 19:04:24",owner:null,cloneCount:1252,viewCount:6425,likeCount:9,publicClonePrice:0,category:"mind_free",thumbnail:"5b791804e4b099b1464ea1b1",thumbUrl:null,status:"public",lastModify:"2017-06-09 10:52:04",wpsUseCount:14436,wpsViewCount:18292,wpsStatus:"visible",wpsStatusTime:"2018-08-21 18:36:30",wpsPrice:0,lastUseTime:"2020-11-22 23:14:28",themeTags:["会议记录","免费"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"593a0c7ee4b036833a727cc9",deleted:false},{id:"595f5a5be4b0a77c5aeb7204",title:"通用任务清单/工作规划/日程安排",definitionId:"5b791803e4b099b1464ea162",tags:["思维导图","逻辑图","任务计划","工作计划","日程安排","免费"],description:"每周列出自己的工作或学习任务清单，养成好习惯，合理安排自己的时间。",createTime:"2017-07-07 17:54:35",publishTime:"2017-08-10 19:15:20",owner:null,cloneCount:4348,viewCount:9705,likeCount:15,publicClonePrice:0,category:"mind_right",thumbnail:"5b791803e4b099b1464ea161",thumbUrl:null,status:"public",lastModify:"2017-07-07 17:55:19",wpsUseCount:129142,wpsViewCount:83322,wpsStatus:"visible",wpsStatusTime:"2018-08-31 14:06:08",wpsPrice:0,lastUseTime:"2020-11-23 10:48:19",themeTags:["工作计划","日程安排","免费"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"595f5a5be4b0a77c5aeb7204",deleted:false},{id:"5b0ccc5ce4b0746adce468a2",title:"时间管理",definitionId:"5b79180ce4b099b1464ea23a",tags:["时间管理","思维导图","周工作计划","周工作总结","学习计划","工作计划","时间计划","日程安排"],description:"时间管理，轻松管理你一周的工作。",createTime:"2018-05-29 11:43:24",publishTime:"2018-05-29 11:45:32",owner:null,cloneCount:36,viewCount:1426,likeCount:7,publicClonePrice:5,category:"mind_free",thumbnail:"5b79180ce4b099b1464ea239",thumbUrl:null,status:"public",lastModify:"2018-05-29 11:43:34",wpsUseCount:27012,wpsViewCount:120251,wpsStatus:"visible",wpsStatusTime:"2018-08-31 14:00:08",wpsPrice:9.9,lastUseTime:"2020-11-23 11:30:53",themeTags:["学习计划","工作计划","时间计划","日程安排"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b0ccc5ce4b0746adce468a2",deleted:false},{id:"5b35fb2ae4b0fac03fcafe3f",title:"经典",definitionId:"5b791803e4b099b1464ea17e",tags:["思维导图","风格样式"],description:"思维导图系统模板-经典",createTime:"2018-06-29 17:26:02",publishTime:"2018-06-29 17:36:37",owner:null,cloneCount:6313,viewCount:11698,likeCount:6,publicClonePrice:0,category:"mind_free",thumbnail:"5b791803e4b099b1464ea17d",thumbUrl:null,status:"public",lastModify:"2018-06-29 17:31:32",wpsUseCount:51988,wpsViewCount:29035,wpsStatus:"visible",wpsStatusTime:"2019-04-19 09:17:29",wpsPrice:9.9,lastUseTime:"2020-11-23 11:00:49",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b35fb2ae4b0fac03fcafe3f",deleted:false},{id:"5ad6e848e4b07048c0726da7",title:"商务",definitionId:"5b7917f9e4b099b1464ea0d8",tags:["商务","系统模板","风格样式"],description:"系统模板-商务风格",createTime:"2018-04-18 14:40:08",publishTime:"2018-06-29 17:09:59",owner:null,cloneCount:429,viewCount:1722,likeCount:1,publicClonePrice:0,category:"mind_free",thumbnail:"5b7917f9e4b099b1464ea0d7",thumbUrl:null,status:"public",lastModify:"2018-06-29 18:23:43",wpsUseCount:14420,wpsViewCount:15969,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:10:49",wpsPrice:9.9,lastUseTime:"2020-11-23 02:45:07",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5ad6e848e4b07048c0726da7",deleted:false},{id:"5b360d0de4b0fac03fcb002a",title:"海洋蓝",definitionId:"5b7917bde4b099b1464ea018",tags:["思维导图","风格样式"],description:"思维导图系统模板-海洋蓝",createTime:"2018-06-29 18:42:21",publishTime:"2018-06-29 18:56:27",owner:null,cloneCount:3920,viewCount:7315,likeCount:2,publicClonePrice:0,category:"mind_free",thumbnail:"5b7917bde4b099b1464ea017",thumbUrl:null,status:"public",lastModify:"2018-07-04 09:00:26",wpsUseCount:54676,wpsViewCount:63840,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:09:49",wpsPrice:9.9,lastUseTime:"2020-11-23 09:31:38",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b360d0de4b0fac03fcb002a",deleted:false},{id:"5b361924e4b0fac03fcb014d",title:"生命绿",definitionId:"5b791804e4b099b1464ea194",tags:["思维导图","风格样式"],description:" 思维导图系统模板-生命绿",createTime:"2018-06-29 19:33:56",publishTime:"2018-06-29 19:37:32",owner:null,cloneCount:934,viewCount:1441,likeCount:0,publicClonePrice:0,category:"mind_right",thumbnail:"5b791804e4b099b1464ea193",thumbUrl:null,status:"public",lastModify:"2018-06-29 19:34:09",wpsUseCount:122592,wpsViewCount:85310,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:11:00",wpsPrice:0,lastUseTime:"2020-11-23 11:01:03",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b361924e4b0fac03fcb014d",deleted:false},{id:"5b3618fce4b0fac03fcb0149",title:"流行紫",definitionId:"5e421fb8e4b03b578613e6fc",tags:["思维导图","风格样式"],description:"思维导图系统模板-流行紫",createTime:"2018-06-29 19:33:16",publishTime:"2018-06-29 19:36:34",owner:null,cloneCount:31945,viewCount:1281,likeCount:3,publicClonePrice:2.9,category:"mind_right",thumbnail:"5e421fb8e4b0ab2b84d77155",thumbUrl:null,status:"public",lastModify:"2018-06-29 19:33:28",wpsUseCount:100756,wpsViewCount:292453,wpsStatus:"visible",wpsStatusTime:"2020-02-11 11:30:00",wpsPrice:2.9,lastUseTime:"2020-11-23 11:44:04",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b3618fce4b0fac03fcb0149",deleted:false},{id:"5b36195fe4b0fac03fcb0151",title:"鸢尾蓝",definitionId:"5b7917f9e4b099b1464ea110",tags:["思维导图","风格样式"],description:"思维导图系统模板-鸢尾蓝",createTime:"2018-06-29 19:34:55",publishTime:"2018-06-29 19:38:01",owner:null,cloneCount:2780,viewCount:1797,likeCount:0,publicClonePrice:0,category:"mind_right",thumbnail:"5b7917f9e4b099b1464ea10f",thumbUrl:null,status:"public",lastModify:"2018-06-29 19:35:05",wpsUseCount:176494,wpsViewCount:310968,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:10:49",wpsPrice:9.9,lastUseTime:"2020-11-23 11:44:40",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b36195fe4b0fac03fcb0151",deleted:false},{id:"5b361018e4b0fac03fcb0080",title:"蔚蓝",definitionId:"5b791804e4b099b1464ea216",tags:["思维导图","风格样式"],description:"思维导图系统模板-蔚蓝",createTime:"2018-06-29 18:55:20",publishTime:"2018-06-29 19:06:37",owner:null,cloneCount:190,viewCount:847,likeCount:0,publicClonePrice:0,category:"mind_tree",thumbnail:"5b791804e4b099b1464ea215",thumbUrl:null,status:"public",lastModify:"2018-06-29 18:55:28",wpsUseCount:89085,wpsViewCount:203028,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:11:00",wpsPrice:9.9,lastUseTime:"2020-11-23 11:46:47",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b361018e4b0fac03fcb0080",deleted:false},{id:"5addd9d4e4b04691064ff997",title:"《硅谷来信-投资学》",definitionId:"5b793fc2e4b00bfde83b5127",tags:["硅谷来信","思维导图","读书笔记","学习笔记"],description:"硅谷来信之投资哲学篇（Part 1）",createTime:"2018-04-23 21:04:20",publishTime:"2018-08-15 15:09:43",owner:{userId:"5567dee0e4b07104f5a94753",userName:"edisonchou",fullName:"Edison Zhou"},cloneCount:18,viewCount:50,likeCount:0,publicClonePrice:0,category:"mind_free",thumbnail:"5b793fc2e4b00bfde83b5128",thumbUrl:null,status:"public",lastModify:"2018-08-14 12:38:18",wpsUseCount:118892,wpsViewCount:376416,wpsStatus:"visible",wpsStatusTime:"2018-08-21 16:54:34",wpsPrice:14.99,lastUseTime:"2020-11-23 10:05:37",themeTags:["读书笔记","学习笔记"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5addd9d4e4b04691064ff997",deleted:false},{id:"5f17fd7776213120ec035b01",title:"OKR高绩效目标订制模板",definitionId:"5f17fd7776213120ec035afe",tags:["OKR","目标管理"],description:"OKR目标制定",createTime:"2020-02-07 11:23:05",publishTime:"2020-02-07 11:44:02",owner:null,cloneCount:0,viewCount:0,likeCount:0,publicClonePrice:0,category:"mind_free",thumbnail:"5e3d2878e4b07e23ea8998d8",thumbUrl:null,status:"public",lastModify:"2020-02-07 11:42:47",wpsUseCount:99993,wpsViewCount:442404,wpsStatus:"visible",wpsStatusTime:"2020-02-11 10:08:07",wpsPrice:9.9,lastUseTime:"2020-11-23 11:18:41",themeTags:["OKR","目标管理"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f17fd7776213120ec035b01",deleted:false},{id:"5e339f29e4b09d5b5d033174",title:"孕产妇管理指导意见",definitionId:"5e449d9ce4b08a6f1be5fa88",tags:["疫情","冠状病毒","孕产妇"],description:"孕产妇管理指导意见",createTime:"2020-01-31 11:29:45",publishTime:"2020-02-13 08:51:38",owner:null,cloneCount:18,viewCount:81,likeCount:0,publicClonePrice:0,category:"mind_free",thumbnail:"5e449d9ce4b08a6f1be5fa87",thumbUrl:null,status:"public",lastModify:"2020-01-31 11:29:50",wpsUseCount:291816,wpsViewCount:387148,wpsStatus:"visible",wpsStatusTime:"2020-02-13 08:51:40",wpsPrice:0,lastUseTime:"2020-11-23 11:11:06",themeTags:["疫情","冠状病毒","孕产妇"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5e339f29e4b09d5b5d033174",deleted:false},{id:"5e420bcee4b01e01225ed92e",title:"核心项目规划模型",definitionId:"5e4254dce4b03b5786146b3d",tags:["项目计划"],description:"项目规划",createTime:"2020-02-11 10:05:02",publishTime:"2020-02-11 10:06:33",owner:null,cloneCount:0,viewCount:0,likeCount:0,publicClonePrice:9.9,category:"mind_free",thumbnail:"5e42221ae4b0c39ab68ca872",thumbUrl:null,status:"public",lastModify:"2020-02-11 10:05:56",wpsUseCount:77146,wpsViewCount:234759,wpsStatus:"visible",wpsStatusTime:"2020-02-11 16:47:24",wpsPrice:9.9,lastUseTime:"2020-11-23 11:20:24",themeTags:["项目计划"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5e420bcee4b01e01225ed92e",deleted:false},{id:"595ef74ee4b068b0a242702a",title:"目标设置思维导图",definitionId:"5b7917bee4b099b1464ea038",tags:["思维导图","学习计划","工作计划","时间计划"],description:"目标设置-思维导图模板",createTime:"2017-07-07 10:51:58",publishTime:"2017-08-10 19:05:34",owner:null,cloneCount:29371,viewCount:100402,likeCount:185,publicClonePrice:0,category:"mind_free",thumbnail:"5b7917bee4b099b1464ea037",thumbUrl:null,status:"public",lastModify:"2017-07-22 11:15:34",wpsUseCount:34939,wpsViewCount:68912,wpsStatus:"visible",wpsStatusTime:"2018-09-11 15:30:48",wpsPrice:9.99,lastUseTime:"2020-11-23 11:58:34",themeTags:["学习计划","工作计划","时间计划"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"595ef74ee4b068b0a242702a",deleted:false},],flow:[{id:"5938babde4b036140a0ef548",title:"条件结构流程图",definitionId:"5b7917bee4b099b1464ea060",tags:["条件结构流程图","流程图","业务流程"],description:"根据指定的条件进行判断，具有选择性且不重复",createTime:"2017-06-08 10:47:25",publishTime:"2018-07-24 10:10:19",owner:null,cloneCount:60697,viewCount:218770,likeCount:323,publicClonePrice:0,category:"flow",thumbnail:"5b7917bee4b099b1464ea05f",thumbUrl:null,status:"public",lastModify:"2017-06-08 10:47:25",wpsUseCount:409693,wpsViewCount:401181,wpsStatus:"visible",wpsStatusTime:"2019-03-29 13:40:57",wpsPrice:0,lastUseTime:"2020-11-23 12:50:46",themeTags:["业务流程"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938babde4b036140a0ef548",deleted:false},{id:"593908c0e4b036140a0ef811",title:"公司组织结构图",definitionId:"593908c0e4b036140a0ef80e",tags:["企业架构","组织结构"],description:"组织架构",createTime:"2018-01-01 19:04:38",publishTime:"2018-02-06 14:29:05",owner:{userId:"5a4a1482e4b0be852db62a9a",userName:"5a4a1482e4b0be852db62a9b",fullName:"国富"},cloneCount:0,viewCount:167,likeCount:2,publicClonePrice:5,category:"org",thumbnail:"5b793875e4b02d55a14fca23",thumbUrl:null,status:"public",lastModify:"2018-04-04 17:35:16",wpsUseCount:10377,wpsViewCount:38664,wpsStatus:"visible",wpsStatusTime:"2019-05-30 17:54:23",wpsPrice:7.9,lastUseTime:"2020-11-23 11:25:51",themeTags:["组织结构"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"593908c0e4b036140a0ef811",deleted:false},{id:"5938c0efe4b036140a0ef585",title:"Flow Chart Demo",definitionId:"5b7917bee4b099b1464ea040",tags:null,description:"基础泳道流程图",createTime:"2017-06-08 11:13:51",publishTime:"2017-06-08 11:16:40",owner:null,cloneCount:55201,viewCount:182663,likeCount:333,publicClonePrice:0,category:"flow",thumbnail:"5b7917bee4b099b1464ea03f",thumbUrl:null,status:"public",lastModify:"2017-06-08 11:13:51",wpsUseCount:4097,wpsViewCount:6962,wpsStatus:"visible",wpsStatusTime:"2019-04-01 17:51:09",wpsPrice:0,lastUseTime:"2020-11-22 16:35:08",themeTags:["常用流程"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938c0efe4b036140a0ef585",deleted:false},{id:"51e78b190cf2bf1f06de56c5",title:"Vertical Cross Functional Template",definitionId:"5b7917bde4b099b1464e9ff6",tags:["Flowchart","流程图","常用流程"],description:"Vertical Cross Functional Template",createTime:"2013-07-18 14:28:41",publishTime:"2017-06-27 11:36:53",owner:null,cloneCount:40213,viewCount:106648,likeCount:179,publicClonePrice:0,category:"flow",thumbnail:"5b7917bde4b099b1464e9ff5",thumbUrl:null,status:"public",lastModify:"2013-07-25 16:25:24",wpsUseCount:11871,wpsViewCount:1707,wpsStatus:"visible",wpsStatusTime:"2019-04-01 17:51:08",wpsPrice:5.9,lastUseTime:"2020-11-23 12:52:05",themeTags:["常用流程"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"51e78b190cf2bf1f06de56c5",deleted:false},{id:"5938c757e4b036140a0ef5ef",title:"系统架构设计流程图",definitionId:"5b7917f9e4b099b1464ea0f0",tags:["流程图","架构","系统架构"],description:"对已确定的需求的技术实现构架、作好规划，运用成套、完整的工具，在规划的步骤下去完成任务",createTime:"2017-06-08 11:41:11",publishTime:"2018-01-12 14:13:21",owner:null,cloneCount:38221,viewCount:136267,likeCount:601,publicClonePrice:0,category:"flow",thumbnail:"5b7917f9e4b099b1464ea0ef",thumbUrl:null,status:"public",lastModify:"2018-07-23 16:01:05",wpsUseCount:35780,wpsViewCount:117905,wpsStatus:"visible",wpsStatusTime:"2018-08-21 18:03:12",wpsPrice:9.9,lastUseTime:"2020-11-23 13:09:20",themeTags:["架构","系统架构"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938c757e4b036140a0ef5ef",deleted:false},{id:"593a0ac9e4b0282707d81fd9",title:"UML时序图",definitionId:"5b7917f9e4b099b1464ea108",tags:["UML时序图","软件开发","常用流程"],description:"UML时序图",createTime:"2017-06-09 10:41:13",publishTime:"2017-08-10 19:12:24",owner:null,cloneCount:22886,viewCount:67057,likeCount:149,publicClonePrice:0,category:"uml",thumbnail:"5b7917f9e4b099b1464ea107",thumbUrl:null,status:"public",lastModify:"2018-04-16 17:35:54",wpsUseCount:12575,wpsViewCount:16229,wpsStatus:"visible",wpsStatusTime:"2019-04-01 17:51:44",wpsPrice:0,lastUseTime:"2020-11-23 12:56:13",themeTags:["软件开发","常用流程"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"593a0ac9e4b0282707d81fd9",deleted:false},{id:"5938de6ce4b05a4d4380016a",title:"UML类图-登录模块",definitionId:"5b7917f9e4b099b1464ea100",tags:["UML","类图","登陆","架构","后端开发"],description:"UML类图  \n以用户登陆模块举例说明 类图中类与类之间的组合、聚合、依赖等关系",createTime:"2017-06-08 13:19:40",publishTime:"2017-08-10 19:12:30",owner:null,cloneCount:4459,viewCount:32898,likeCount:96,publicClonePrice:0,category:"uml",thumbnail:"5b7917f9e4b099b1464ea0ff",thumbUrl:null,status:"public",lastModify:"2017-06-08 13:20:27",wpsUseCount:389,wpsViewCount:2812,wpsStatus:"visible",wpsStatusTime:"2018-09-28 13:55:02",wpsPrice:9.9,lastUseTime:"2020-10-02 17:39:51",themeTags:["架构","后端开发"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938de6ce4b05a4d4380016a",deleted:false},{id:"5938c6efe4b036140a0ef5e7",title:"鱼骨图",definitionId:"5b7917bee4b099b1464ea03c",tags:["流程图","鱼骨图","分析方法","学习计划","工作计划","时间计划","项目计划","风格样式"],description:"发现问题“根本原因”的分析方法",createTime:"2017-06-08 11:39:27",publishTime:"2017-07-20 16:02:11",owner:null,cloneCount:12155,viewCount:48078,likeCount:73,publicClonePrice:0,category:"flow",thumbnail:"5b7917bee4b099b1464ea03b",thumbUrl:null,status:"public",lastModify:"2017-06-08 11:39:27",wpsUseCount:105208,wpsViewCount:374871,wpsStatus:"visible",wpsStatusTime:"2018-09-11 15:31:33",wpsPrice:9.9,lastUseTime:"2020-11-23 13:15:27",themeTags:["学习计划","工作计划","时间计划","项目计划","风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938c6efe4b036140a0ef5e7",deleted:false},{id:"5b06729fe4b0219b16d65ecb",title:"鱼骨图",definitionId:"5b7917f9e4b099b1464ea122",tags:["流程图","鱼骨图","鱼骨图模板","风格样式"],description:"好看实用的鱼骨图模板。",createTime:"2018-05-24 16:06:55",publishTime:"2018-05-24 16:14:13",owner:null,cloneCount:1,viewCount:625,likeCount:0,publicClonePrice:5,category:"flow",thumbnail:"5b7917f9e4b099b1464ea121",thumbUrl:null,status:"public",lastModify:"2018-05-24 16:08:56",wpsUseCount:1088,wpsViewCount:6161,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:10:49",wpsPrice:7.9,lastUseTime:"2020-11-21 20:16:49",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b06729fe4b0219b16d65ecb",deleted:false},{id:"5f17d7957621315c2b23c181",title:"事件记录通用流程图",definitionId:"5f17d7957621315c2b23c17e",tags:["流程图","事件流","process","时间计划"],description:"描述一个事件的操作步骤",createTime:"2017-08-09 13:43:28",publishTime:"2017-09-14 17:59:47",owner:null,cloneCount:1431,viewCount:19592,likeCount:70,publicClonePrice:2,category:"flow",thumbnail:"5b791803e4b099b1464ea179",thumbUrl:null,status:"public",lastModify:"2017-08-09 13:56:48",wpsUseCount:255692,wpsViewCount:1427706,wpsStatus:"visible",wpsStatusTime:"2018-09-13 13:57:58",wpsPrice:9.9,lastUseTime:"2020-11-23 12:41:12",themeTags:["时间计划"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f17d7957621315c2b23c181",deleted:false},{id:"5b0d1af1e4b0746adce46eeb",title:"简约花式基础流程图",definitionId:"5b79180ce4b099b1464ea23c",tags:["流程图","流程图模板","风格样式","免费"],description:"好看实用的流程图模板。    ",createTime:"2018-05-29 17:18:41",publishTime:"2018-05-29 17:22:23",owner:null,cloneCount:22,viewCount:569,likeCount:3,publicClonePrice:5,category:"flow",thumbnail:"5b79180ce4b099b1464ea23b",thumbUrl:null,status:"public",lastModify:"2018-05-29 17:18:41",wpsUseCount:215648,wpsViewCount:248862,wpsStatus:"visible",wpsStatusTime:"2019-05-07 15:34:29",wpsPrice:0,lastUseTime:"2020-11-23 12:48:16",themeTags:["风格样式","免费"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b0d1af1e4b0746adce46eeb",deleted:false},{id:"5938cb38e4b036140a0ef627",title:"经典时间轴流程图",definitionId:"5b7917f9e4b099b1464ea0f6",tags:["时间轴","流程图","事件整理","时间线"],description:"依据时间把事物归类和排序，以最适合的形态展示",createTime:"2017-06-08 11:57:44",publishTime:"2017-07-04 15:01:37",owner:null,cloneCount:13000,viewCount:39727,likeCount:130,publicClonePrice:0,category:"flow",thumbnail:"5b7917f9e4b099b1464ea0f5",thumbUrl:null,status:"public",lastModify:"2017-06-08 11:57:44",wpsUseCount:88885,wpsViewCount:288999,wpsStatus:"visible",wpsStatusTime:"2018-09-11 15:31:17",wpsPrice:9.9,lastUseTime:"2020-11-21 21:31:57",themeTags:["时间线"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938cb38e4b036140a0ef627",deleted:false},{id:"59390c76e4b036140a0ef832",title:"时间轴（垂直）",definitionId:"5edf2b04e4b0e62b7f0cdbfe",tags:["时间轴","流程图"],description:"依据时间把事物归类和排序，以最适合的形态展示",createTime:"2017-06-08 16:36:06",publishTime:"2017-08-10 18:51:58",owner:null,cloneCount:3271,viewCount:33324,likeCount:136,publicClonePrice:2,category:"flow",thumbnail:"5edf29b6e4b0768713831123",thumbUrl:null,status:"public",lastModify:"2017-06-08 16:36:06",wpsUseCount:62827,wpsViewCount:404614,wpsStatus:"visible",wpsStatusTime:"2020-06-09 14:18:30",wpsPrice:2,lastUseTime:"2020-11-23 11:13:21",themeTags:["时间轴","流程图"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"59390c76e4b036140a0ef832",deleted:false},{id:"5f17d7697621315c2b23c161",title:"旅游行程制定流程图",definitionId:"5f17d7697621315c2b23c15e",tags:["旅游计划","行程","流程图","项目时间管理","时间计划","日程安排"],description:"旅游行程订制节点及内容，仅供参考，依据具体情况而定。",createTime:"2018-07-31 18:27:50",publishTime:"2018-07-31 18:29:30",owner:null,cloneCount:20,viewCount:185,likeCount:0,publicClonePrice:3,category:"flow",thumbnail:"5b7917f8e4b099b1464ea09d",thumbUrl:null,status:"public",lastModify:"2018-07-31 18:27:50",wpsUseCount:113092,wpsViewCount:531286,wpsStatus:"visible",wpsStatusTime:"2018-08-31 14:01:46",wpsPrice:9.9,lastUseTime:"2020-11-23 10:59:38",themeTags:["时间计划","日程安排"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f17d7697621315c2b23c161",deleted:false},{id:"593a5e9fe4b03b4a3277c9d8",title:"EPC项目管理",definitionId:"5b7917bee4b099b1464ea02e",tags:["EPC事件过程链","流程图","EPC","项目管理"],description:"描述具体的业务场景",createTime:"2017-06-09 16:38:55",publishTime:"2017-08-10 19:18:59",owner:null,cloneCount:3560,viewCount:11415,likeCount:4,publicClonePrice:0,category:"epc",thumbnail:"5b7917bee4b099b1464ea02d",thumbUrl:null,status:"public",lastModify:"2017-06-09 16:38:55",wpsUseCount:3705,wpsViewCount:11395,wpsStatus:"visible",wpsStatusTime:"2018-08-21 18:32:51",wpsPrice:7.9,lastUseTime:"2020-11-19 16:48:27",themeTags:["项目管理"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"593a5e9fe4b03b4a3277c9d8",deleted:false},{id:"5938ca45e4b036140a0ef61f",title:"主流开发决策流程规范",definitionId:"5b7917f9e4b099b1464ea0e4",tags:["流程图","决策步骤","业务流程"],description:"提出问题、分析问题、解决问题遵循科学的完整的动态过程",createTime:"2017-06-08 11:53:41",publishTime:"2017-06-12 16:24:55",owner:null,cloneCount:16024,viewCount:60727,likeCount:89,publicClonePrice:0,category:"flow",thumbnail:"5b7917f9e4b099b1464ea0e3",thumbUrl:null,status:"public",lastModify:"2018-07-06 18:54:47",wpsUseCount:69114,wpsViewCount:233981,wpsStatus:"visible",wpsStatusTime:"2019-03-29 13:41:51",wpsPrice:7.9,lastUseTime:"2020-11-23 12:52:28",themeTags:["业务流程"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938ca45e4b036140a0ef61f",deleted:false},{id:"5f17d7a37621315c2b23c18e",title:"战略规划模板",definitionId:"5f17d7a37621315c2b23c18b",tags:["流程图","工作规划","战略规划","工作计划","战略"],description:"用于工作战略规划，提供了较为全面的思考视角。",createTime:"2017-12-01 11:04:54",publishTime:"2017-12-01 11:09:17",owner:null,cloneCount:517,viewCount:15499,likeCount:47,publicClonePrice:3,category:"flow",thumbnail:"5b7917f9e4b099b1464ea0c3",thumbUrl:null,status:"public",lastModify:"2017-12-01 11:04:54",wpsUseCount:21984,wpsViewCount:133462,wpsStatus:"visible",wpsStatusTime:"2018-09-04 15:34:24",wpsPrice:9.9,lastUseTime:"2020-11-23 10:24:23",themeTags:["工作计划","战略"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5f17d7a37621315c2b23c18e",deleted:false},{id:"5b3f35b4e4b054aa54aa9099",title:"流程图模板",definitionId:"5b7917bee4b099b1464ea05c",tags:["泳道图","流程图","常用流程"],description:"泳道流程图模板",createTime:"2018-07-06 17:26:12",publishTime:"2018-07-06 17:28:01",owner:null,cloneCount:18,viewCount:721,likeCount:1,publicClonePrice:5,category:"flow",thumbnail:"5b7917bee4b099b1464ea05b",thumbUrl:null,status:"public",lastModify:"2018-07-06 17:26:12",wpsUseCount:25594,wpsViewCount:133878,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:09:50",wpsPrice:7.9,lastUseTime:"2020-11-23 13:32:14",themeTags:["常用流程"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b3f35b4e4b054aa54aa9099",deleted:false},{id:"593a7a92e4b03b4a3277ca38",title:"企业价值链-横版",definitionId:"5b7917bde4b099b1464ea008",tags:["EVC企业价值链","业务流程","流程图","战略","企业经营"],description:"帮助企业确定应该优化的关键业务流程、子流程，以提高企业管理水平",createTime:"2017-06-09 18:38:10",publishTime:"2017-08-10 19:18:16",owner:null,cloneCount:1401,viewCount:5993,likeCount:3,publicClonePrice:0,category:"evc",thumbnail:"5b7917bde4b099b1464ea007",thumbUrl:null,status:"public",lastModify:"2017-06-09 18:38:10",wpsUseCount:2543,wpsViewCount:10321,wpsStatus:"visible",wpsStatusTime:"2018-09-13 08:58:12",wpsPrice:0,lastUseTime:"2020-11-22 16:55:34",themeTags:["战略","企业经营"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"593a7a92e4b03b4a3277ca38",deleted:false},{id:"56e7abcbe4b009809b890c9b",title:"Network diagram",definitionId:"5b7917bee4b099b1464ea04c",tags:["网络拓扑图","network"],description:"Network diagram",createTime:"2016-03-15 14:29:31",publishTime:"2017-08-10 19:10:24",owner:null,cloneCount:6911,viewCount:37830,likeCount:53,publicClonePrice:0,category:"network",thumbnail:"5b7917bee4b099b1464ea04b",thumbUrl:null,status:"public",lastModify:"2016-03-15 14:29:53",wpsUseCount:157,wpsViewCount:777,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:09:50",wpsPrice:7.9,lastUseTime:null,themeTags:null,score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"56e7abcbe4b009809b890c9b",deleted:false},{id:"5b1632a0e4b0e2754666d0f7",title:"韦恩图",definitionId:"5b7917f9e4b099b1464ea0f8",tags:["韦恩图 ","流程图","创意类","风格样式"],description:"一个好看实用的韦恩图模板。    ",createTime:"2018-06-05 14:50:08",publishTime:"2018-06-05 15:30:47",owner:null,cloneCount:4,viewCount:316,likeCount:0,publicClonePrice:3,category:"flow",thumbnail:"5b7917f9e4b099b1464ea0f7",thumbUrl:null,status:"public",lastModify:"2018-06-05 15:28:36",wpsUseCount:2393,wpsViewCount:195,wpsStatus:"visible",wpsStatusTime:"2019-03-28 15:45:11",wpsPrice:7.9,lastUseTime:"2020-11-23 13:16:23",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b1632a0e4b0e2754666d0f7",deleted:false},{id:"5939127ce4b036140a0ef877",title:"蜂窝组织结构图",definitionId:"5b7917f9e4b099b1464ea0d6",tags:["组织结构图","流程图","组织结构","免费"],description:"蜂窝组织结构图",createTime:"2017-06-08 17:01:48",publishTime:"2017-08-10 19:21:23",owner:null,cloneCount:2327,viewCount:5765,likeCount:9,publicClonePrice:0,category:"org",thumbnail:"5b7917f9e4b099b1464ea0d5",thumbUrl:null,status:"public",lastModify:"2017-06-08 17:31:20",wpsUseCount:145188,wpsViewCount:154207,wpsStatus:"visible",wpsStatusTime:"2018-09-11 16:10:31",wpsPrice:0,lastUseTime:"2020-11-23 13:03:50",themeTags:["组织结构","免费"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5939127ce4b036140a0ef877",deleted:false},{id:"5b0e7ae3e4b0e2754666a1b8",title:"方向流程图",definitionId:"5b79180ce4b099b1464ea240",tags:["流程图","方向流程图","工作总结"],description:"带箭头方向流程图",createTime:"2018-05-30 18:20:19",publishTime:"2018-05-30 18:22:27",owner:null,cloneCount:19,viewCount:442,likeCount:1,publicClonePrice:3,category:"flow",thumbnail:"5b79180ce4b099b1464ea23f",thumbUrl:null,status:"public",lastModify:"2018-05-30 18:21:19",wpsUseCount:60242,wpsViewCount:314257,wpsStatus:"visible",wpsStatusTime:"2019-04-12 16:19:39",wpsPrice:9.9,lastUseTime:"2020-11-23 13:16:42",themeTags:["工作总结"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b0e7ae3e4b0e2754666a1b8",deleted:false},{id:"5b7fbad8e4b094ce766e2b05",title:"环形组织结构图",definitionId:"5cb53b4de4b09b6ef2d5e171",tags:["结构图","流程图","风格样式"],description:"环形组织结构图",createTime:"2018-08-24 15:59:20",publishTime:"2018-08-30 16:26:44",owner:null,cloneCount:64,viewCount:678,likeCount:2,publicClonePrice:3,category:"flow",thumbnail:"5cb53b4de4b09b6ef2d5e170",thumbUrl:null,status:"public",lastModify:"2018-08-24 15:59:20",wpsUseCount:11830,wpsViewCount:7466,wpsStatus:"visible",wpsStatusTime:"2019-04-17 12:07:49",wpsPrice:9.9,lastUseTime:"2020-11-23 11:17:56",themeTags:["风格样式"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5b7fbad8e4b094ce766e2b05",deleted:false},{id:"5938ca1ae4b036140a0ef616",title:"数据驱动",definitionId:"5b7917f9e4b099b1464ea0fc",tags:["环形图","流程图","循环结构","供应链"],description:"区分或表明某种关系",createTime:"2017-06-08 11:52:58",publishTime:"2017-06-12 16:26:21",owner:null,cloneCount:6278,viewCount:27868,likeCount:47,publicClonePrice:0,category:"flow",thumbnail:"5b7917f9e4b099b1464ea0fb",thumbUrl:null,status:"public",lastModify:"2017-09-27 17:00:18",wpsUseCount:8934,wpsViewCount:15807,wpsStatus:"visible",wpsStatusTime:"2018-09-13 10:49:49",wpsPrice:0,lastUseTime:"2020-11-23 10:08:03",themeTags:["供应链"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5938ca1ae4b036140a0ef616",deleted:false},{id:"5da1a2f3e4b0c9f9da46d146",title:"扇形图",definitionId:"5da1a2f3e4b0c9f9da46d143",tags:["流程图","扇形图","统计分析","创意类","战略"],description:"扇形图，用于统计分析、组成要素等相关内容，可直接克隆根据使用情境进行编辑",createTime:"2017-07-21 18:15:13",publishTime:"2017-07-21 18:21:20",owner:null,cloneCount:671,viewCount:15598,likeCount:83,publicClonePrice:2,category:"flow",thumbnail:"5da1a2f3e4b0c9f9da46d144",thumbUrl:null,status:"public",lastModify:"2017-07-21 18:17:59",wpsUseCount:41959,wpsViewCount:223910,wpsStatus:"visible",wpsStatusTime:"2018-09-13 14:09:11",wpsPrice:9.9,lastUseTime:"2020-11-23 12:57:09",themeTags:["创意类","战略"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5da1a2f3e4b0c9f9da46d146",deleted:false},{id:"5da1a334e4b0c9f9da46d14a",title:"放射状流程图",definitionId:"5da1a334e4b0c9f9da46d147",tags:["流程图","利益相关分析","产品规划","项目管理"],description:"放射状流程图，可用于利益相关分析，产品介绍等相关场景。",createTime:"2017-08-15 17:11:46",publishTime:"2017-09-14 17:58:17",owner:null,cloneCount:602,viewCount:19599,likeCount:92,publicClonePrice:4,category:"flow",thumbnail:"5da1a334e4b0c9f9da46d148",thumbUrl:null,status:"public",lastModify:"2017-10-19 14:44:48",wpsUseCount:66807,wpsViewCount:392667,wpsStatus:"visible",wpsStatusTime:"2018-09-13 14:11:12",wpsPrice:9.9,lastUseTime:"2020-11-23 13:30:41",themeTags:["产品规划","项目管理"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"5da1a334e4b0c9f9da46d14a",deleted:false},{id:"59ad0ed5e4b06cfb7d860c1e",title:"标准普尔家庭配置象限图",definitionId:"5b7917f9e4b099b1464ea14e",tags:["流程图","象限","投资"],description:"标准普尔家庭资产象限图，可在原图上进行修改编辑，安排工作内容等。",createTime:"2017-09-04 16:29:09",publishTime:"2017-09-14 17:58:48",owner:null,cloneCount:312,viewCount:12171,likeCount:44,publicClonePrice:5,category:"flow",thumbnail:"5b7917f9e4b099b1464ea14d",thumbUrl:null,status:"public",lastModify:"2017-09-04 16:30:09",wpsUseCount:3212,wpsViewCount:2598,wpsStatus:"visible",wpsStatusTime:"2018-08-19 15:10:49",wpsPrice:7.9,lastUseTime:"2020-11-22 17:49:32",themeTags:["投资"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"59ad0ed5e4b06cfb7d860c1e",deleted:false},{id:"593911fde4b0815a28c14e59",title:"智慧餐饮流程图",definitionId:"5b7917f9e4b099b1464ea0b8",tags:["流程图","营销","餐饮","互联网餐饮","互联网","市场营销","运营"],description:"一图胜千言，简单的流程图，清晰的展示了营销的智慧，以餐饮业为例，列出了智慧餐饮的主要流程。",createTime:"2017-06-08 16:59:41",publishTime:"2017-06-12 16:27:22",owner:null,cloneCount:8217,viewCount:39067,likeCount:121,publicClonePrice:0,category:"flow",thumbnail:"5b7917f8e4b099b1464ea0b7",thumbUrl:null,status:"public",lastModify:"2017-06-08 17:04:15",wpsUseCount:14354,wpsViewCount:55139,wpsStatus:"visible",wpsStatusTime:"2018-09-11 15:30:04",wpsPrice:9.9,lastUseTime:"2020-11-23 12:55:01",themeTags:["市场营销","运营"],score:0,ratedLevel1Count:0,ratedLevel2Count:0,ratedLevel3Count:0,ratedLevel4Count:0,ratedLevel5Count:0,rateAvg:0,schema:null,chartId:"593911fde4b0815a28c14e59",deleted:false},]},renderDlg:function(){var q='<div id="mind-flow-dlg" class="mind-flow-dlg outline-dlg padding-lr-none" style="width: 960px;height:auto;min-height: 500px;"><div class="dlg-head bottom-line" style="padding: 0 40px;"><div class="pop-nav"><span type="newfile" class="nav-i active"><span class="ol-icons">&#xe696;</span>新建<span class="ol-icons ol-new-info" title="文件将新建至笔记的同级目录中">&#xe6ad;</span></span><span type="orgfile" class="nav-i org-type-nav">团队'+this.typeForChinese[this.insertType]+'</span><span type="myfile" class="nav-i">我的'+this.typeForChinese[this.insertType]+'</span></div></div><div class="dlg-tab-header"><p class="tab-header-text">最近文件</p><div class="outline_search search-group"><input autocomplete="off" type="text" id="myfile_search_input" value="" placeholder="搜索'+this.typeForChinese[this.insertType]+'" /><span class="ol-icons del-icon">&#xe74b;</span><span class="ol-icons search-icon">&#xe785;</span></div><span id="file_show_type" class="icons">&#xe6a3;</span></div><div data-type="orgfile" class="outline-dlg-content dlg-tab-content"> <div class="files-wrapper"><div class="file-list myfile-list"></div></div></div><div data-type="myfile" class="outline-dlg-content dlg-tab-content"> <div class="files-wrapper"><div class="file-list myfile-list"></div></div></div><div data-type="newfile" class="outline-dlg-content dlg-tab-content"> <div class="files-wrapper"><div class="file-list template-list"></div></div></div><div data-type="searchfile" class="outline-dlg-content dlg-tab-content"> <div class="files-wrapper"><div class="file-list template-list"></div></div></div></div>';var r=$(q).appendTo($("body"));$("#file_show_type").on("click",function(){if(g.mindflow.view=="ico"){$("#file_show_type").html("&#xe6a2");$("#file_show_type").attr("title","平铺");g.mindflow.view="list"}else{$("#file_show_type").html("&#xe6a3;");$("#file_show_type").attr("title","列表");g.mindflow.view="ico"}if(g.mindflow.pageType=="myfile"){g.mindflow.myfiles={curPage:1,totalPage:1,searchTitle:"",timeTitle:""};g.mindflow.server.queryUserFile(g.mindflow.insertType)}else{g.mindflow.orgfiles={curPage:1,totalPage:1,searchTitle:"",timeTitle:""};g.mindflow.server.queryOrgFile(g.mindflow.insertType)}});return r},initTabEvent:function(){var r=this;var q=$("#mind-flow-dlg");if(isInTeam!="true"){$(".org-type-nav").hide();$(".ol-new-info").hide()}q.find(".pop-nav").off("mousedown").on("mousedown",".nav-i",function(v){v.stopPropagation();var u=$(this),t=u.attr("type"),s=q.find(".dlg-tab-content[data-type="+t+"]");q.find(".nav-i").removeClass("active");q.find(".dlg-tab-content").removeClass("active");u.addClass("active");s.addClass("active");q.find(".dlg-tab-header").hide();$("#myfile_search_input").val("");$(".del-icon").hide();$("#file_show_type").removeClass("disable");$(".tab-header-text").text("最近文件");r.myfiles.searchTitle="";r.orgfiles.searchTitle="";r.pageType=t;$(".files-wrapper").css("height","601px");if(t=="myfile"||t=="orgfile"){q.find(".dlg-tab-header").show();$(".files-wrapper").css("height","545px")}if(t=="myfile"){if(s.find(".chart_item").length==0){r.server.queryUserFile(r.insertType)}r.initListPageEvent();r.searchEvent()}if(t=="orgfile"){if(s.find(".chart_item").length==0){r.server.queryOrgFile(r.insertType)}r.initListPageEvent();r.searchEvent()}if(t=="newfile"&&s.find(".chart_item").length==0){r.server.queryTemplate()}})},myfiles:{curPage:1,totalPage:1,searchTitle:"",timeTitle:""},orgfiles:{curPage:1,totalPage:1,searchTitle:"",timeTitle:""},initListPageEvent:function(){var t=this,s=$("#mind-flow-dlg"),q=s.find(".files-wrapper");var r=q.outerHeight();q.off("scroll.more").on("scroll.more",function(w){w.stopPropagation();var v=q.scrollTop(),u=q.children(".myfile-list"),y=u.outerHeight(),x="";if(t.pageType=="myfile"){x=(t.myfiles.curPage>=t.myfiles.totalPage?false:true)}else{x=(t.orgfiles.curPage>=t.orgfiles.totalPage?false:true)}if(x&&!t.server.queryFileing&&v+r+60>y){if(t.pageType=="myfile"){t.server.queryUserFile(t.insertType,"more")}else{t.server.queryOrgFile(t.insertType,"more")}}})},initFileListEvent:function(){var t=this,r=$("#mind-flow-dlg");var q=r.find(".template-list"),s=r.find(".myfile-list");q.off("mousedown.new").on("mousedown.new",".chart_item",function(x){x.stopPropagation();var w=$(this),v=w.attr("category"),u="",y="new file without name";if(!w.hasClass("empty_file")){u=w.attr("chartid"),y=w.find(".chart_title").text()}t.server.createFile(v,y,u)});s.off("mousedown.insert").on("mousedown.insert",".chart_item",function(v){v.stopPropagation();var u=$(this),w=u.attr("chartid");t.insertExistFile(w)})},searchEvent:function(){var s=this,q=$("#myfile_search_input"),r=q.parents(".outline_search");q.off("focus.header-search").on("focus.header-search",function(t){t.stopPropagation();r.addClass("focus")}).on("blur.header-search",function(t){if(q.val()==""){r.removeClass("focus")}});q.off("input").on("input",function(v){var u=$(this);if(typeof myfileSearchTimer!="undefined"&&myfileSearchTimer){clearTimeout(myfileSearchTimer)}var t=j.filterXss(u.val().trim());if(t!=""){u.next().show()}else{u.next().hide();r.find(".del-icon").trigger("mousedown.del")}myfileSearchLastTempStamp=v.timeStamp;myfileSearchTimer=setTimeout(function(){if(myfileSearchLastTempStamp==v.timeStamp){r.find(".search-icon").trigger("click.search")}},400)});q.next(".del-icon").off("mousedown.del").on("mousedown.del",function(){$(this).hide();$("#file_show_type").removeClass("disable");$(".tab-header-text").text("最近文件");if(s.pageType=="myfile"){$("#mind-flow-dlg").find('.nav-i[type="myfile"]').trigger("mousedown")}else{$("#mind-flow-dlg").find('.nav-i[type="orgfile"]').trigger("mousedown")}});r.find(".search-icon").off("click.search").on("click.search",function(){var t=$.trim($("#myfile_search_input").val());t=j.filterXss(t);if(s.pageType=="myfile"){if(!t||t==s.myfiles.searchTitle){return}s.myfiles.searchTitle=t;$("#mind-flow-dlg").find(".dlg-tab-content").removeClass("active");$("#mind-flow-dlg").find('.dlg-tab-content[data-type="searchfile"]').addClass("active");$("#file_show_type").addClass("disable");$(".tab-header-text").text("搜索结果");s.server.queryUserFile(s.insertType)}else{if(!t||t==s.orgfiles.searchTitle){return}s.orgfiles.searchTitle=t;$("#mind-flow-dlg").find(".dlg-tab-content").removeClass("active");$("#mind-flow-dlg").find('.dlg-tab-content[data-type="searchfile"]').addClass("active");$(".tab-header-text").text("搜索结果");$("#file_show_type").addClass("disable");s.server.queryOrgFile(s.insertType)}})},renderMyFiles:function(v,z,E){var w=v;var C=$(".dlg-tab-content[data-type=myfile]").find(".file-list");var B=[],q={today:[],yestoday:[],lastWeek:[],lastMongth:[],longago:[]};if(E=="search"){C=$(".dlg-tab-content[data-type=searchfile]").find(".file-list")}if(w.length==0&&z!="more"){C.html("<div class='search-none'><img src='/assets/images/icon/empty_file.svg'/>未找到文件</div>");return}var s=new Date(g.mindflow.getDate(0)),D=new Date(g.mindflow.getDate(-1)),A=new Date(g.mindflow.getDate(-7)),u=new Date(g.mindflow.getDate(-30));for(var t=0,x=w.length;t<x;t++){var y=w[t],r=new Date(y.lastModify);if(r>=s){q.today.push(y)}else{if(r>=D){q.yestoday.push(y)}else{if(r>=A){q.lastWeek.push(y)}else{if(r>=u){q.lastMongth.push(y)}else{q.longago.push(y)}}}}}if(this.view=="list"){$.each(q,function(H,M){if(M.length>0){$(".list-title").hide();if(E!="search"){var N=(H=="today")?"今天":(H=="yestoday")?"昨天":(H=="lastWeek")?"7天内":(H=="lastMongth")?"一个月内":"很早";if(g.mindflow.myfiles.timeTitle.indexOf(N)<0){g.mindflow.myfiles.timeTitle+=N;B.push('<div class="file-date-list" ><span>'+N+"</span> <div></div></div>")}}for(var G=0;G<M.length;G++){var K=M[G];var J=K.category.indexOf("mind")>-1?"mind":"flow";var F=g.mindflow.getLastTime(K.lastModify);var I="";var L=g.mindflow.getIcons(K.category);if(K.sourceName){I="来自"+K.sourceName+"文件夹"}else{I="来自个人文件"}B.push('<div class="list-item chart_item"   chartid="'+K.chartId+'"  ><div class="col1">'+L+"<label>"+K.title+'</label></div><div class="col2"><span>'+I+'</span></div><div class="col3"><span>'+F+"</span></div></div>")}}})}else{$.each(q,function(H,F){if(F.length>0){if(E!="search"){var K=(H=="today")?"今天":(H=="yestoday")?"昨天":(H=="lastWeek")?"7天内":(H=="lastMongth")?"一个月内":"很早";if(g.mindflow.myfiles.timeTitle.indexOf(K)<0){g.mindflow.myfiles.timeTitle+=K;B.push('<div class="file-date"><span>'+K+"</span></div>")}}for(var G=0;G<F.length;G++){var L=F[G];var J=L.category.indexOf("mind")>-1?"mind":"flow";var I="&#xe623;";if(J=="flow"){I="&#xe610;"}B.push('<div class="chart_item " category="'+L.category+'" chartid="'+L.chartId+'"><a class="item-thumb"><img class="thumb-img thumbed"  src="'+imagePath+"/chart_image/thumb/"+L.thumbnail+'.png"></a><span class="chart_title"><span class="ol-icons '+J+'">'+I+"</span>"+L.title+"</span></div>")}}})}if(z=="more"){C.append(B.join(""))}else{C.html(B.join(""))}},renderOrgFiles:function(v,z,E){var w=v;var C=$(".dlg-tab-content[data-type=orgfile]").find(".file-list");var B=[],q={today:[],yestoday:[],lastWeek:[],lastMongth:[],longago:[]};if(E=="search"){C=$(".dlg-tab-content[data-type=searchfile]").find(".file-list")}if(w.length==0&&z!="more"){C.html("<div class='search-none'><img src='/assets/images/icon/empty_file.svg'/>未找到文件</div>");return}var s=new Date(g.mindflow.getDate(0)),D=new Date(g.mindflow.getDate(-1)),A=new Date(g.mindflow.getDate(-7)),u=new Date(g.mindflow.getDate(-30));for(var t=0,x=w.length;t<x;t++){var y=w[t],r=new Date(y.lastModify);if(r>=s){q.today.push(y)}else{if(r>=D){q.yestoday.push(y)}else{if(r>=A){q.lastWeek.push(y)}else{if(r>=u){q.lastMongth.push(y)}else{q.longago.push(y)}}}}}if(this.view=="list"){$.each(q,function(H,M){if(M.length>0){$(".list-title").hide();if(E!="search"){var N=(H=="today")?"今天":(H=="yestoday")?"昨天":(H=="lastWeek")?"7天内":(H=="lastMongth")?"一个月内":"很早";if(g.mindflow.orgfiles.timeTitle.indexOf(N)<0){g.mindflow.orgfiles.timeTitle+=N;B.push('<div class="file-date-list" ><span>'+N+"</span> <div></div></div>")}}for(var G=0;G<M.length;G++){var K=M[G];var J=K.category.indexOf("mind")>-1?"mind":"flow";var F=g.mindflow.getLastTime(K.lastModify);var I="";var L=g.mindflow.getIcons(K.category);if(K.sourceName){I="来自"+K.sourceName+"项目组"}else{I="来自团队空间"}B.push('<div class="list-item chart_item"  category="'+K.category+'" chartid="'+K.chartId+'"  ><div class="col1">'+L+"<label>"+K.title+'</label></div><div class="col2"><span>'+I+'</span></div><div class="col3"><span>'+F+"</span></div></div>")}}})}else{$.each(q,function(H,F){if(F.length>0){if(E!="search"){var K=(H=="today")?"今天":(H=="yestoday")?"昨天":(H=="lastWeek")?"7天内":(H=="lastMongth")?"一个月内":"很早";if(g.mindflow.orgfiles.timeTitle.indexOf(K)<0){g.mindflow.orgfiles.timeTitle+=K;B.push('<div class="file-date"><span>'+K+"</span></div>")}}for(var G=0;G<F.length;G++){var L=F[G];var J=L.category.indexOf("mind")>-1?"mind":"flow";var I="&#xe623;";if(J=="flow"){I="&#xe610;"}B.push('<div class="chart_item " category="'+L.category+'" chartid="'+L.chartId+'"><a class="item-thumb"><img class="thumb-img thumbed"  src="'+imagePath+"/chart_image/thumb/"+L.thumbnail+'.png"></a><span class="chart_title"><span class="ol-icons '+J+'">'+I+"</span>"+L.title+"</span></div>")}}})}if(z=="more"){C.append(B.join(""))}else{C.html(B.join(""))}},renderTemplates:function(){var u=this.insertType;var v=this.templateConfig[u];var r="";var s=$(".dlg-tab-content[data-type=newfile]").find(".file-list");var t=(u=="mind"?"mind_free":"flow"),q=(u=="mind"?"空白思维导图":"空白流程图");if(v&&v.length>0){r+='<div class="chart_item  empty_file"  category="'+t+'"><a class="item-thumb"><span></span><span></span></a><span class=" empty_file_title chart_title">'+q+"</span></div>";v.forEach(function(x,w){r+='<div class="chart_item "  category="'+x.category+'" chartid="'+x.id+'"><a class="item-thumb"><img class="thumb-img thumbed"  src="https://assets.processon.com/chart_image/template/thumb/'+x.thumbnail+'.png"></a><span class="chart_title">'+x.title+"</span></div>"});s.html(r)}this.initFileListEvent()},insertNewFileAndEdit:function(t){var y=this.targetId,u=i.getNodeById(y),x=i.getNodeIndex(y,u.parent),r=null;if(u.parent=="root"){r=i.getRootSubPart(y)}var v=t.chart,w=(v.category.indexOf("mind")>-1?"mind":"flow");var q={image:{url:t.imgURL.replace("https://","http://")}};q[w]={chartid:v.chartId,lastModify:v.lastModify};var s=h.add(x,u.parent,r,w,q);$("#mind-flow-dlg").dialog("close");this.popEditor(v.chartId,w,s,"new");poCollect("功能触发",{"功能名称":"插入思维导图、流程图","触发位置":"","当前页面":"outline-editor","插入类型":"新建","图形类型":w})},insertExistFile:function(x){var t=this.insertType;var s=this.targetId,v=i.getNodeById(s),q=i.getNodeIndex(s,v.parent),r=null;if(v.parent=="root"){r=i.getRootSubPart(s)}var u={image:{url:"/chart_image/id/"+x+".png"}};u[t]={chartid:x};var w=h.add(q,v.parent,r,t,u);$("#mind-flow-dlg").dialog("close");this.updateFileImage(x,t,w,"new");poCollect("功能触发",{"功能名称":"插入思维导图、流程图","触发位置":"","当前页面":"outline-editor","插入类型":"已有文件","图形类型":t})},getDate:function(s){var r=new Date();r.setDate(r.getDate()+s);var u=r.getFullYear();var q=r.getMonth()+1;var t=r.getDate();return u+"-"+q+"-"+t},getLastTime:function(u){var w=new Date().getTime()-new Date(u.replace(/-/g,"/")).getTime();var s=w/1000/60;var q=s/60;var r=q/24;var v=r/30;var t=v/12;if(t>1){return parseInt(t)+"年前"}if(v>1){return parseInt(v)+"个月前"}if(r>1){return parseInt(r)+"天前"}if(q>1){return parseInt(q)+"小时前"}if(s>1){return parseInt(s)+"分钟前"}return"刚刚"},getIcons:function(r){var q=r.indexOf("mind")>=0?"<span class='icons fileICO' style='background-color:#54B783;color:#54B783;font-size:14px;' >&#xe623;</span>":"<span class='icons fileICO' style='background-color:#4386f5; color:#4386f5;font-size:14px;'>&#xe610;</span>";return q},updateFileImage:function(x,w,r,y){var u=this;if(!x){return}this.targetId=j.currentId=r;var q="/mindmap/pop/"+x;if(w=="flow"){q="/diagraming/pop/"+x}var v=$("#app-mindflow");if(v.length==0){var t='<iframe id="app-mindflow" src="" name="app-mindflow" frameborder="0"></iframe>';v=$(t).appendTo($("#chartEditor"))}var s=new Date().getTime();v.attr("src",q+"?_="+s);u.showUpdateSVGLoading(x,r);v.off("load").on("load",function(z){z.stopPropagation();if(window.frames["app-mindflow"]){getSVGTimer=setTimeout(function(){u.hideUpdateSVGLoading(x)},6000);if(y=="update"){window.frames["app-mindflow"].postMessage(JSON.stringify({eventName:"getSVG",type:"edit",chartId:x}),"*")}else{window.frames["app-mindflow"].postMessage(JSON.stringify({eventName:"getSVG",type:"new",chartId:x}),"*")}}v.off("load")})},server:{queryFileing:false,createFileing:false,queryUserFile:function(r,q){var u=this;if(this.queryFileing){return}this.queryFileing=true;$.loadingball({con:$(".files-wrapper")});var t={sort:"lastModify",category:r,currPage:1};var s=g.mindflow.myfiles;if(q=="more"){t.currPage=s.curPage-0+1}if(s.searchTitle){t.searchTitle=s.searchTitle}$.ajax({url:"/folder/user_files",data:t,timeout:1000*60,type:"post",success:function(v){u.queryFileing=false;$.loadingball({close:true});if(s.searchTitle){g.mindflow.renderMyFiles(v.pageInfo.elements,q,"search")}else{s.curPage=v.pageInfo.curPage;s.totalPage=v.pageInfo.pageCount;g.mindflow.renderMyFiles(v.pageInfo.elements,q)}},error:function(){u.queryFileing=false;$.loadingball({close:true});$.showTip("请求失败",2000,"top")},complete:function(w,v){u.queryFileing=false;$.loadingball({close:true});if(v=="timeout"){$.showTip("请求超时，请重新尝试",2000,"top")}}})},queryOrgFile:function(r,q){var u=this;if(this.queryFileing){return}this.queryFileing=true;$.loadingball({con:$(".files-wrapper")});var t={sort:"lastModify",category:r,orgId:orgId,currPage:1};var s=g.mindflow.orgfiles;if(q=="more"){t.currPage=s.curPage-0+1}if(s.searchTitle){t.searchTitle=s.searchTitle}$.ajax({url:"/organization/user_files",data:t,timeout:1000*60,type:"post",success:function(v){u.queryFileing=false;$.loadingball({close:true});if(s.searchTitle){g.mindflow.renderOrgFiles(v.pageInfo.elements,q,"search")}else{s.curPage=v.pageInfo.curPage;s.totalPage=v.pageInfo.pageCount;g.mindflow.renderOrgFiles(v.pageInfo.elements,q)}},error:function(){u.queryFileing=false;$.loadingball({close:true});$.showTip("请求失败",2000,"top")},complete:function(w,v){u.queryFileing=false;$.loadingball({close:true});if(v=="timeout"){$.showTip("请求超时，请重新尝试",2000,"top")}}})},queryTemplate:function(){g.mindflow.renderTemplates()},createFileErrorInfo:{team_error:"小组不存在或您不是小组成员",permissions_error:"您的编辑权限不足,请联系小组管理员调整成员权限",org_error:"团队不存在或您不是团队成员",version_error:"请升级至团队版",files_error:"文件可用数量不足",template_error:"尚未购买的模板"},createFile:function(r,u,q){var t=this;if(this.createFileing){return}this.createFileing=true;var s={category:r,chart_title:u||"未命名文件"};if(q){s.template=q}if(orgId){s.org=orgId}if(teamId){s.team=teamId}$.ajax({url:"/diagraming/sync_new",data:s,timeout:1000*60,type:"get",success:function(v){t.createFileing=false;if(v.result=="success"){g.mindflow.insertNewFileAndEdit(v);return}if(v.result=="files_error"){$.showTip("文件可用数量不足，请升级会员扩容",2000,"top");return}if(t.createFileErrorInfo[v.result]){$.showTip(t.createFileErrorInfo[v.result],2000,"top");return}$.showTip("创建文件失败",2000,"top")},error:function(){t.createFileing=false;$.showTip("创建文件失败",2000,"top")},complete:function(w,v){t.createFileing=false;if(v=="timeout"){$.showTip("请求超时，请重新尝试",2000,"top")}}})}}},equation:{equationInit:function(y,I){var K;$(".pop-editor").hide();var H=$(".eq-editor");if(H.length==0){H=$('<div class="eq-editor"><div><div class="notranslate" contenteditable="true"></div><div class="done">完成</div></div><div class="eg-title"><span>上/下标</span><span>根号/分号</span><span>积分/极限/求和/乘积</span><div class="icons">&#xe796;</div></div><div class="eg-con"></div></div>').appendTo("body");H=$(".eq-editor")}$(".eg-con").html("");$(".eg-title span").removeClass("on");var G,C,A,u;if(document.selection){G=document.selection;C=G.createRange();A=document.getSelection().toString().replace(/\n/g,"");u=C.htmlText}else{var G=window.getSelection();C=G.getRangeAt(0);A=G.toString().replace(/\n/g,"");var z=document.createElement("div");z.appendChild(C.cloneContents());u=z.innerHTML}var q=document.createElement("div");q.innerHTML=u;var s=$(q).find(".equation-text");if(s.length>0&&!I){I=y.find(".equation-text[data-index="+s.eq(0).data("index")+"]")}var L=$(".notranslate");if(!I){var D=document.createElement("span");D.className="eq-l";var B=document.createElement("span");B.className="eq-r";C.insertNode(D);C.collapse(false);C.insertNode(B);K=y.clone(true);C.setStart(D,0);C.setEnd(B,0);y.find(".eq-l,.eq-r").remove();L.text(A);var x='<span class="equation-text" contenteditable="false"><span></span><span>&#65279;</span></span>';var J=$(x)[0];J.childNodes[0].appendChild(C.cloneContents());var v=$(C.startContainer).parents(".equation-text");if(v.length>0){C.setStartAfter(v.get(0))}var t=C.startContainer,r=C.endContainer;C.deleteContents();C.insertNode(J);G.removeAllRanges();w(r);E(r);function w(M){if(t!=M){if(M.className=="node-title "){var N=C.extractContents();t.append(N);return}w(M.parentNode)}}function E(M){if(!M.innerHTML){var N=M.parentNode;M.remove();E(N)}}I=$(J)}else{K=y.clone(true);L.text($(I[0].outerHTML).data("equation"))}y.find(".equation-text").each(function(M,N){$(N).attr("data-index",M)});I.addClass("cur");j.selectText(I.get(0));var F=(window.getSelection?window.getSelection().getRangeAt(0):document.selection.createRange()).getBoundingClientRect();F.height=I.outerHeight();H.css({left:F.left+F.width/2-H.outerWidth()/2<0?20:F.left+F.width/2-H.outerWidth()/2,top:F.top+F.height}).show();$("body").append("<div class='eq-shade' style='position:fixed;top:0;left:0;width:100%;height:100%;z-index:2'></div>");L.focus();j.selectText(L.get(0));this.equationInitEvent(y,K,I)},equationInitEvent:function(v,r,w){var B=false,z=false,s=false;var y=$(".eq-editor"),t=$(".notranslate"),A=y.find(".done");y.off().on("keydown",function(C){C.stopPropagation()}).on("click",".eg-title span, .eg-title .icons, .eg-con",function(H){var K=["x^{y^z_w}=(1+{\\rm e}^x)^{-2xy^w}","x=\\frac{-b\\pm\\sqrt{b^2-4ac}}{2a}","x = (-b +- sqrt(b^2-4ac))/(2a)"];var I=H.target;var E=I.className?I.className:I.parentNode.className;if(E=="icons"){if($(".mind-corner").hasClass("active")&&$(".mind-corner [tit=equation]").is(":visible")){$(".mind-corner").removeClass("active")}else{$("#btn_equation").trigger("mousedown")}}else{if(E=="eg-con"){t.html(K[$(".eg-title .on").index()]).trigger("keydown").trigger("keyup").focus();var G=document.createRange();G.selectNodeContents(t.get(0));G.collapse(false);var C=window.getSelection();C.removeAllRanges();C.addRange(G)}else{var J=$(this);poCollect("点击-方程式编辑器-"+J.text()+"（例）",{"来源":"思维笔记","用户属性":outlineUI.member?"会员用户":"普通用户"});J.addClass("on").siblings().removeClass("on");var D=K[J.index()];var F=katex.renderToString(D);$(".eg-con").html('<span style="align-self: flex-start;color:#999">例：</span><div style="margin:0 auto 10px;pointer-events:none">'+F+"</div>")}}H.stopPropagation()});A.off().on("mouseup",function(C){C.stopPropagation();B=true;u()});t.off().on("mousedown",function(C){C.stopPropagation()}).on("keydown",function(D){z=true;if(D.keyCode==13){if(v.hasClass("invalid")){D.preventDefault();return}B=true;u();return}if(D.keyCode==39||D.keyCode==37){var C=window.getSelection?window.getSelection():document.selection;if((C.anchorOffset==t.text().length&&D.keyCode==39)||(C.anchorOffset==0&&D.keyCode==37)){if(s){setTimeout(function(){B=true;u(D);s=true},10)}else{setTimeout(function(){if(!s){B=true;u(D);s=true}},300)}}}s=false}).on("keyup",function(C){s=true;if(z){x()}else{document.execCommand("selectAll",false,null)}});$(".eq-shade").off().on("click",function(C){u()}).on("mousedown",function(){return false});x();function x(){try{var E=t.text();var C=katex.renderToString(E);A.removeClass("disable");w.attr("data-equation",E);v.removeClass("invalid")}catch(D){var C="无效方程式";A.addClass("disable");v.addClass("invalid")}w.children(":first").html(C);v.get(0).dispatchEvent(new Event("keyup"))}function u(F){v.focus();var E,C;if(window.getSelection){E=window.getSelection();C=E.getRangeAt(0)}else{E=document.selection;C=E.createRange()}C.deleteContents();C=C.cloneRange();var D=$(w[0].outerHTML).data("index"),G;if(!B){v.addClass("invalid")}if(v.hasClass("invalid")){r.find(".equation-temp").remove();v.html(r.html()).removeClass("invalid");if((F&&F.keyCode==39)||!F){G=v.find(".eq-r").get(0)}else{G=v.find(".eq-l").get(0)}}if(!G){G=v.find(".equation-text[data-index="+D+"]").get(0)}v.focus();if((F&&F.keyCode==39)||!F){C.setStartAfter(G)}else{C.setEndBefore(G)}C.collapse(true);E.removeAllRanges();E.addRange(C);q()}function q(){if($(w[0].outerHTML).data("equation")==""){w.remove();v.find(".equation-text").each(function(C,D){$(D).attr("data-index",C)})}y.hide();$(".eq-shade").remove();w.removeClass("cur");v.find(".equation-temp,.eq-l,.eq-r").remove();if(B){h.updateTitleOnInput(v.parents(".node-element").attr("id"),v.get(0).innerHTML,v.get(0))}}},equationHtml:function(r,s){$("body").append('<div id="html_temp" style="display:none"></div>');var q=$("#html_temp");q.html(s);r.each(function(t){q.find(".equation-text:eq("+t+")").attr({contenteditable:false}).children(":first").html("")});s=q.html();q.remove();return s},renderEquation:function(r){var q=$(r).find(".equation-text");q.each(function(){var t=$(this);var u=t.data("equation")?t.data("equation").toString():"";var s=katex.renderToString(u);t.children(":first").html(s)})}}};g.mindflow.init();i.setData(e||j.copy(i.node));i.resetNodeList();h.config.init();if(e!=null){h.renderAll()}else{h.add()}h.initEvent();setTimeout(function(){h.searchNode.init()},1000);h.setTopToolOnReadonly();d.init();m.model=i;m.controller=h;m.server=d;m.render=b;m.oplugins=g};Outline.prototype.events={data:{},addEvent:function(a,b){this.data[a]=b},trigger:function(b,d,c){var a=this.data[b];if(a!=null){a(d,c)}}};Outline.prototype.util={currentId:"",currentPid:"",touchTime:0,newId:function(){function a(){return(((1+Math.random())*65536)|0).toString(16).substring(1)}return(a()+""+a()+""+a()+""+a())},resetDataList:function(a){var b=[];for(item in a){b.push(a[item])}return b},cursorToEnd:function(b){var d=document;if(d.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(b);a.select()}else{if(window.getSelection){var c=window.getSelection();var a=document.createRange();a.selectNodeContents(b);c.removeAllRanges();c.addRange(a);c.collapseToEnd()}}},setBrNode:function(d){var c=getSelection();var a=c.getRangeAt(0);var b=document.createElement("br");a.insertNode(b);a.setEndAfter(b);a.collapse(false);c.removeAllRanges();c.addRange(a)},showPanel:function(d){d=$.extend({target:null,panel:null},d);this.closeMenu($(".mind-menu"));$(".mind-topic-box").hide();var i=d.target,g=i.offset(),c=d.panel;var f=g.top+i.outerHeight()+12;var e=g.left-c.width()/2+i.outerWidth()/2-2;if(e<0){e=0}var a=$(window).width(),b=$(window).height();c.show().css({left:e,top:f});c.on("mousedown",function(h){h.stopPropagation()})},closeMenu:function(a){a.animate({top:15,opacity:0,zIndex:0},100,function(){a.hide()})},showSubsidiary:function(i,j,o,g){if(i.length==0||j.length==0){return}var m=$(document),h=m.outerHeight(),n=m.outerWidth();var p=i.outerHeight(),e=i.outerWidth(),b=i.offset(),f=b.top,d=b.left;var l=0,c=0,a=j.outerWidth(),k=j.outerHeight();c=d+e+10;l=f;if(c+a>n){c=d-a-10}if(l+k>h){l-=l+k+10-h}j.css({position:"fixed",top:l,left:c}).show();j.off("mouseover.list").on("mouseover.list",function(){if(typeof clearSubsidiary!="undefined"){clearTimeout(clearSubsidiary)}j.show()});j.off("mouseout.list").on("mouseout.list",function(){clearSubsidiary=setTimeout(function(){j.hide()},g)});if(o){o()}},hideSubsidiary:function(b,a){if(typeof clearSubsidiary!="undefined"){clearTimeout(clearSubsidiary)}if(!b||b.length==0){b=$(".child-menu")}if(!a||a<101){b.hide();return}clearSubsidiary=setTimeout(function(){b.hide()},a)},getRealPos:function(h,g){var f=this,a=f.container,d=f.operation,i=d.zoomVal/100;var b=a.scrollLeft();var c=a.scrollTop();if(i==1){return{x:b+h,y:c+g}}var e=f.designer.offset();return{x:Math.abs(e.left)/i+h/i,y:Math.abs(e.top)/i+g/i}},copy:function(a){return $.extend(true,{},a)},copyArray:function(a){return $.extend(true,[],a)},getNodeDom:function(a){return $("#"+a)},baseColor:function(){return["#bf1e1b","#63abf7","rgb(113, 203, 45)","#ff9f1a","#30bfbf","#444444","#f4f4f4"]},scrollBottom:function(a){},selectedIds:[],selectElementsByRange:function(j,m,o,d,b){var g=$(".node-element");if(!o&&!d){return}for(var e=0,h=g.length;e<h;e++){var f=$(g[e]),c=f.offset(),l=c.top+b,a=f.attr("id"),p=f.find("[contenteditable=true]").height(),n=o?m:d?j:0,k=d?m:o?j:0;if(l+p>n&&l<k){if(!f.parents(".selected").length){f.addClass("selected")}if(f.find(".selected").length){f.find(".selected").removeClass("selected")}}else{f.removeClass("selected")}}},selectNodeByIds:function(a){this.selectedIds=a;if(!a||a.length<1){return}a.forEach(function(e,c){var d=$("#"+e),b=d.parents(".node-element");if(b.length>0&&b.hasClass("selected")){return true}if(d.find(".node-element.selected").length>0){d.find(".node-element.selected").removeClass("selected")}d.removeClass("selected").addClass("selected")})},selectText:function(b){var d=document;if(d.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(b);a.select()}else{if(window.getSelection){var c=window.getSelection();var a=document.createRange();a.selectNodeContents(b);c.removeAllRanges();c.addRange(a)}}},unSelectText:function(a){var b=window.getSelection();b.removeAllRanges()},unSelectAllNode:function(){$(".node-element.selected").removeClass("selected")},selectIds:function(c){var a=[],b=$(".node-element.selected");if(b.length){$.each(b,function(f,j){var h=$(j),e=h.find(".node-element"),l=h.attr("id");if(a.indexOf(l)==-1){a.push(l)}if(e.length&&(!c||c.indexOf("nochild")<0)){for(var d=0;d<e.length;d++){var k=$(e[d]),g=k.attr("id");if(a.indexOf(g)==-1){a.push(g)}}}})}else{if(!c||c.indexOf("withoutFocus")<0){return[this.currentId]}}return a},getAvailableSelectedIds:function(c,a,b){},resetNodeId:function(c,e){var b=this.newId(),f=this;c.id=b;if(c.free){c.parent="root"}else{c.parent=$.trim(e)}var a=c.children,g=a.length;if(g>0){for(var d=0;d<g;d++){var j=a[d];f.resetNodeId(j,c.id)}}if(c.summaries!=null&&c.summaries.length>0){var h=c.summaries;for(var d=0;d<h.length;d++){var j=h[d];f.resetNodeId(j,c.id)}}},getElementIndex:function(a){var b=$(a);return b.index()},getCurrentDate:function(){var b=new Date();var a=[],c=[];a.push(b.getFullYear());a.push((b.getMonth()+1));a.push(b.getDate());c.push(b.getHours());c.push(b.getMinutes());c.push(b.getSeconds());return a.join("-")+" "+c.join(":")},moveToEnd:function(b){var a=document.getElementById(b);a.setSelectionRange(1,1)},getTempDomHeight:function(a,b){var d=$(".node-remark-temp");if(d.length==0){d=$("<div style='height:auto;position:absolute;bottom:-999px;opacity: 0;' class='node-remark node-remark-temp'></div>").appendTo(".util-container")}d.html(b);d.css({width:a});var c=d.height();return c},removeTempDom:function(){$(".node-remark-temp").remove()},ArrayDeleteOne:function(c,b){var a=[];Array.prototype.forEach.call(c,function(f,d){if(f!=b){a.push(f)}});return a},filterXss:function(a){if(a==null||a==""){return""}a=a.toString();a=a.replace(/</g,"&lt;");a=a.replace(/%3C/g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/%3E/g,"&gt;");a=a.replace(/'/g,"&#39;");a=a.replace(/"/g,"&quot;");return a},restoreXss:function(a){if(a==null||a==""){return""}a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&#39;/g,"'");a=a.replace(/&quot;/g,'"');return a},delHtmlTag:function(a){return a.replace(/<[^>]+>/g,"")},setCursorPosition:function(h,g,f){var d=document.getElementById(h);if(d==null){return}var c=d.querySelector(".node-title");if(f!=null){c=d.querySelector(".node-remark")}if(c==null){return}if(g==null){g=c.innerHTML.length}var a=c[0];if(a==null){c.focus();return}var b=document.createRange();var e=window.getSelection();b.setStart(a,g);b.setEnd(a,g);b.collapse(true);e.removeAllRanges();e.addRange(b);c.focus()},isSafari:function(){var b=navigator.userAgent.toLowerCase();var a=/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent);if(a){return true}return b.indexOf("safari")!==-1&&b.indexOf("chrome")===-1},isChrome:function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>=0},isFirefox:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>=0},isIE:function(){return navigator.userAgent.toLowerCase().indexOf("trident")>=0},isMobile:function(){var a=navigator.userAgent.toLowerCase();mobileTag=/(iphone|ipad|ipod|ios|midp|android|windows ce|windows mobile|)/i.test(a);if(mobileTag){return true}return false},blurAdjust:function(a){setTimeout(function(){},100)},touchTime:0,dblclick:function(a,b,d){var c=this;if(a){$(document).off("click."+b).on("click."+b,a,function(g){g.stopPropagation();var f=new Date().getTime();if(f-c.touchTime<300){d(g)}else{c.touchTime=f}})}},testVipState:function(c){var b=this;if(typeof c=="undefined"){c=function(){}}if(typeof vipPreTime!="undefined"){var a=new Date().getTime();if(a-vipPreTime<120000){c();return}vipPreTime=a}else{vipPreTime=new Date().getTime()}if(typeof wpsSdkReady=="undefined"){window.wpsSdkReady=function(d){if(window.__wpsoffice_environment==="miniprogram"){if(typeof wpsOauth=="undefined"||!wpsOauth){wps.authorize({scope:"scope.userInfo",complete:function(e){if(e.status){wpsOauth="oauthed"}else{wps.closeWeb()}}})}b.appVipInfoInit(d)}else{}}}if(!window.wps){document.addEventListener("WpsofficeSDKReady",wpsSdkReady,false)}else{wpsSdkReady(c)}},wpsLimitFree:0,wpsLimitFreePopCount:0,appVipInfoInit:function(a){if(typeof(wpsUserType)=="undefined"){wpsUserType=10}wpsVipInfo=[];wps.isVip({complete:function(b){if(b.data.is_wps_vip){wpsVipInfo.push(20)}if(b.data.is_docer_vip){wpsVipInfo.push(12)}if(b.data.is_super_vip){wpsVipInfo.push(40)}if(!b.data.is_wps_vip&&!b.data.is_docer_vip&&!b.data.is_super_vip){wpsVipInfo.push(10)}if(a){a()}}})},wpsVipInit:function(b){if(typeof(wpsUserType)=="undefined"){wpsUserType=10}wpsVipInfo=[];var e=b.vip;if(e&&e.enabled&&e.enabled.length>0){var d=e.enabled;for(var c=0,a=d.length;c<a;c++){wpsVipInfo.push(d[c].memberid-0)}if(b.usertype){wpsUserType=b.usertype}else{if(wpsVipInfo.indexOf(12)>-1){wpsUserType=12}if(wpsVipInfo.indexOf(20)>-1){wpsUserType=20}if(wpsVipInfo.indexOf(40)>-1){wpsUserType=40}}return}if(b.usertype){wpsUserType=b.usertype;wpsVipInfo.push(b.usertype);return}wpsUserType=10;wpsVipInfo.push(10)},deviceIdentify:function(){var a=this.getUrlParams("device");if(!a){if(/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)){a="ios"}else{if(/(Android)/i.test(navigator.userAgent)){a="android"}else{a="yun"}}}return a},getUrlParams:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");var c=window.location.search.substr(1).match(b);if(c!=null){return unescape(c[2])}return null},getCollaCount:function(){var a=1;if(OutlineWebsocketUtil){a=Object.keys(OutlineWebsocketUtil.collaUserClient).length||1}return a},imageBase64ByCanvas:function(b,d){if(!b){return null}var a=new Image();a.crossOrigin="";a.src=b;image.onload=function(){c(image,image.width,image.height,d)};function c(g,i,e,k){var h=document.createElement("canvas");h.width=i?i:g.width;h.height=e?e:g.height;var f=h.getContext("2d");f.drawImage(g,0,0,h.width,h.height);var j=h.toDataURL();k(j)}},getImageBase64:function(c,b){window.URL=window.URL||window.webkitURL;var a=new XMLHttpRequest();a.open("get",c,true);a.responseType="blob";a.onload=function(){if(this.status==200){var d=this.response;var e=new FileReader();e.onloadend=function(g){var f=g.target.result;b(f)};e.readAsDataURL(d)}};a.send()}};var PoNetwork={preStatus:"online",offlineCallback:null,onlineCallback:null,onlineVal:"online",offlineVal:"offline",intervalTime:10000,networkTimer:null,imgExpireLoadTime:5000,imgTimeoutTimer:null,imgTimeoutTimer2:null,init:function(a){if(!a){a={}}PoNetwork.offlineHandlePub=a.offlineHandle;PoNetwork.onlineHandlePub=a.onlineHandle;if(a.onlineChange){PoNetwork.onlineChangePub=a.onlineChange}if(PoNetwork.networkTimer){clearInterval(PoNetwork.networkTimer)}PoNetwork.networkTimer=setInterval(function(){PoNetwork.test()},PoNetwork.intervalTime);window.addEventListener("offline",PoNetwork.offlineFc,false);window.addEventListener("online",PoNetwork.onlineFc,false);Object.defineProperty(PoNetwork,"status",{get:function(){return this.preStatus},set:function(b){if(b=="offline"&&this.preStatus=="online"){PoNetwork.offlineChange()}if(b=="online"&&this.preStatus=="offline"){PoNetwork.onlineChange()}this.preStatus=b}})},onlineChange:function(){if(this.onlineChangePub){this.onlineChangePub()}},offlineChange:function(){},offlineHandle:function(){if(typeof offlineMask=="undefined"){offlineMask=false}if(!offlineMask){PoNetwork.openDialog()}offlineMask=true;if(PoNetwork.offlineHandlePub){PoNetwork.offlineHandlePub()}if(this.offlineCallback){this.offlineCallback()}},onlineHandle:function(){if(typeof offlineMask=="undefined"){offlineMask=false}if(offlineMask){PoNetwork.closeDialog()}offlineMask=false;if(PoNetwork.onlineCallback){PoNetwork.onlineCallback()}if(PoNetwork.onlineHandlePub){PoNetwork.onlineHandlePub()}},clearNetworkTimer:function(){clearInterval(PoNetwork.netWorkTimer)},test:function(b){if(b==null){b={}}PoNetwork.onlineCallback=b.onlineCallback||null;PoNetwork.offlineCallback=b.offlineCallback||null;PoNetwork.saveTrigger=b.saveTrigger||null;if(navigator.onLine==false){PoNetwork.offlineFc()}else{var a=new Image();a.src="https://ks3-cn-beijing.ksyun.com/mind-files/netest.jpg?_u="+new Date().getTime();PoNetwork.imgTimeoutTimer=setTimeout(function(){PoNetwork.testAgain();a=null},PoNetwork.imgExpireLoadTime);a.onload=function(){clearTimeout(PoNetwork.imgTimeoutTimer);clearTimeout(PoNetwork.imgTimeoutTimer2);PoNetwork.onlineFc();a=null}}},offlineFc:function(){PoNetwork.offlineHandle();PoNetwork.status="offline"},onlineFc:function(){PoNetwork.onlineHandle();PoNetwork.status="online"},testAgain:function(c){var b=this;var a=new Image();a.src="https://nettest.processon.com/assets/netest.jpg?_u="+new Date().getTime();PoNetwork.imgTimeoutTimer2=setTimeout(function(){b.offlineFc();a=null},PoNetwork.imgExpireLoadTime);a.onload=function(){clearTimeout(PoNetwork.imgTimeoutTimer2);b.onlineFc();a=null}},openDialog:function(){if(typeof mind!="undefined"){}else{}outlineUI.showTip("offline_dlg")},closeDialog:function(){if(typeof mind!="undefined"){$(".offline-dlg").dialog("close")}else{}outlineUI.showTip("close","offline_dlg")}};